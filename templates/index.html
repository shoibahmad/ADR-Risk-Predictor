<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ADR Risk Predictor - Clinical Decision Support</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            align-items: center;
        }

        .header-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .header-item i {
            color: #667eea;
            font-size: 1.2rem;
        }

        .header-item-content {
            display: flex;
            flex-direction: column;
        }

        .header-label {
            font-size: 0.8rem;
            color: #6b7280;
            font-weight: 500;
        }

        .header-value {
            font-size: 1rem;
            color: #1f2937;
            font-weight: 600;
        }

        /* Form Container */
        .form-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .form-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f5f9;
        }

        .form-title {
            font-size: 2rem;
            color: #1e293b;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .form-subtitle {
            color: #64748b;
            font-size: 1.1rem;
        }

        /* Sample Data Controls */
        .sample-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn-sample {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-sample:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }

        .sample-selector {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            color: #374151;
            font-weight: 500;
            min-width: 200px;
            cursor: pointer;
        }

        .sample-selector:focus {
            outline: none;
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }

        /* Form Sections */
        .form-section {
            background: #ffffff;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #f1f5f9;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8fafc;
        }

        .section-header i {
            color: #667eea;
            font-size: 1.3rem;
        }

        .section-header h3 {
            color: #1e293b;
            font-size: 1.4rem;
            font-weight: 700;
            margin: 0;
        }

        /* Form Grid */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            background: #ffffff;
            color: #1f2937;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .form-group input::placeholder {
            color: #9ca3af;
            font-weight: 400;
        }

        /* BMI Display */
        .bmi-display {
            margin-top: 10px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bmi-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1a202c;
        }

        .bmi-category {
            font-size: 0.9rem;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bmi-category.normal {
            background: #d1fae5;
            color: #065f46;
        }

        .bmi-category.overweight {
            background: #fed7aa;
            color: #9a3412;
        }

        .bmi-category.obese {
            background: #fecaca;
            color: #991b1b;
        }

        .bmi-category.underweight {
            background: #dbeafe;
            color: #1e40af;
        }

        /* Checkbox Grid */
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: #ffffff;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .checkbox-group:hover {
            border-color: #667eea;
            background: #f8fafc;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #667eea;
            cursor: pointer;
        }

        .checkbox-group label {
            font-weight: 600;
            color: #374151;
            cursor: pointer;
            margin: 0;
            flex: 1;
        }

        .checkbox-group:has(input[type="checkbox"]:checked) {
            border-color: #667eea;
            background: #f0f4ff;
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f1f5f9;
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            min-width: 160px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8fafc;
            color: #374151;
            border: 2px solid #e5e7eb;
        }

        .btn-secondary:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced Mobile Responsive Design */
        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 8px;
                max-width: 100%;
            }

            .header-card {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 12px;
                margin-bottom: 20px;
            }

            .header-item {
                padding: 8px;
                text-align: center;
                min-height: auto;
            }

            .header-value {
                font-size: 0.9rem;
            }

            .form-container {
                padding: 12px;
                margin-bottom: 15px;
                border-radius: 12px;
            }

            .form-title {
                font-size: 1.3rem;
                text-align: center;
            }

            .form-section {
                padding: 15px;
                margin-bottom: 15px;
                border-radius: 12px;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
                margin-bottom: 15px;
            }

            .section-header h3 {
                font-size: 1.1rem;
            }

            .form-grid {
                grid-template-columns: 1fr !important;
                gap: 12px;
            }

            .form-group {
                margin-bottom: 0;
            }

            .form-group label {
                font-size: 0.9rem;
                margin-bottom: 6px;
            }

            .form-group input,
            .form-group select {
                padding: 12px;
                font-size: 0.9rem;
                border-radius: 8px;
            }

            .checkbox-grid {
                grid-template-columns: 1fr !important;
                gap: 8px;
            }

            .checkbox-group {
                padding: 12px;
                border-radius: 8px;
            }

            .sample-controls {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .sample-selector {
                width: 100%;
                min-width: auto;
                padding: 12px;
            }

            .form-actions {
                flex-direction: column;
                gap: 10px;
                margin-top: 20px;
            }

            .btn {
                width: 100% !important;
                min-width: auto !important;
                padding: 14px 20px;
                font-size: 0.9rem;
                border-radius: 8px;
            }

            /* Results Mobile Optimization */
            .results-container {
                padding: 12px;
                margin-top: 15px;
                border-radius: 12px;
            }

            .results-header {
                margin-bottom: 20px;
                text-align: center;
            }

            .results-header h2 {
                font-size: 1.3rem;
            }

            .results-layout {
                grid-template-columns: 1fr !important;
                gap: 15px;
            }

            .analysis-column,
            .report-column {
                padding: 12px;
                border-radius: 12px;
            }

            .column-header {
                margin-bottom: 15px;
                padding-bottom: 10px;
            }

            .column-header h3 {
                font-size: 1.1rem;
            }

            /* Mobile Results Content */
            .results-content {
                padding: 0 !important;
            }

            .results-content > div {
                padding: 12px !important;
                border-radius: 12px !important;
            }

            /* Mobile Risk Cards */
            .results-content div[style*="grid-template-columns"] {
                display: flex !important;
                flex-direction: column !important;
                gap: 12px !important;
            }

            .results-content div[style*="text-align: center"] {
                padding: 15px !important;
                border-radius: 10px !important;
            }

            /* Mobile ADR Type Cards */
            .specific-adr-types-grid {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
            }

            .adr-type-card {
                padding: 12px !important;
                border-radius: 10px !important;
                margin-bottom: 8px;
            }

            .adr-probability {
                font-size: 1.6rem !important;
            }

            .risk-badge {
                font-size: 0.7rem !important;
                padding: 4px 8px !important;
            }

            /* Mobile Medication Suggestions */
            .medication-alternatives {
                flex-direction: column !important;
                gap: 8px !important;
            }

            .medication-alt {
                flex: none !important;
                min-width: auto !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 10px !important;
                text-align: center !important;
            }

            /* Mobile Monitoring Parameters */
            .monitoring-params {
                flex-direction: column !important;
                gap: 8px !important;
            }

            .monitoring-param {
                flex: none !important;
                min-width: auto !important;
                width: 100% !important;
                text-align: center !important;
                padding: 10px !important;
            }

            /* Mobile Report Content */
            .report-content {
                padding: 12px !important;
                max-height: 400px;
                font-size: 0.85rem;
                line-height: 1.6;
            }

            .report-content h1 {
                font-size: 1.3rem !important;
            }

            .report-content h2 {
                font-size: 1.1rem !important;
                padding: 8px 12px !important;
            }

            .report-content h3 {
                font-size: 1rem !important;
                padding: 6px 10px !important;
            }

            /* Mobile Modal */
            .modal-content {
                margin: 10px !important;
                padding: 15px !important;
                max-height: 90vh;
                border-radius: 12px;
            }

            .modal-title {
                font-size: 1.3rem;
                flex-direction: column;
                gap: 8px;
            }

            .feature-grid {
                grid-template-columns: 1fr !important;
                gap: 10px;
            }

            .feature-card {
                padding: 12px;
            }

            /* Mobile BMI Display */
            .bmi-display {
                flex-direction: column;
                gap: 8px;
                text-align: center;
                padding: 10px;
            }

            .bmi-value {
                font-size: 1rem;
            }

            .bmi-category {
                font-size: 0.8rem;
                padding: 3px 8px;
            }
        }

        /* Ultra Mobile Responsive - Small Phones */
        @media (max-width: 480px) {
            body {
                font-size: 13px;
                line-height: 1.4;
            }

            .container {
                padding: 5px;
                margin: 0;
            }

            .header-card {
                padding: 10px;
                gap: 8px;
                margin-bottom: 15px;
                border-radius: 10px;
            }

            .header-item {
                padding: 6px;
                font-size: 0.8rem;
                border-radius: 8px;
            }

            .header-label {
                font-size: 0.7rem;
            }

            .header-value {
                font-size: 0.85rem;
            }

            .form-container {
                padding: 10px;
                margin-bottom: 12px;
                border-radius: 10px;
            }

            .form-title {
                font-size: 1.2rem;
                margin-bottom: 8px;
            }

            .form-subtitle {
                font-size: 0.9rem;
            }

            .form-section {
                padding: 12px;
                margin-bottom: 12px;
                border-radius: 10px;
            }

            .section-header {
                margin-bottom: 12px;
                padding-bottom: 8px;
            }

            .section-header h3 {
                font-size: 1rem;
            }

            .section-header i {
                font-size: 1rem;
            }

            .form-group {
                margin-bottom: 12px;
            }

            .form-group label {
                font-size: 0.85rem;
                margin-bottom: 5px;
            }

            .form-group input,
            .form-group select {
                padding: 10px;
                font-size: 0.85rem;
                border-radius: 6px;
                border-width: 1px;
            }

            .checkbox-group {
                padding: 10px;
                border-radius: 6px;
                gap: 8px;
            }

            .checkbox-group label {
                font-size: 0.85rem;
            }

            .sample-controls {
                gap: 8px;
                margin-top: 15px;
            }

            .btn-sample {
                padding: 10px 16px;
                font-size: 0.85rem;
                border-radius: 6px;
            }

            .sample-selector {
                padding: 10px;
                font-size: 0.85rem;
                border-radius: 6px;
            }

            .btn {
                padding: 12px 16px !important;
                font-size: 0.85rem !important;
                border-radius: 6px !important;
            }

            /* Ultra Mobile Results */
            .results-container {
                padding: 10px;
                margin-top: 12px;
                border-radius: 10px;
            }

            .results-header {
                margin-bottom: 15px;
            }

            .results-header h2 {
                font-size: 1.2rem;
            }

            .analysis-column,
            .report-column {
                padding: 10px;
                border-radius: 10px;
                margin-bottom: 10px;
            }

            .column-header {
                margin-bottom: 12px;
                padding-bottom: 8px;
            }

            .column-header h3 {
                font-size: 1rem;
            }

            /* Ultra Mobile Risk Cards - Force Single Column */
            .results-content div[style*="display: grid"] {
                display: flex !important;
                flex-direction: column !important;
                gap: 10px !important;
            }

            .results-content div[style*="text-align: center"] {
                padding: 12px !important;
                border-radius: 8px !important;
                margin-bottom: 8px !important;
            }

            .results-content h3 {
                font-size: 0.9rem !important;
                margin: 0 0 8px 0 !important;
            }

            .results-content div[style*="font-size: 2rem"] {
                font-size: 1.5rem !important;
            }

            .results-content div[style*="font-size: 1.5rem"] {
                font-size: 1.2rem !important;
            }

            /* Ultra Mobile ADR Cards */
            .specific-adr-types-grid {
                grid-template-columns: 1fr !important;
                gap: 8px !important;
            }

            .adr-type-card {
                padding: 10px !important;
                border-radius: 8px !important;
            }

            .adr-type-card h5 {
                font-size: 0.8rem !important;
                line-height: 1.2 !important;
            }

            .adr-probability {
                font-size: 1.4rem !important;
            }

            .risk-badge {
                font-size: 0.65rem !important;
                padding: 3px 6px !important;
            }

            /* Ultra Mobile Suggestions */
            .medication-alternatives,
            .monitoring-params {
                flex-direction: column !important;
                gap: 6px !important;
            }

            .medication-alt,
            .monitoring-param {
                width: 100% !important;
                margin: 0 !important;
                padding: 8px !important;
                font-size: 0.8rem !important;
                border-radius: 6px !important;
            }

            /* Ultra Mobile Report */
            .report-content {
                padding: 10px !important;
                max-height: 300px !important;
                font-size: 0.8rem !important;
                line-height: 1.5 !important;
                border-radius: 8px !important;
            }

            .report-content h1 {
                font-size: 1.1rem !important;
                margin-bottom: 10px !important;
            }

            .report-content h2 {
                font-size: 1rem !important;
                padding: 6px 10px !important;
                margin: 15px 0 8px 0 !important;
            }

            .report-content h3 {
                font-size: 0.9rem !important;
                padding: 4px 8px !important;
                margin: 12px 0 6px 0 !important;
            }

            .report-content p {
                font-size: 0.8rem !important;
                margin: 8px 0 !important;
            }

            .report-content ul,
            .report-content ol {
                margin: 8px 0 !important;
                padding-left: 20px !important;
            }

            .report-content li {
                font-size: 0.8rem !important;
                margin-bottom: 4px !important;
            }

            /* Ultra Mobile Modal */
            .modal-overlay {
                padding: 5px;
            }

            .modal-content {
                margin: 5px !important;
                padding: 12px !important;
                max-height: 95vh !important;
                border-radius: 10px !important;
            }

            .modal-title {
                font-size: 1.1rem !important;
                margin-bottom: 15px;
            }

            .modal-section {
                margin-bottom: 15px;
            }

            .modal-section h3 {
                font-size: 0.95rem !important;
            }

            .modal-section p {
                font-size: 0.8rem !important;
            }

            .feature-card {
                padding: 10px !important;
            }

            .feature-card i {
                font-size: 1.2rem !important;
            }

            .feature-card h4 {
                font-size: 0.85rem !important;
            }

            .feature-card p {
                font-size: 0.75rem !important;
            }

            /* Ultra Mobile BMI */
            .bmi-display {
                padding: 8px !important;
                border-radius: 6px !important;
            }

            .bmi-value {
                font-size: 0.95rem !important;
            }

            .bmi-category {
                font-size: 0.7rem !important;
                padding: 2px 6px !important;
            }

            /* Force text wrapping */
            * {
                word-wrap: break-word;
                overflow-wrap: break-word;
            }

            /* Ensure no horizontal scrolling */
            body, html {
                overflow-x: hidden;
                max-width: 100vw;
            }

            .container {
                max-width: 100vw;
                overflow-x: hidden;
            }
        }

        /* Results Container */
        .results-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        .results-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f5f9;
        }

        .results-header h2 {
            font-size: 1.8rem;
            color: #1e293b;
            margin-bottom: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .results-header i {
            color: #667eea;
        }

        .results-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .analysis-column {
            background: #f8fafc;
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #e5e7eb;
        }

        .report-column {
            background: #f8fafc;
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #e5e7eb;
        }

        /* Information Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f5f9;
        }

        .modal-title {
            font-size: 2rem;
            color: #1e293b;
            margin-bottom: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .modal-title i {
            color: #667eea;
        }

        .modal-subtitle {
            color: #64748b;
            font-size: 1.1rem;
        }

        .modal-section {
            margin-bottom: 25px;
        }

        .modal-section h3 {
            color: #374151;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-section h3 i {
            color: #667eea;
        }

        .modal-section p {
            color: #6b7280;
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .modal-section ul {
            color: #6b7280;
            padding-left: 20px;
            line-height: 1.7;
        }

        .modal-section li {
            margin-bottom: 8px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            text-align: center;
        }

        .feature-card i {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 10px;
        }

        .feature-card h4 {
            color: #374151;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .feature-card p {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .modal-actions {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f1f5f9;
        }

        /* Two Column Results Layout */
        .results-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .analysis-column,
        .report-column {
            background: #f8fafc;
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #e5e7eb;
        }

        .column-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .column-header h3 {
            color: #1e293b;
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0;
        }

        .column-header i {
            color: #667eea;
        }

        .ai-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: auto;
        }

        .report-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            padding: 30px;
            border-radius: 16px;
            border: 2px solid #e2e8f0;
            max-height: 600px;
            overflow-y: auto;
            line-height: 1.8;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.02);
        }

        /* Custom scrollbar for report content */
        .report-content::-webkit-scrollbar {
            width: 8px;
        }

        .report-content::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }

        .report-content::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .report-content::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Enhanced typography for AI report */
        .report-content h1 {
            color: #1e293b;
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0 0 20px 0;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .report-content h2 {
            color: #667eea;
            font-size: 1.4rem;
            font-weight: 700;
            margin: 30px 0 15px 0;
            padding: 12px 20px;
            background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
            border-left: 4px solid #667eea;
            border-radius: 8px;
            position: relative;
        }

        .report-content h2::before {
            content: '';
            position: absolute;
            left: -4px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .report-content h3 {
            color: #374151;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 25px 0 12px 0;
            padding: 8px 15px;
            background: #f8fafc;
            border-radius: 6px;
            border-left: 3px solid #10b981;
        }

        .report-content h4 {
            color: #4b5563;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 20px 0 10px 0;
            padding-left: 10px;
            border-left: 2px solid #d1d5db;
        }

        /* Enhanced paragraph styling */
        .report-content p {
            color: #374151;
            font-size: 1rem;
            line-height: 1.8;
            margin: 15px 0;
            text-align: justify;
        }

        /* Enhanced list styling */
        .report-content ul,
        .report-content ol {
            margin: 20px 0;
            padding-left: 25px;
            color: #374151;
        }

        .report-content ul {
            list-style: none;
        }

        .report-content ul li {
            position: relative;
            margin-bottom: 12px;
            padding-left: 25px;
            line-height: 1.7;
        }

        .report-content ul li::before {
            content: '▸';
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .report-content ol li {
            margin-bottom: 12px;
            line-height: 1.7;
            padding-left: 5px;
        }

        /* Strong and emphasis styling */
        .report-content strong {
            color: #1e293b;
            font-weight: 700;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .report-content em {
            color: #667eea;
            font-style: italic;
            font-weight: 500;
        }

        /* Special sections styling */
        .report-content blockquote {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            margin: 20px 0;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
            font-style: italic;
            color: #0c4a6e;
        }

        /* Code and technical terms */
        .report-content code {
            background: #f1f5f9;
            color: #1e293b;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            border: 1px solid #e2e8f0;
        }

        /* Tables in reports */
        .report-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .report-content th,
        .report-content td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .report-content th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
        }

        /* Highlight important sections */
        .report-content .highlight {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
            margin: 20px 0;
        }

        .report-content .warning {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid #ef4444;
            margin: 20px 0;
            color: #7f1d1d;
        }

        .report-content .success {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid #22c55e;
            margin: 20px 0;
            color: #14532d;
        }

        /* Medical terminology styling */
        .report-content .medical-term {
            color: #7c3aed;
            font-weight: 600;
            text-decoration: underline;
            text-decoration-color: #c4b5fd;
            text-decoration-thickness: 2px;
        }

        /* Risk level indicators */
        .report-content .risk-high {
            color: #dc2626;
            font-weight: 700;
            background: #fef2f2;
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid #fecaca;
        }

        .report-content .risk-medium {
            color: #d97706;
            font-weight: 700;
            background: #fffbeb;
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid #fed7aa;
        }

        .report-content .risk-low {
            color: #059669;
            font-weight: 700;
            background: #f0fdf4;
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid #bbf7d0;
        }

        .report-loading {
            text-align: center;
            padding: 40px 20px;
            color: #667eea;
        }

        .report-loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }

        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header-card">
            <div class="header-item">
                <i class="fas fa-user"></i>
                <div class="header-item-content">
                    <span class="header-label">Patient</span>
                    <span class="header-value" id="patient-name-display">Loading...</span>
                </div>
            </div>
            <div class="header-item">
                <i class="fas fa-user-md"></i>
                <div class="header-item-content">
                    <span class="header-label">Clinician</span>
                    <span class="header-value" id="clinician-name-display">Loading...</span>
                </div>
            </div>
            <div class="header-item">
                <i class="fas fa-clock"></i>
                <div class="header-item-content">
                    <span class="header-label">Assessment Time</span>
                    <span class="header-value" id="timestamp-display">Loading...</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="form-container">
            <div class="form-header">
                <h1 class="form-title">
                    <i class="fas fa-user-md"></i>
                    Patient Assessment
                </h1>
                <p class="form-subtitle">Enter patient information to assess ADR risk</p>
                
                <div class="sample-controls">
                    <button type="button" id="info-button" class="btn-sample" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                        <i class="fas fa-info-circle"></i>
                        Project Information
                    </button>
                    <select id="sample-data-selector" class="sample-selector">
                        <option value="">Choose sample patient...</option>
                        <option value="high-risk">High Risk Patient</option>
                        <option value="medium-risk">Medium Risk Patient</option>
                        <option value="low-risk">Low Risk Patient</option>
                    </select>
                </div>
            </div>

            <form id="adr-form" class="patient-form">
                <!-- Demographics Section -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-user"></i>
                        <h3>Demographics</h3>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="age">Age (years)</label>
                            <input type="number" id="age" name="age" min="18" max="120" placeholder="Enter age (18-120)" required>
                        </div>
                        <div class="form-group">
                            <label for="sex">Sex</label>
                            <select id="sex" name="sex" required>
                                <option value="">Select sex...</option>
                                <option value="M">Male</option>
                                <option value="F">Female</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="ethnicity">Ethnicity</label>
                            <select id="ethnicity" name="ethnicity" required>
                                <option value="">Select ethnicity...</option>
                                <option value="White">White</option>
                                <option value="Asian">Asian</option>
                                <option value="Black">Black</option>
                                <option value="Hispanic">Hispanic</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="height">Height (cm)</label>
                            <input type="number" id="height" name="height" min="100" max="250" step="0.1" placeholder="Enter height (100-250 cm)" required>
                        </div>
                        <div class="form-group">
                            <label for="weight">Weight (kg)</label>
                            <input type="number" id="weight" name="weight" min="30" max="300" step="0.1" placeholder="Enter weight (30-300 kg)" required>
                        </div>
                        <div class="form-group">
                            <label for="bmi">BMI (kg/m²)</label>
                            <input type="number" id="bmi" name="bmi" step="0.1" min="15" max="50" placeholder="Auto-calculated" readonly required>
                            <div class="bmi-display">
                                <span class="bmi-value" id="bmi-value">--</span>
                                <span class="bmi-category" id="bmi-category">Enter height & weight</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Laboratory Values Section -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-flask"></i>
                        <h3>Laboratory Values</h3>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="creatinine">Creatinine (mg/dL)</label>
                            <input type="number" id="creatinine" name="creatinine" step="0.01" min="0.5" max="10" placeholder="Normal: 0.6-1.2" required>
                        </div>
                        <div class="form-group">
                            <label for="egfr">eGFR (mL/min/1.73m²)</label>
                            <input type="number" id="egfr" name="egfr" step="0.1" min="5" max="150" placeholder="Normal: >90" required>
                        </div>
                        <div class="form-group">
                            <label for="ast_alt">AST/ALT (U/L)</label>
                            <input type="number" id="ast_alt" name="ast_alt" min="5" max="1000" placeholder="Normal: 10-40" required>
                        </div>
                        <div class="form-group">
                            <label for="bilirubin">Bilirubin (mg/dL)</label>
                            <input type="number" id="bilirubin" name="bilirubin" step="0.01" min="0.1" max="10" placeholder="Normal: 0.2-1.2" required>
                        </div>
                        <div class="form-group">
                            <label for="albumin">Albumin (g/dL)</label>
                            <input type="number" id="albumin" name="albumin" step="0.01" min="1" max="6" placeholder="Normal: 3.5-5.0" required>
                        </div>
                    </div>
                </div>

                <!-- Comorbidities Section -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-notes-medical"></i>
                        <h3>Comorbidities</h3>
                    </div>
                    <div class="checkbox-grid">
                        <div class="checkbox-group">
                            <input type="checkbox" id="diabetes" name="diabetes" value="1">
                            <label for="diabetes">Diabetes Mellitus</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="liver_disease" name="liver_disease" value="1">
                            <label for="liver_disease">Liver Disease</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="ckd" name="ckd" value="1">
                            <label for="ckd">Chronic Kidney Disease</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="cardiac_disease" name="cardiac_disease" value="1">
                            <label for="cardiac_disease">Cardiac Disease</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="hypertension" name="hypertension" value="1">
                            <label for="hypertension">Hypertension</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="respiratory_disease" name="respiratory_disease" value="1">
                            <label for="respiratory_disease">Respiratory Disease</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="neurological_disease" name="neurological_disease" value="1">
                            <label for="neurological_disease">Neurological Disease</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="autoimmune_disease" name="autoimmune_disease" value="1">
                            <label for="autoimmune_disease">Autoimmune Disease</label>
                        </div>
                    </div>
                </div>

                <!-- Medication Information -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-pills"></i>
                        <h3>Medication Information</h3>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="medication_name">Medication Name</label>
                            <select id="medication_name" name="medication_name" required>
                                <option value="">Select medication...</option>
                                <option value="Warfarin">Warfarin</option>
                                <option value="Metformin">Metformin</option>
                                <option value="Atorvastatin">Atorvastatin</option>
                                <option value="Lisinopril">Lisinopril</option>
                                <option value="Amlodipine">Amlodipine</option>
                                <option value="Metoprolol">Metoprolol</option>
                                <option value="Omeprazole">Omeprazole</option>
                                <option value="Levothyroxine">Levothyroxine</option>
                                <option value="Aspirin">Aspirin</option>
                                <option value="Clopidogrel">Clopidogrel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="index_drug_dose">Drug Dose (mg)</label>
                            <input type="number" id="index_drug_dose" name="index_drug_dose" min="1" max="2000" step="0.1" placeholder="Enter dose (1-2000 mg)" required>
                        </div>
                        <div class="form-group">
                            <label for="concomitant_drugs_count">Concomitant Drugs Count</label>
                            <input type="number" id="concomitant_drugs_count" name="concomitant_drugs_count" min="0" max="20" placeholder="Number of other medications (0-20)" required>
                        </div>
                        <div class="form-group">
                            <label for="drug_interactions">Drug-Drug Interactions</label>
                            <select id="drug_interactions" name="drug_interactions" required>
                                <option value="">Select interaction level...</option>
                                <option value="None">None</option>
                                <option value="Minor">Minor</option>
                                <option value="Moderate">Moderate</option>
                                <option value="Major">Major</option>
                                <option value="Contraindicated">Contraindicated</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="indication">Indication</label>
                            <select id="indication" name="indication" required>
                                <option value="">Select indication...</option>
                                <option value="Pain">Pain Management</option>
                                <option value="Cancer">Cancer Treatment</option>
                                <option value="Cardiovascular">Cardiovascular Disease</option>
                                <option value="Diabetes">Diabetes</option>
                                <option value="Hypertension">Hypertension</option>
                                <option value="Infection">Infection</option>
                                <option value="Mental Health">Mental Health</option>
                                <option value="Respiratory">Respiratory Disease</option>
                                <option value="Gastrointestinal">Gastrointestinal</option>
                                <option value="Neurological">Neurological</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Pharmacogenomics -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-dna"></i>
                        <h3>Pharmacogenomics</h3>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="cyp2c9">CYP2C9 Status</label>
                            <select id="cyp2c9" name="cyp2c9" required>
                                <option value="">Select CYP2C9 status...</option>
                                <option value="Wild">Wild Type</option>
                                <option value="Intermediate">Intermediate</option>
                                <option value="Poor">Poor Metabolizer</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="cyp2d6">CYP2D6 Status</label>
                            <select id="cyp2d6" name="cyp2d6" required>
                                <option value="">Select CYP2D6 status...</option>
                                <option value="UM">Ultra-rapid Metabolizer</option>
                                <option value="EM">Extensive Metabolizer</option>
                                <option value="IM">Intermediate Metabolizer</option>
                                <option value="PM">Poor Metabolizer</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Additional Clinical Data -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-chart-line"></i>
                        <h3>Additional Clinical Data</h3>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="bp_systolic">Systolic BP (mmHg)</label>
                            <input type="number" id="bp_systolic" name="bp_systolic" min="80" max="250" placeholder="Normal: 90-140" required>
                        </div>
                        <div class="form-group">
                            <label for="bp_diastolic">Diastolic BP (mmHg)</label>
                            <input type="number" id="bp_diastolic" name="bp_diastolic" min="40" max="150" placeholder="Normal: 60-90" required>
                        </div>
                        <div class="form-group">
                            <label for="heart_rate">Heart Rate (bpm)</label>
                            <input type="number" id="heart_rate" name="heart_rate" min="40" max="200" placeholder="Normal: 60-100" required>
                        </div>
                        <div class="form-group">
                            <label for="time_since_start_days">Days Since Drug Start</label>
                            <input type="number" id="time_since_start_days" name="time_since_start_days" min="1" max="365" placeholder="Days (1-365)" required>
                        </div>
                    </div>
                    
                    <div class="checkbox-grid">
                        <div class="checkbox-group">
                            <input type="checkbox" id="cyp_inhibitors_flag" name="cyp_inhibitors_flag" value="1">
                            <label for="cyp_inhibitors_flag">CYP Inhibitors Present</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="qt_prolonging_flag" name="qt_prolonging_flag" value="1">
                            <label for="qt_prolonging_flag">QT Prolonging Drugs</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="hla_risk_allele_flag" name="hla_risk_allele_flag" value="1">
                            <label for="hla_risk_allele_flag">HLA Risk Allele</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="inpatient_flag" name="inpatient_flag" value="1">
                            <label for="inpatient_flag">Inpatient</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="prior_adr_history" name="prior_adr_history" value="1">
                            <label for="prior_adr_history">Prior ADR History</label>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-calculator"></i>
                        Assess ADR Risk
                    </button>
                    <button type="button" id="clear-form" class="btn btn-secondary">
                        <i class="fas fa-undo"></i>
                        Clear Form
                    </button>
                    <a href="/patient-details" class="btn btn-secondary">
                        <i class="fas fa-user"></i>
                        Back to Patient Details
                    </a>
                </div>
            </form>
        </div>

        <!-- Results Section -->
        <div id="results-container" class="results-container" style="display: none;">
            <div class="results-header">
                <h2><i class="fas fa-chart-bar"></i> Risk Assessment Results</h2>
            </div>
            
            <div class="results-layout">
                <!-- Left Column: Statistical Analysis -->
                <div class="analysis-column">
                    <div class="column-header">
                        <i class="fas fa-chart-line"></i>
                        <h3>Statistical Analysis</h3>
                    </div>
                    <div id="results-content" class="results-content">
                        <!-- Statistical results will be populated here -->
                    </div>
                </div>

                <!-- Right Column: AI Clinical Report -->
                <div class="report-column">
                    <div class="column-header">
                        <i class="fas fa-robot"></i>
                        <h3>AI Clinical Report</h3>
                        <span class="ai-badge">
                            <i class="fas fa-brain"></i>
                            Google Gemini AI
                        </span>
                    </div>
                    <div id="report-content" class="report-content">
                        <div class="report-loading">
                            <i class="fas fa-spinner"></i>
                            <p>Generating AI clinical report...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Information Modal -->
        <div id="info-modal" class="modal-overlay">
            <div class="modal-content">
                <button class="modal-close" onclick="closeInfoModal()">
                    <i class="fas fa-times"></i>
                </button>
                
                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-heartbeat"></i>
                        ADR Risk Predictor
                    </h2>
                    <p class="modal-subtitle">Advanced Clinical Decision Support System</p>
                </div>

                <div class="modal-section">
                    <h3><i class="fas fa-info-circle"></i> Project Overview</h3>
                    <p>The ADR Risk Predictor is an advanced machine learning-powered clinical decision support system designed to assess the risk of Adverse Drug Reactions (ADRs) in patients. This tool helps healthcare professionals make informed decisions about medication safety and patient care.</p>
                </div>

                <div class="modal-section">
                    <h3><i class="fas fa-cogs"></i> How It Works</h3>
                    <p>Our system uses a sophisticated machine learning model trained on clinical data to predict ADR risk based on:</p>
                    <ul>
                        <li>Patient demographics and medical history</li>
                        <li>Laboratory values and vital signs</li>
                        <li>Current medications and drug interactions</li>
                        <li>Pharmacogenomic factors (CYP enzyme status)</li>
                        <li>Comorbidities and risk factors</li>
                    </ul>
                </div>

                <div class="modal-section">
                    <h3><i class="fas fa-star"></i> Key Features</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <i class="fas fa-brain"></i>
                            <h4>AI-Powered Analysis</h4>
                            <p>Machine learning algorithms for accurate risk prediction</p>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-robot"></i>
                            <h4>Gemini AI Reports</h4>
                            <p>Comprehensive clinical reports generated by Google Gemini AI</p>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-shield-alt"></i>
                            <h4>Risk Stratification</h4>
                            <p>Clear Low/Medium/High risk classification with detailed insights</p>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-chart-bar"></i>
                            <h4>Real-time Results</h4>
                            <p>Instant assessment with probability breakdowns</p>
                        </div>
                    </div>
                </div>

                <div class="modal-section">
                    <h3><i class="fas fa-user-md"></i> Clinical Applications</h3>
                    <p>This system is designed for healthcare professionals to:</p>
                    <ul>
                        <li>Assess ADR risk before prescribing medications</li>
                        <li>Monitor high-risk patients more closely</li>
                        <li>Make informed decisions about drug selection and dosing</li>
                        <li>Generate comprehensive clinical reports for documentation</li>
                        <li>Improve patient safety and medication management</li>
                    </ul>
                </div>

                <div class="modal-section">
                    <h3><i class="fas fa-exclamation-triangle"></i> Important Disclaimer</h3>
                    <p><strong>This tool is for educational and research purposes only.</strong> It should not be used as a substitute for professional medical judgment. Always consult with qualified healthcare professionals for clinical decision-making.</p>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="closeInfoModal()">
                        <i class="fas fa-check"></i>
                        Got It
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay" style="display: none;">
            <div class="loading-content">
                <div class="spinner"></div>
                <p id="loading-text">Processing assessment...</p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentPatientData = {};
        let currentPredictionResult = {};

        // Initialize patient info from session storage
        function initializePatientInfo() {
            const patientName = sessionStorage.getItem('patientName') || 'Patient';
            const clinicianName = sessionStorage.getItem('clinicianName') || 'Clinician';
            const patientId = sessionStorage.getItem('patientId') || '0';
            
            document.getElementById('patient-name-display').textContent = patientName;
            document.getElementById('clinician-name-display').textContent = clinicianName;
            document.getElementById('timestamp-display').textContent = new Date().toLocaleString();
        }

        // BMI Calculation
        function calculateBMI() {
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);
            
            if (height && weight && height > 0) {
                const heightInMeters = height / 100;
                const bmi = weight / (heightInMeters * heightInMeters);
                
                document.getElementById('bmi').value = bmi.toFixed(1);
                document.getElementById('bmi-value').textContent = bmi.toFixed(1);
                
                let category = '';
                let categoryClass = '';
                
                if (bmi < 18.5) {
                    category = 'Underweight';
                    categoryClass = 'underweight';
                } else if (bmi < 25) {
                    category = 'Normal';
                    categoryClass = 'normal';
                } else if (bmi < 30) {
                    category = 'Overweight';
                    categoryClass = 'overweight';
                } else {
                    category = 'Obese';
                    categoryClass = 'obese';
                }
                
                const categoryElement = document.getElementById('bmi-category');
                categoryElement.textContent = category;
                categoryElement.className = `bmi-category ${categoryClass}`;
            } else {
                document.getElementById('bmi').value = '';
                document.getElementById('bmi-value').textContent = '--';
                document.getElementById('bmi-category').textContent = 'Enter height & weight';
                document.getElementById('bmi-category').className = 'bmi-category';
            }
        }

        // Load sample data
        async function loadSampleData(sampleType) {
            try {
                console.log(`Loading sample data for type: ${sampleType}`);
                showLoading();
                
                const url = `/sample_data/${sampleType}`;
                console.log(`Fetching from URL: ${url}`);
                
                const response = await fetch(url);
                console.log(`Response status: ${response.status}`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`Server error: ${errorText}`);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const sampleData = await response.json();
                console.log('Sample data received:', sampleData);
                
                // Populate form fields
                Object.keys(sampleData).forEach(key => {
                    const field = document.getElementById(key);
                    if (field) {
                        if (field.type === 'checkbox') {
                            field.checked = sampleData[key] === 1;
                        } else {
                            field.value = sampleData[key];
                        }
                        console.log(`Set field ${key} to ${sampleData[key]}`);
                    } else {
                        console.warn(`Field not found: ${key}`);
                    }
                });
                
                // Trigger BMI calculation if height and weight are loaded
                if (sampleData.height && sampleData.weight) {
                    calculateBMI();
                }
                
                showNotification(`Sample data loaded: ${sampleData.name}`, 'success');
                
            } catch (error) {
                console.error('Error loading sample data:', error);
                
                // Fallback to local sample data if server is not available
                console.log('Attempting to use fallback sample data...');
                const fallbackData = getFallbackSampleData(sampleType);
                if (fallbackData) {
                    // Populate form fields with fallback data
                    Object.keys(fallbackData).forEach(key => {
                        const field = document.getElementById(key);
                        if (field) {
                            if (field.type === 'checkbox') {
                                field.checked = fallbackData[key] === 1;
                            } else {
                                field.value = fallbackData[key];
                            }
                        }
                    });
                    
                    // Trigger BMI calculation
                    if (fallbackData.height && fallbackData.weight) {
                        calculateBMI();
                    }
                    
                    showNotification(`Fallback sample data loaded: ${fallbackData.name}`, 'success');
                } else {
                    showNotification(`Failed to load sample data: ${error.message}`, 'error');
                }
            } finally {
                hideLoading();
            }
        }

        // Fallback sample data (in case server is not available)
        function getFallbackSampleData(sampleType) {
            const fallbackSamples = {
                'high-risk': {
                    name: 'High Risk Patient',
                    age: 75, sex: 'M', ethnicity: 'White', height: 175, weight: 95,
                    creatinine: 2.1, egfr: 35, ast_alt: 95, bilirubin: 1.8, albumin: 2.8,
                    diabetes: 1, liver_disease: 1, ckd: 1, cardiac_disease: 1, hypertension: 1,
                    medication_name: 'Warfarin', index_drug_dose: 200, drug_interactions: 'Major',
                    concomitant_drugs_count: 12, indication: 'Cardiovascular',
                    cyp2c9: 'Poor', cyp2d6: 'PM', bp_systolic: 165, bp_diastolic: 95,
                    heart_rate: 95, time_since_start_days: 45
                },
                'medium-risk': {
                    name: 'Medium Risk Patient',
                    age: 55, sex: 'F', ethnicity: 'Asian', height: 160, weight: 70,
                    creatinine: 1.3, egfr: 65, ast_alt: 45, bilirubin: 0.8, albumin: 3.5,
                    diabetes: 1, cardiac_disease: 1, hypertension: 1,
                    medication_name: 'Metformin', index_drug_dose: 150, drug_interactions: 'Moderate',
                    concomitant_drugs_count: 6, indication: 'Diabetes',
                    cyp2c9: 'Intermediate', cyp2d6: 'IM', bp_systolic: 140, bp_diastolic: 85,
                    heart_rate: 78, time_since_start_days: 30
                },
                'low-risk': {
                    name: 'Low Risk Patient',
                    age: 35, sex: 'M', ethnicity: 'White', height: 180, weight: 78,
                    creatinine: 0.9, egfr: 95, ast_alt: 25, bilirubin: 0.5, albumin: 4.2,
                    medication_name: 'Lisinopril', index_drug_dose: 100, drug_interactions: 'Minor',
                    concomitant_drugs_count: 2, indication: 'Hypertension',
                    cyp2c9: 'Wild', cyp2d6: 'EM', bp_systolic: 120, bp_diastolic: 75,
                    heart_rate: 68, time_since_start_days: 14
                }
            };
            
            return fallbackSamples[sampleType] || null;
        }

        // Information modal functions
        function showInfoModal() {
            const modal = document.getElementById('info-modal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeInfoModal() {
            const modal = document.getElementById('info-modal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Close modal when clicking outside
        document.getElementById('info-modal').addEventListener('click', (e) => {
            if (e.target.id === 'info-modal') {
                closeInfoModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeInfoModal();
            }
        });

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 4000);
        }

        // Show loading
        function showLoading() {
            document.getElementById('loading-overlay').style.display = 'flex';
        }

        // Hide loading
        function hideLoading() {
            document.getElementById('loading-overlay').style.display = 'none';
        }

        // Form submission handler
        document.getElementById('adr-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                showLoading();
                
                // Collect form data
                const formData = new FormData(e.target);
                const patientData = {};
                
                // Process form data
                for (let [key, value] of formData.entries()) {
                    if (value === '') continue;
                    
                    // Handle checkboxes
                    if (['diabetes', 'liver_disease', 'ckd', 'cardiac_disease', 'hypertension', 
                        'respiratory_disease', 'neurological_disease', 'autoimmune_disease',
                        'cyp_inhibitors_flag', 'qt_prolonging_flag', 'hla_risk_allele_flag', 
                        'inpatient_flag', 'prior_adr_history'].includes(key)) {
                        patientData[key] = 1;
                    } else {
                        // Convert numeric fields
                        if (['age', 'height', 'weight', 'bmi', 'creatinine', 'egfr', 'ast_alt', 
                            'bilirubin', 'albumin', 'index_drug_dose', 'concomitant_drugs_count', 
                            'bp_systolic', 'bp_diastolic', 'heart_rate', 'time_since_start_days'].includes(key)) {
                            patientData[key] = parseFloat(value);
                        } else {
                            patientData[key] = value;
                        }
                    }
                }
                
                // Set default values for unchecked checkboxes
                const checkboxFields = ['diabetes', 'liver_disease', 'ckd', 'cardiac_disease', 'hypertension', 
                    'respiratory_disease', 'neurological_disease', 'autoimmune_disease',
                    'cyp_inhibitors_flag', 'qt_prolonging_flag', 'hla_risk_allele_flag', 
                    'inpatient_flag', 'prior_adr_history'];
                
                checkboxFields.forEach(field => {
                    if (!(field in patientData)) {
                        patientData[field] = 0;
                    }
                });
                
                // Calculate derived fields required by the model
                patientData.polypharmacy_flag = patientData.concomitant_drugs_count > 5 ? 1 : 0;
                patientData.cumulative_dose_mg = patientData.index_drug_dose * patientData.time_since_start_days;
                patientData.dose_density_mg_day = patientData.cumulative_dose_mg / patientData.time_since_start_days;
                
                console.log('Sending patient data:', patientData);
                
                // Make prediction request
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(patientData)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
                }
                
                const result = await response.json();
                console.log('Prediction result:', result);
                
                // Store current data
                currentPatientData = patientData;
                currentPredictionResult = result;
                
                // Display results
                displayResults(result);
                
                // Automatically generate AI report
                generateAIReport();
                
                showNotification('ADR risk assessment completed successfully!', 'success');
                
            } catch (error) {
                console.error('Error:', error);
                showNotification(`Failed to assess ADR risk: ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        });

        // Format AI report text for better display
        function formatAIReport(reportText) {
            if (!reportText) return '';
            
            let formatted = reportText;
            
            // Convert markdown-style headers to HTML
            formatted = formatted.replace(/^## (.*$)/gm, '<h2>$1</h2>');
            formatted = formatted.replace(/^### (.*$)/gm, '<h3>$1</h3>');
            formatted = formatted.replace(/^#### (.*$)/gm, '<h4>$1</h4>');
            formatted = formatted.replace(/^# (.*$)/gm, '<h1>$1</h1>');
            
            // Convert **bold** to <strong>
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Convert *italic* to <em>
            formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Convert bullet points
            formatted = formatted.replace(/^- (.*$)/gm, '<li>$1</li>');
            formatted = formatted.replace(/^• (.*$)/gm, '<li>$1</li>');
            
            // Wrap consecutive list items in <ul>
            formatted = formatted.replace(/(<li>.*<\/li>)/gs, function(match) {
                return '<ul>' + match + '</ul>';
            });
            
            // Convert numbered lists
            formatted = formatted.replace(/^\d+\. (.*$)/gm, '<li>$1</li>');
            
            // Highlight risk levels
            formatted = formatted.replace(/\b(HIGH RISK|High Risk|high risk)\b/gi, '<span class="risk-high">HIGH RISK</span>');
            formatted = formatted.replace(/\b(MEDIUM RISK|Medium Risk|medium risk|MODERATE RISK|Moderate Risk|moderate risk)\b/gi, '<span class="risk-medium">MEDIUM RISK</span>');
            formatted = formatted.replace(/\b(LOW RISK|Low Risk|low risk)\b/gi, '<span class="risk-low">LOW RISK</span>');
            
            // Highlight medical terms
            const medicalTerms = [
                'ADR', 'adverse drug reaction', 'pharmacokinetics', 'pharmacodynamics',
                'CYP2D6', 'CYP2C9', 'metabolism', 'hepatotoxicity', 'nephrotoxicity',
                'cardiotoxicity', 'QT prolongation', 'drug interaction', 'contraindication',
                'monitoring', 'dose adjustment', 'therapeutic drug monitoring'
            ];
            
            medicalTerms.forEach(term => {
                const regex = new RegExp(`\\b(${term})\\b`, 'gi');
                formatted = formatted.replace(regex, '<span class="medical-term">$1</span>');
            });
            
            // Convert line breaks to paragraphs
            formatted = formatted.split('\n\n').map(paragraph => {
                if (paragraph.trim() && !paragraph.includes('<h') && !paragraph.includes('<ul>') && !paragraph.includes('<li>')) {
                    return `<p>${paragraph.trim()}</p>`;
                }
                return paragraph;
            }).join('\n');
            
            // Clean up extra line breaks
            formatted = formatted.replace(/\n/g, '');
            
            // Add spacing between sections
            formatted = formatted.replace(/<\/h2>/g, '</h2><div style="margin-bottom: 15px;"></div>');
            formatted = formatted.replace(/<\/h3>/g, '</h3><div style="margin-bottom: 10px;"></div>');
            
            return formatted;
        }

        // Generate AI Report automatically
        async function generateAIReport() {
            try {
                const reportContent = document.getElementById('report-content');
                
                // Show loading state
                reportContent.innerHTML = `
                    <div class="report-loading">
                        <i class="fas fa-spinner"></i>
                        <p>Generating AI clinical report...</p>
                        <p style="font-size: 0.9rem; color: #6b7280; margin-top: 10px;">This may take a few moments...</p>
                    </div>
                `;
                
                const requestData = {
                    patient_data: currentPatientData,
                    prediction_result: currentPredictionResult,
                    patient_name: sessionStorage.getItem('patientName') || 'Patient',
                    patient_id: sessionStorage.getItem('patientId') || '',
                    clinician_name: sessionStorage.getItem('clinicianName') || 'Clinician'
                };
                
                const response = await fetch('/generate_report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const reportResult = await response.json();
                
                // Display the AI-generated report with enhanced formatting
                const formattedReport = formatAIReport(reportResult.report);
                reportContent.innerHTML = `
                    <div class="ai-report-content">
                        ${formattedReport}
                    </div>
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e5e7eb; text-align: center;">
                        <div style="display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: 600;">
                            <i class="fas fa-robot"></i>
                            Generated by Google Gemini AI
                        </div>
                        <div style="margin-top: 8px; font-size: 0.8rem; color: #6b7280;">
                            ${new Date().toLocaleString()}
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Error generating AI report:', error);
                document.getElementById('report-content').innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #ef4444;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <h4 style="margin-bottom: 10px;">Report Generation Failed</h4>
                        <p>Unable to generate AI clinical report: ${error.message}</p>
                        <button onclick="generateAIReport()" class="btn btn-secondary" style="margin-top: 15px;">
                            <i class="fas fa-redo"></i> Try Again
                        </button>
                    </div>
                `;
            }
        }

        // Generate specific ADR type risks display
        function generateSpecificADRTypes(result) {
            const specificADRs = result.all_adr_types || result.top_specific_adr_risks || {};
            
            if (!specificADRs || Object.keys(specificADRs).length === 0) {
                return '';
            }
            
            // Sort ADR types by probability
            const sortedADRs = Object.entries(specificADRs)
                .filter(([adr, prob]) => adr !== 'No ADR')
                .sort(([,a], [,b]) => b - a)
                .slice(0, 6); // Show top 6 specific ADR types
            
            const getADRRiskLevel = (prob) => {
                if (prob >= 15) return { level: 'HIGH RISK', color: '#ef4444', bgColor: '#fef2f2', borderColor: '#fecaca' };
                if (prob >= 5) return { level: 'MEDIUM RISK', color: '#f59e0b', bgColor: '#fffbeb', borderColor: '#fed7aa' };
                return { level: 'LOW RISK', color: '#10b981', bgColor: '#f0fdf4', borderColor: '#bbf7d0' };
            };
            
            const getADRIcon = (adrType) => {
                if (adrType.toLowerCase().includes('cardiovascular') || adrType.toLowerCase().includes('tachycardia')) return 'fas fa-heartbeat';
                if (adrType.toLowerCase().includes('hepato') || adrType.toLowerCase().includes('liver')) return 'fas fa-liver';
                if (adrType.toLowerCase().includes('nephro') || adrType.toLowerCase().includes('kidney')) return 'fas fa-kidneys';
                if (adrType.toLowerCase().includes('hypotension')) return 'fas fa-tint';
                if (adrType.toLowerCase().includes('rash') || adrType.toLowerCase().includes('skin')) return 'fas fa-hand-paper';
                return 'fas fa-exclamation-circle';
            };
            
            return `
                <div style="background: linear-gradient(135deg, #fef7ff 0%, #f3e8ff 100%); padding: 20px; border-radius: 12px; border-left: 4px solid #a855f7; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 20px 0; color: #581c87; font-size: 1.2rem; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-chart-pie" style="color: #a855f7;"></i>
                        Specific ADR Type Risks
                    </h4>
                    
                    <div class="specific-adr-types-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        ${sortedADRs.map(([adrType, probability]) => {
                            const risk = getADRRiskLevel(probability);
                            const icon = getADRIcon(adrType);
                            return `
                                <div class="adr-type-card" style="background: ${risk.bgColor}; border: 2px solid ${risk.borderColor}; border-radius: 12px; padding: 16px; position: relative; transition: all 0.3s ease; cursor: pointer;" 
                                     onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.1)'" 
                                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                                        <div style="background: ${risk.color}; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                            <i class="${icon}" style="font-size: 1rem;"></i>
                                        </div>
                                        <h5 style="color: #374151; font-size: 1rem; font-weight: 600; margin: 0; flex: 1; line-height: 1.3;">${adrType}</h5>
                                    </div>
                                    <div style="text-align: center; margin-bottom: 12px;">
                                        <div class="adr-probability" style="font-size: 2.2rem; font-weight: 700; color: ${risk.color}; line-height: 1;">${probability}%</div>
                                        <div style="font-size: 0.8rem; color: #6b7280; margin-top: 2px;">Probability</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <span class="risk-badge" style="background: ${risk.color}; color: white; padding: 6px 14px; border-radius: 16px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; display: inline-block;">
                                            ${risk.level}
                                        </span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    ${sortedADRs.length > 6 ? `
                        <div style="background: white; padding: 12px 16px; border-radius: 8px; border: 1px solid #e5e7eb; text-align: center;">
                            <i class="fas fa-info-circle" style="color: #6b7280; margin-right: 8px;"></i>
                            <span style="color: #6b7280; font-size: 0.9rem;">
                                ${Object.keys(specificADRs).length - 6} additional ADR types monitored with lower probabilities
                            </span>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Generate medication suggestions based on risk assessment
        function generateMedicationSuggestions(result) {
            const currentMedication = currentPatientData.medication_name || 'Current medication';
            const riskLevel = result.risk_level;
            const predictedADR = result.predicted_adr_type;
            
            let suggestions = [];
            let alternatives = [];
            
            // Generate suggestions based on risk level and predicted ADR
            if (riskLevel === 'High') {
                suggestions.push('Consider immediate dose reduction or medication discontinuation');
                suggestions.push('Implement enhanced monitoring protocols');
                suggestions.push('Evaluate alternative therapeutic options');
            } else if (riskLevel === 'Medium') {
                suggestions.push('Consider dose adjustment based on patient response');
                suggestions.push('Increase monitoring frequency');
                suggestions.push('Review for drug interactions');
            } else {
                suggestions.push('Continue current therapy with standard monitoring');
                suggestions.push('Regular follow-up assessments recommended');
            }
            
            // Generate alternative medications based on current medication and risk
            const medicationAlternatives = {
                'Warfarin': ['Apixaban', 'Rivaroxaban', 'Dabigatran'],
                'Metformin': ['Sitagliptin', 'Empagliflozin', 'Liraglutide'],
                'Atorvastatin': ['Rosuvastatin', 'Pravastatin', 'Pitavastatin'],
                'Lisinopril': ['Losartan', 'Valsartan', 'Telmisartan'],
                'Amlodipine': ['Nifedipine XL', 'Felodipine', 'Clevidipine'],
                'Metoprolol': ['Carvedilol', 'Bisoprolol', 'Nebivolol']
            };
            
            alternatives = medicationAlternatives[currentMedication] || ['Consult specialist for alternatives'];
            
            return `
                <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 20px; border-radius: 12px; border-left: 4px solid #0ea5e9; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; color: #0c4a6e; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-pills" style="color: #0ea5e9;"></i>
                        Medication Recommendations
                    </h4>
                    <div style="margin-bottom: 15px;">
                        <h5 style="color: #0c4a6e; margin: 0 0 8px 0; font-size: 1rem;">Clinical Suggestions:</h5>
                        ${suggestions.map(suggestion => `
                            <div style="display: flex; align-items: flex-start; gap: 8px; margin-bottom: 6px;">
                                <i class="fas fa-check-circle" style="color: #10b981; margin-top: 2px; font-size: 0.9rem;"></i>
                                <span style="color: #374151; font-size: 0.95rem;">${suggestion}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div>
                        <h5 style="color: #0c4a6e; margin: 0 0 8px 0; font-size: 1rem;">Alternative Medications:</h5>
                        <div class="medication-alternatives" style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${alternatives.map(alt => `
                                <div class="medication-alt" style="background: white; padding: 8px 14px; border-radius: 20px; border: 1px solid #bae6fd; color: #0c4a6e; font-size: 0.9rem; font-weight: 500; flex: 1; min-width: 120px; text-align: center;">
                                    ${alt}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Generate clinical suggestions based on risk assessment
        function generateClinicalSuggestions(result) {
            const riskLevel = result.risk_level;
            const predictedADR = result.predicted_adr_type;
            
            let monitoringParams = [];
            let clinicalActions = [];
            let followUpSchedule = '';
            
            // Generate monitoring parameters based on predicted ADR
            if (predictedADR.includes('Cardiovascular') || predictedADR.includes('Tachycardia')) {
                monitoringParams.push('ECG monitoring', 'Blood pressure checks', 'Heart rate monitoring');
                clinicalActions.push('Cardiac consultation if symptoms develop', 'Avoid QT-prolonging drugs');
            } else if (predictedADR.includes('Hepatotoxicity') || predictedADR.includes('Liver')) {
                monitoringParams.push('Liver function tests (AST/ALT)', 'Bilirubin levels', 'Clinical signs of jaundice');
                clinicalActions.push('Discontinue if ALT >3x ULN', 'Avoid hepatotoxic drugs');
            } else if (predictedADR.includes('Nephrotoxicity') || predictedADR.includes('Kidney')) {
                monitoringParams.push('Serum creatinine', 'eGFR calculation', 'Urine output monitoring');
                clinicalActions.push('Dose adjustment for renal function', 'Avoid nephrotoxic agents');
            } else {
                monitoringParams.push('Vital signs', 'Clinical symptoms', 'Laboratory parameters');
                clinicalActions.push('Regular clinical assessment', 'Patient symptom monitoring');
            }
            
            // Set follow-up schedule based on risk level
            if (riskLevel === 'High') {
                followUpSchedule = 'Weekly for first month, then bi-weekly';
            } else if (riskLevel === 'Medium') {
                followUpSchedule = 'Bi-weekly for first month, then monthly';
            } else {
                followUpSchedule = 'Monthly for first 3 months, then quarterly';
            }
            
            return `
                <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 20px; border-radius: 12px; border-left: 4px solid #22c55e; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 15px 0; color: #14532d; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-stethoscope" style="color: #22c55e;"></i>
                        Clinical Management Plan
                    </h4>
                    
                    <div style="margin-bottom: 15px;">
                        <h5 style="color: #14532d; margin: 0 0 8px 0; font-size: 1rem;">Monitoring Parameters:</h5>
                        <div class="monitoring-params" style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${monitoringParams.map(param => `
                                <div class="monitoring-param" style="background: white; padding: 8px 14px; border-radius: 16px; border: 1px solid #bbf7d0; color: #14532d; font-size: 0.9rem; font-weight: 500; flex: 1; min-width: 140px; text-align: center;">
                                    <i class="fas fa-heartbeat" style="color: #22c55e; margin-right: 6px; font-size: 0.8rem;"></i>
                                    ${param}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h5 style="color: #14532d; margin: 0 0 8px 0; font-size: 1rem;">Clinical Actions:</h5>
                        ${clinicalActions.map(action => `
                            <div style="display: flex; align-items: flex-start; gap: 8px; margin-bottom: 6px;">
                                <i class="fas fa-arrow-right" style="color: #22c55e; margin-top: 2px; font-size: 0.9rem;"></i>
                                <span style="color: #374151; font-size: 0.95rem;">${action}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="background: white; padding: 12px 16px; border-radius: 8px; border: 1px solid #bbf7d0;">
                        <h5 style="color: #14532d; margin: 0 0 6px 0; font-size: 1rem;">Follow-up Schedule:</h5>
                        <span style="color: #374151; font-weight: 500;">${followUpSchedule}</span>
                    </div>
                </div>
            `;
        }

        // Check if mobile device
        function isMobile() {
            return window.innerWidth <= 768;
        }

        // Display results function
        function displayResults(result) {
            const resultsContainer = document.getElementById('results-container');
            const resultsContent = document.getElementById('results-content');
            
            if (resultsContainer && resultsContent) {
                const riskColor = {
                    'Low': '#10b981',
                    'Medium': '#f59e0b', 
                    'High': '#ef4444'
                }[result.risk_level] || '#6b7280';
                
                const isMobileView = isMobile();
                const gridStyle = isMobileView ? 
                    'display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px;' :
                    'display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;';
                
                const cardPadding = isMobileView ? '15px' : '20px';
                const titleSize = isMobileView ? '1rem' : '1.2rem';
                const valueSize = isMobileView ? '1.5rem' : '2rem';
                
                resultsContent.innerHTML = `
                    <div style="background: white; padding: ${isMobileView ? '15px' : '25px'}; border-radius: 16px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);">
                        <div style="${gridStyle}">
                            <div style="text-align: center; padding: ${cardPadding}; background: ${riskColor}; color: white; border-radius: 12px;">
                                <h3 style="margin: 0 0 10px 0; font-size: ${titleSize};">Risk Level</h3>
                                <div style="font-size: ${valueSize}; font-weight: 700;">${result.risk_level}</div>
                            </div>
                            <div style="text-align: center; padding: ${cardPadding}; background: #f8fafc; border-radius: 12px; border: 2px solid #e5e7eb;">
                                <h3 style="margin: 0 0 10px 0; font-size: ${titleSize}; color: #374151;">Predicted ADR</h3>
                                <div style="font-size: ${isMobileView ? '1.2rem' : '1.5rem'}; font-weight: 600; color: #1f2937; line-height: 1.2;">${result.predicted_adr_type}</div>
                            </div>
                            <div style="text-align: center; padding: ${cardPadding}; background: #f0f9ff; border-radius: 12px; border: 2px solid #bae6fd;">
                                <h3 style="margin: 0 0 10px 0; font-size: ${titleSize}; color: #0c4a6e;">No ADR Probability</h3>
                                <div style="font-size: ${valueSize}; font-weight: 700; color: #1e40af;">${result.no_adr_probability}%</div>
                            </div>
                        </div>
                        
                        ${result.top_adr_risks ? `
                        <div style="background: #f8fafc; padding: 20px; border-radius: 12px; border: 1px solid #e5e7eb; margin-bottom: 20px;">
                            <h4 style="margin: 0 0 15px 0; color: #374151; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-exclamation-triangle" style="color: #f59e0b;"></i>
                                Top ADR Risk Probabilities
                            </h4>
                            ${Object.entries(result.top_adr_risks).slice(0, 5).map(([adr, prob]) => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e5e7eb;">
                                    <span style="font-weight: 500; color: #1f2937; flex: 1;">${adr}</span>
                                    <span style="font-weight: 700; color: #667eea; font-size: 1.1rem;">${prob}%</span>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                        
                        ${generateSpecificADRTypes(result)}
                        
                        ${generateMedicationSuggestions(result)}
                        ${generateClinicalSuggestions(result)}
                    </div>
                `;
                resultsContainer.style.display = 'block';
                resultsContainer.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Clear form handler
        document.getElementById('clear-form').addEventListener('click', () => {
            if (confirm('Are you sure you want to clear all form data?')) {
                document.getElementById('adr-form').reset();
                document.getElementById('bmi').value = '';
                document.getElementById('bmi-value').textContent = '--';
                document.getElementById('bmi-category').textContent = 'Enter height & weight';
                document.getElementById('bmi-category').className = 'bmi-category';
                showNotification('Form cleared successfully', 'success');
            }
        });

        // Sample data selector handler - automatic loading
        document.getElementById('sample-data-selector').addEventListener('change', (e) => {
            if (e.target.value) {
                loadSampleData(e.target.value);
                // Don't reset selector to show which sample is loaded
            }
        });

        // Information button handler
        document.getElementById('info-button').addEventListener('click', () => {
            showInfoModal();
        });

        // Setup BMI calculation listeners
        document.getElementById('height').addEventListener('input', calculateBMI);
        document.getElementById('weight').addEventListener('input', calculateBMI);

        // Test server connectivity
        async function testServerConnection() {
            try {
                const response = await fetch('/test');
                if (response.ok) {
                    const data = await response.json();
                    console.log('Server connection test successful:', data);
                    return true;
                } else {
                    console.error('Server connection test failed:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('Server connection error:', error);
                showNotification('Server connection failed. Please check if the server is running.', 'error');
                return false;
            }
        }

        // Handle window resize for responsive updates
        function handleResize() {
            // Force re-render of results if they exist
            if (currentPredictionResult && Object.keys(currentPredictionResult).length > 0) {
                displayResults(currentPredictionResult);
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializePatientInfo();
            
            // Test server connection
            testServerConnection();
            
            // Add resize listener for responsive updates
            window.addEventListener('resize', handleResize);
            
            // Add orientation change listener for mobile
            window.addEventListener('orientationchange', function() {
                setTimeout(handleResize, 100);
            });
            
            // Show loading animation initially
            showLoading();
            setTimeout(() => {
                hideLoading();
            }, 1500);
        });
    </script>
</body>
</html>