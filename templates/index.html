<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ADR Risk Predictor - Clinical Decision Support</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            color: #e2e8f0;
            line-height: 1.6;
            position: relative;
        }

        /* Medical grid background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                linear-gradient(rgba(79, 209, 197, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(79, 209, 197, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes gridMove {
            0% {
                transform: translate(0, 0);
            }

            100% {
                transform: translate(50px, 50px);
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header-card {
            background: rgba(15, 32, 39, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(79, 209, 197, 0.2);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            align-items: center;
        }

        .header-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(79, 209, 197, 0.1);
            border-radius: 12px;
            border-left: 4px solid #4fd1c5;
            transition: all 0.3s ease;
        }

        .header-item:hover {
            background: rgba(79, 209, 197, 0.15);
            transform: translateY(-2px);
        }

        .header-item i {
            color: #4fd1c5;
            font-size: 1.2rem;
        }

        .header-item-content {
            display: flex;
            flex-direction: column;
        }

        .header-label {
            font-size: 0.8rem;
            color: #a0aec0;
            font-weight: 500;
        }

        .header-value {
            font-size: 1rem;
            color: #e2e8f0;
            font-weight: 600;
        }

        /* Form Container */
        .form-container {
            background: rgba(15, 32, 39, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            margin-bottom: 30px;
            border: 1px solid rgba(79, 209, 197, 0.2);
        }

        .form-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(79, 209, 197, 0.2);
        }

        .form-title {
            font-size: 2rem;
            background: linear-gradient(135deg, #4fd1c5 0%, #63b3ed 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .form-subtitle {
            color: #a0aec0;
            font-size: 1.1rem;
        }

        /* Sample Data Controls */
        .sample-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn-sample {
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
            color: #0f2027;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(79, 209, 197, 0.3);
        }

        .btn-sample:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 209, 197, 0.5);
        }

        .sample-selector {
            padding: 12px 16px;
            border: 2px solid rgba(79, 209, 197, 0.3);
            border-radius: 12px;
            background: rgba(15, 32, 39, 0.6);
            color: #e2e8f0;
            font-weight: 500;
            min-width: 200px;
            cursor: pointer;
        }

        .sample-selector:focus {
            outline: none;
            border-color: #4fd1c5;
            box-shadow: 0 0 0 3px rgba(79, 209, 197, 0.2);
        }

        .sample-selector option {
            background: #1a2f3a;
            color: #e2e8f0;
        }

        .sample-selector optgroup {
            font-weight: 700;
            color: #374151;
            background: #f8fafc;
            padding: 8px 0;
        }

        .sample-selector option {
            padding: 8px 12px;
            color: #1f2937;
            background: white;
        }

        .sample-selector option:hover {
            background: #f0f4ff;
        }

        /* Sample indication styling */
        .sample-indication {
            text-align: center;
            margin: 20px 0 10px 0;
            padding: 15px;
            background: rgba(79, 209, 197, 0.1);
            border-radius: 12px;
            border-left: 4px solid #4fd1c5;
            border: 1px solid rgba(79, 209, 197, 0.2);
        }

        .sample-indication-title {
            color: #4fd1c5;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .sample-indication-subtitle {
            color: #a0aec0;
            font-size: 0.9rem;
            margin-bottom: 0;
        }

        /* Form Sections */
        .form-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(79, 209, 197, 0.15);
            backdrop-filter: blur(10px);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(79, 209, 197, 0.2);
        }

        .section-header i {
            color: #4fd1c5;
            font-size: 1.3rem;
        }

        .section-header h3 {
            color: #e2e8f0;
            font-size: 1.4rem;
            font-weight: 700;
            margin: 0;
        }

        /* Form Grid */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #cbd5e0;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            padding: 14px 16px;
            border: 2px solid rgba(79, 209, 197, 0.3);
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(15, 32, 39, 0.6);
            color: #e2e8f0;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4fd1c5;
            box-shadow: 0 0 0 3px rgba(79, 209, 197, 0.2);
            transform: translateY(-1px);
            background: rgba(15, 32, 39, 0.8);
        }

        .form-group input::placeholder {
            color: #718096;
            font-weight: 400;
        }

        .form-group select option {
            background: #1a2f3a;
            color: #e2e8f0;
        }

        /* BMI Display */
        .bmi-display {
            margin-top: 10px;
            padding: 12px;
            background: rgba(79, 209, 197, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(79, 209, 197, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bmi-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #4fd1c5;
        }

        .bmi-category {
            font-size: 0.9rem;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bmi-category.normal {
            background: #d1fae5;
            color: #065f46;
        }

        .bmi-category.overweight {
            background: #fed7aa;
            color: #9a3412;
        }

        .bmi-category.obese {
            background: #fecaca;
            color: #991b1b;
        }

        .bmi-category.underweight {
            background: #dbeafe;
            color: #1e40af;
        }

        /* Checkbox Grid */
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(79, 209, 197, 0.2);
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .checkbox-group:hover {
            border-color: #4fd1c5;
            background: rgba(79, 209, 197, 0.1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 209, 197, 0.2);
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #4fd1c5;
            cursor: pointer;
        }

        .checkbox-group label {
            font-weight: 600;
            color: #cbd5e0;
            cursor: pointer;
            margin: 0;
            flex: 1;
        }

        .checkbox-group:has(input[type="checkbox"]:checked) {
            border-color: #4fd1c5;
            background: rgba(79, 209, 197, 0.15);
            box-shadow: 0 0 15px rgba(79, 209, 197, 0.3);
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid rgba(79, 209, 197, 0.2);
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            min-width: 160px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
            color: #0f2027;
            box-shadow: 0 8px 25px rgba(79, 209, 197, 0.4);
            font-weight: 700;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(79, 209, 197, 0.6);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border: 2px solid rgba(79, 209, 197, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #4fd1c5;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 209, 197, 0.3);
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 32, 39, 0.98);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-content {
            background: rgba(15, 32, 39, 0.95);
            border: 1px solid rgba(79, 209, 197, 0.3);
            padding: 50px 60px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            max-width: 500px;
        }

        .loading-content p {
            color: #e2e8f0;
            font-size: 1.1rem;
            font-weight: 500;
            margin-top: 25px;
        }

        /* Medical Logo for Loading */
        .loading-medical-logo {
            position: relative;
            width: 140px;
            height: 140px;
            margin: 0 auto 20px;
        }

        .loading-logo-circle {
            position: absolute;
            width: 120px;
            height: 120px;
            left: 10px;
            top: 10px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(79, 209, 197, 0.2) 0%, rgba(99, 179, 237, 0.2) 100%);
            border: 3px solid rgba(79, 209, 197, 0.4);
            animation: pulseCircle 3s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(79, 209, 197, 0.3);
        }

        .loading-logo-circle-outer {
            position: absolute;
            width: 140px;
            height: 140px;
            border-radius: 50%;
            border: 2px solid rgba(79, 209, 197, 0.2);
            animation: rotateCircle 20s linear infinite;
        }

        .loading-logo-cross {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
        }

        .loading-cross-vertical {
            position: absolute;
            width: 22px;
            height: 70px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(180deg, #4fd1c5 0%, #38b2ac 100%);
            border-radius: 11px;
            box-shadow: 0 0 20px rgba(79, 209, 197, 0.6);
            animation: glowPulse 2s ease-in-out infinite;
        }

        .loading-cross-horizontal {
            position: absolute;
            width: 70px;
            height: 22px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(90deg, #4fd1c5 0%, #38b2ac 100%);
            border-radius: 11px;
            box-shadow: 0 0 20px rgba(79, 209, 197, 0.6);
            animation: glowPulse 2s ease-in-out 0.5s infinite;
        }

        .loading-heartbeat-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: #4fd1c5;
            z-index: 3;
            animation: heartbeat 1.5s ease-in-out infinite;
            filter: drop-shadow(0 0 15px rgba(79, 209, 197, 0.8));
        }

        .loading-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #4fd1c5;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(79, 209, 197, 0.8);
            top: 50%;
            left: 50%;
        }

        .loading-particle:nth-child(1) {
            animation: orbit 4s linear infinite;
        }

        .loading-particle:nth-child(2) {
            animation: orbit 4s linear infinite 1s;
        }

        .loading-particle:nth-child(3) {
            animation: orbit 4s linear infinite 2s;
        }

        .loading-particle:nth-child(4) {
            animation: orbit 4s linear infinite 3s;
        }

        /* Loading Progress Bar */
        .loading-progress {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 20px;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4fd1c5 0%, #63b3ed 50%, #48bb78 100%);
            border-radius: 2px;
            animation: progressSlide 2s ease-in-out infinite;
            box-shadow: 0 0 10px rgba(79, 209, 197, 0.5);
        }

        .loading-status-text {
            color: #4fd1c5;
            font-size: 0.9rem;
            margin-top: 15px;
            font-weight: 600;
            animation: fadeInOut 2s ease-in-out infinite;
        }

        @keyframes pulseCircle {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.6;
            }

            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }
        }

        @keyframes rotateCircle {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes glowPulse {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(79, 209, 197, 0.6);
            }

            50% {
                box-shadow: 0 0 40px rgba(79, 209, 197, 1);
            }
        }

        @keyframes orbit {
            0% {
                transform: rotate(0deg) translateX(70px) rotate(0deg);
            }

            100% {
                transform: rotate(360deg) translateX(70px) rotate(-360deg);
            }
        }

        @keyframes heartbeat {

            0%,
            100% {
                transform: translate(-50%, -50%) scale(1);
            }

            10% {
                transform: translate(-50%, -50%) scale(1.1);
            }

            20% {
                transform: translate(-50%, -50%) scale(1);
            }

            30% {
                transform: translate(-50%, -50%) scale(1.15);
            }

            40% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes progressSlide {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        @keyframes fadeInOut {

            0%,
            100% {
                opacity: 0.6;
            }

            50% {
                opacity: 1;
            }
        }

        /* Enhanced Mobile Responsive Design */
        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }



            .container {
                padding: 8px;
                max-width: 100%;
            }

            .header-card {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 12px;
                margin-bottom: 20px;
            }

            .header-item {
                padding: 8px;
                text-align: center;
                min-height: auto;
            }

            .header-value {
                font-size: 0.9rem;
            }

            .form-container {
                padding: 12px;
                margin-bottom: 15px;
                border-radius: 12px;
            }

            .form-title {
                font-size: 1.3rem;
                text-align: center;
            }

            .form-section {
                padding: 15px;
                margin-bottom: 15px;
                border-radius: 12px;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
                margin-bottom: 15px;
            }

            .section-header h3 {
                font-size: 1.1rem;
            }

            .form-grid {
                grid-template-columns: 1fr !important;
                gap: 12px;
            }

            .form-group {
                margin-bottom: 0;
            }

            .form-group label {
                font-size: 0.9rem;
                margin-bottom: 6px;
            }

            .form-group input,
            .form-group select {
                padding: 12px;
                font-size: 0.9rem;
                border-radius: 8px;
            }

            .checkbox-grid {
                grid-template-columns: 1fr !important;
                gap: 8px;
            }

            .checkbox-group {
                padding: 12px;
                border-radius: 8px;
            }

            .sample-controls {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .sample-selector {
                width: 100%;
                min-width: auto;
                padding: 12px;
            }

            .sample-indication {
                margin: 15px 0 8px 0;
                padding: 12px;
            }

            .sample-indication-title {
                font-size: 0.9rem;
                margin-bottom: 6px;
            }

            .sample-indication-subtitle {
                font-size: 0.8rem;
            }

            .form-actions {
                flex-direction: column;
                gap: 10px;
                margin-top: 20px;
            }

            .btn {
                width: 100% !important;
                min-width: auto !important;
                padding: 14px 20px;
                font-size: 0.9rem;
                border-radius: 8px;
            }

            /* Results Mobile Optimization */
            .results-container {
                padding: 12px;
                margin-top: 15px;
                border-radius: 12px;
            }

            .results-header {
                margin-bottom: 20px;
                text-align: center;
            }

            .results-header h2 {
                font-size: 1.3rem;
            }

            .results-layout {
                grid-template-columns: 1fr !important;
                gap: 15px;
            }

            .analysis-column,
            .report-column {
                padding: 12px;
                border-radius: 12px;
            }

            .column-header {
                margin-bottom: 15px;
                padding-bottom: 10px;
            }

            .column-header h3 {
                font-size: 1.1rem;
            }

            /* Mobile Results Content */
            .results-content {
                padding: 0 !important;
            }

            .results-content>div {
                padding: 12px !important;
                border-radius: 12px !important;
            }

            /* Mobile Risk Cards */
            .results-content div[style*="grid-template-columns"] {
                display: flex !important;
                flex-direction: column !important;
                gap: 12px !important;
            }

            .results-content div[style*="text-align: center"] {
                padding: 15px !important;
                border-radius: 10px !important;
            }

            /* Mobile ADR Type Cards */
            .specific-adr-types-grid {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
            }

            .adr-type-card {
                padding: 12px !important;
                border-radius: 10px !important;
                margin-bottom: 8px;
            }

            .adr-probability {
                font-size: 1.6rem !important;
            }

            .risk-badge {
                font-size: 0.7rem !important;
                padding: 4px 8px !important;
            }

            /* Mobile Medication Suggestions */
            .medication-alternatives {
                flex-direction: column !important;
                gap: 8px !important;
            }

            .medication-alt {
                flex: none !important;
                min-width: auto !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 10px !important;
                text-align: center !important;
            }

            /* Mobile Monitoring Parameters */
            .monitoring-params {
                flex-direction: column !important;
                gap: 8px !important;
            }

            .monitoring-param {
                flex: none !important;
                min-width: auto !important;
                width: 100% !important;
                text-align: center !important;
                padding: 10px !important;
            }

            /* Mobile Report Content */
            .report-content {
                padding: 12px !important;
                max-height: 400px;
                font-size: 0.85rem;
                line-height: 1.6;
            }

            .report-content h1 {
                font-size: 1.3rem !important;
            }

            .report-content h2 {
                font-size: 1.1rem !important;
                padding: 8px 12px !important;
            }

            .report-content h3 {
                font-size: 1rem !important;
                padding: 6px 10px !important;
            }

            /* Mobile Modal */
            .modal-content {
                margin: 10px !important;
                padding: 15px !important;
                max-height: 90vh;
                border-radius: 12px;
            }

            .modal-title {
                font-size: 1.3rem;
                flex-direction: column;
                gap: 8px;
            }

            .feature-grid {
                grid-template-columns: 1fr !important;
                gap: 10px;
            }

            .feature-card {
                padding: 12px;
            }

            /* Mobile BMI Display */
            .bmi-display {
                flex-direction: column;
                gap: 8px;
                text-align: center;
                padding: 10px;
            }

            .bmi-value {
                font-size: 1rem;
            }

            .bmi-category {
                font-size: 0.8rem;
                padding: 3px 8px;
            }
        }

        /* Ultra Mobile Responsive - Small Phones */
        @media (max-width: 480px) {
            body {
                font-size: 13px;
                line-height: 1.4;
            }

            .container {
                padding: 5px;
                margin: 0;
            }

            .header-card {
                padding: 10px;
                gap: 8px;
                margin-bottom: 15px;
                border-radius: 10px;
            }

            .header-item {
                padding: 6px;
                font-size: 0.8rem;
                border-radius: 8px;
            }

            .header-label {
                font-size: 0.7rem;
            }

            .header-value {
                font-size: 0.85rem;
            }

            .form-container {
                padding: 10px;
                margin-bottom: 12px;
                border-radius: 10px;
            }

            .form-title {
                font-size: 1.2rem;
                margin-bottom: 8px;
            }

            .form-subtitle {
                font-size: 0.9rem;
            }

            .form-section {
                padding: 12px;
                margin-bottom: 12px;
                border-radius: 10px;
            }

            .section-header {
                margin-bottom: 12px;
                padding-bottom: 8px;
            }

            .section-header h3 {
                font-size: 1rem;
            }

            .section-header i {
                font-size: 1rem;
            }

            .form-group {
                margin-bottom: 12px;
            }

            .form-group label {
                font-size: 0.85rem;
                margin-bottom: 5px;
            }

            .form-group input,
            .form-group select {
                padding: 10px;
                font-size: 0.85rem;
                border-radius: 6px;
                border-width: 1px;
            }

            .checkbox-group {
                padding: 10px;
                border-radius: 6px;
                gap: 8px;
            }

            .checkbox-group label {
                font-size: 0.85rem;
            }

            .sample-controls {
                gap: 8px;
                margin-top: 15px;
            }

            .btn-sample {
                padding: 10px 16px;
                font-size: 0.85rem;
                border-radius: 6px;
            }

            .sample-selector {
                padding: 10px;
                font-size: 0.85rem;
                border-radius: 6px;
            }

            .sample-indication {
                margin: 12px 0 6px 0;
                padding: 10px;
                border-radius: 8px;
            }

            .sample-indication-title {
                font-size: 0.85rem;
                margin-bottom: 5px;
            }

            .sample-indication-subtitle {
                font-size: 0.75rem;
            }

            .btn {
                padding: 12px 16px !important;
                font-size: 0.85rem !important;
                border-radius: 6px !important;
            }

            /* Ultra Mobile Results */
            .results-container {
                padding: 10px;
                margin-top: 12px;
                border-radius: 10px;
            }

            .results-header {
                margin-bottom: 15px;
            }

            .results-header h2 {
                font-size: 1.2rem;
            }

            .analysis-column,
            .report-column {
                padding: 10px;
                border-radius: 10px;
                margin-bottom: 10px;
            }

            .column-header {
                margin-bottom: 12px;
                padding-bottom: 8px;
            }

            .column-header h3 {
                font-size: 1rem;
            }

            /* Ultra Mobile Risk Cards - Force Single Column */
            .results-content div[style*="display: grid"] {
                display: flex !important;
                flex-direction: column !important;
                gap: 10px !important;
            }

            .results-content div[style*="text-align: center"] {
                padding: 12px !important;
                border-radius: 8px !important;
                margin-bottom: 8px !important;
            }

            .results-content h3 {
                font-size: 0.9rem !important;
                margin: 0 0 8px 0 !important;
            }

            .results-content div[style*="font-size: 2rem"] {
                font-size: 1.5rem !important;
            }

            .results-content div[style*="font-size: 1.5rem"] {
                font-size: 1.2rem !important;
            }

            /* Ultra Mobile ADR Cards */
            .specific-adr-types-grid {
                grid-template-columns: 1fr !important;
                gap: 8px !important;
            }

            .adr-type-card {
                padding: 10px !important;
                border-radius: 8px !important;
            }

            .adr-type-card h5 {
                font-size: 0.8rem !important;
                line-height: 1.2 !important;
            }

            .adr-probability {
                font-size: 1.4rem !important;
            }

            .risk-badge {
                font-size: 0.65rem !important;
                padding: 3px 6px !important;
            }

            /* Ultra Mobile Suggestions */
            .medication-alternatives,
            .monitoring-params {
                flex-direction: column !important;
                gap: 6px !important;
            }

            .medication-alt,
            .monitoring-param {
                width: 100% !important;
                margin: 0 !important;
                padding: 8px !important;
                font-size: 0.8rem !important;
                border-radius: 6px !important;
            }

            /* Ultra Mobile Report */
            .report-content {
                padding: 10px !important;
                max-height: 300px !important;
                font-size: 0.8rem !important;
                line-height: 1.5 !important;
                border-radius: 8px !important;
            }

            .report-content h1 {
                font-size: 1.1rem !important;
                margin-bottom: 10px !important;
            }

            .report-content h2 {
                font-size: 1rem !important;
                padding: 6px 10px !important;
                margin: 15px 0 8px 0 !important;
            }

            .report-content h3 {
                font-size: 0.9rem !important;
                padding: 4px 8px !important;
                margin: 12px 0 6px 0 !important;
            }

            .report-content p {
                font-size: 0.8rem !important;
                margin: 8px 0 !important;
            }

            .report-content ul,
            .report-content ol {
                margin: 8px 0 !important;
                padding-left: 20px !important;
            }

            .report-content li {
                font-size: 0.8rem !important;
                margin-bottom: 4px !important;
            }

            /* Ultra Mobile Modal */
            .modal-overlay {
                padding: 5px;
            }

            .modal-content {
                margin: 5px !important;
                padding: 12px !important;
                max-height: 95vh !important;
                border-radius: 10px !important;
            }

            .modal-title {
                font-size: 1.1rem !important;
                margin-bottom: 15px;
            }

            .modal-section {
                margin-bottom: 15px;
            }

            .modal-section h3 {
                font-size: 0.95rem !important;
            }

            .modal-section p {
                font-size: 0.8rem !important;
            }

            .feature-card {
                padding: 10px !important;
            }

            .feature-card i {
                font-size: 1.2rem !important;
            }

            .feature-card h4 {
                font-size: 0.85rem !important;
            }

            .feature-card p {
                font-size: 0.75rem !important;
            }

            /* Ultra Mobile BMI */
            .bmi-display {
                padding: 8px !important;
                border-radius: 6px !important;
            }

            .bmi-value {
                font-size: 0.95rem !important;
            }

            .bmi-category {
                font-size: 0.7rem !important;
                padding: 2px 6px !important;
            }

            /* Force text wrapping */
            * {
                word-wrap: break-word;
                overflow-wrap: break-word;
            }

            /* Ensure no horizontal scrolling */
            body,
            html {
                overflow-x: hidden;
                max-width: 100vw;
            }

            .container {
                max-width: 100vw;
                overflow-x: hidden;
            }
        }

        /* Scroll Down Indicator */
        .scroll-indicator {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
            color: #0f2027;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.95rem;
            box-shadow: 0 8px 25px rgba(79, 209, 197, 0.5);
            cursor: pointer;
            z-index: 1000;
            animation: bounceIndicator 2s infinite;
            display: none;
            align-items: center;
            gap: 8px;
        }

        .scroll-indicator.show {
            display: flex;
        }

        @keyframes bounceIndicator {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateX(-50%) translateY(0);
            }

            40% {
                transform: translateX(-50%) translateY(-10px);
            }

            60% {
                transform: translateX(-50%) translateY(-5px);
            }
        }

        .scroll-indicator:hover {
            transform: translateX(-50%) translateY(-3px);
            box-shadow: 0 12px 30px rgba(79, 209, 197, 0.6);
        }

        /* Results Container */
        .results-container {
            background: rgba(15, 32, 39, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        .results-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(79, 209, 197, 0.2);
        }

        .results-header h2 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, #4fd1c5 0%, #63b3ed 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .results-header i {
            color: #4fd1c5;
            -webkit-text-fill-color: #4fd1c5;
        }

        .results-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .analysis-column {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(79, 209, 197, 0.2);
            backdrop-filter: blur(10px);
        }

        .report-column {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(79, 209, 197, 0.2);
            backdrop-filter: blur(10px);
        }

        .column-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(79, 209, 197, 0.2);
        }

        .column-header h3 {
            color: #e2e8f0;
            font-size: 1.4rem;
            font-weight: 700;
        }

        .column-header i {
            color: #4fd1c5;
            font-size: 1.3rem;
        }

        /* Information Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 32, 39, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: rgba(15, 32, 39, 0.95);
            border: 1px solid rgba(79, 209, 197, 0.3);
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(79, 209, 197, 0.2);
        }

        .modal-title {
            font-size: 2rem;
            background: linear-gradient(135deg, #4fd1c5 0%, #63b3ed 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .modal-title i {
            color: #4fd1c5;
            -webkit-text-fill-color: #4fd1c5;
        }

        .modal-subtitle {
            color: #a0aec0;
            font-size: 1.1rem;
        }

        .modal-section {
            margin-bottom: 25px;
        }

        .modal-section h3 {
            color: #e2e8f0;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-section h3 i {
            color: #4fd1c5;
        }

        .modal-section p {
            color: #cbd5e0;
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .modal-section ul {
            color: #cbd5e0;
            padding-left: 20px;
            line-height: 1.7;
        }

        .modal-section li {
            margin-bottom: 8px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #4fd1c5;
            text-align: center;
            border: 1px solid rgba(79, 209, 197, 0.2);
        }

        .feature-card i {
            font-size: 2rem;
            color: #4fd1c5;
            margin-bottom: 10px;
        }

        .feature-card h4 {
            color: #e2e8f0;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .feature-card p {
            color: #a0aec0;
            font-size: 0.9rem;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(79, 209, 197, 0.3);
            font-size: 1.5rem;
            color: #cbd5e0;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(79, 209, 197, 0.2);
            color: #4fd1c5;
            border-color: #4fd1c5;
        }

        .modal-actions {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid rgba(79, 209, 197, 0.2);
        }

        /* Roadmap Styles */
        .roadmap-container {
            margin: 20px 0;
        }

        .roadmap-phase {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid rgba(79, 209, 197, 0.3);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .roadmap-phase.completed {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.15);
        }

        .roadmap-phase:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .phase-header {
            display: flex;
            align-items: center;
            padding: 20px;
            background: rgba(15, 32, 39, 0.6);
            border-bottom: 1px solid rgba(79, 209, 197, 0.2);
        }

        .roadmap-phase.completed .phase-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .phase-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            background: rgba(79, 209, 197, 0.2);
            color: #4fd1c5;
            font-size: 1.2rem;
        }

        .roadmap-phase.completed .phase-icon {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .phase-info h4 {
            margin: 0 0 5px 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #e2e8f0;
        }

        .roadmap-phase.completed .phase-info h4 {
            color: white;
        }

        .phase-duration {
            font-size: 0.85rem;
            color: #a0aec0;
            font-weight: 500;
        }

        .roadmap-phase.completed .phase-duration {
            color: rgba(255, 255, 255, 0.9);
        }

        .phase-content {
            padding: 20px;
        }

        .milestone {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f1f5f9;
            transition: all 0.2s ease;
        }

        .milestone:last-child {
            border-bottom: none;
        }

        .milestone:hover {
            background: rgba(102, 126, 234, 0.05);
            border-radius: 8px;
            padding-left: 10px;
        }

        .milestone i {
            width: 20px;
            margin-right: 12px;
            color: #a0aec0;
            font-size: 0.9rem;
        }

        .milestone.completed i {
            color: #10b981;
        }

        .milestone span {
            color: #cbd5e0;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .roadmap-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
        }

        .summary-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .summary-card:hover {
            border-color: #4fd1c5;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 209, 197, 0.15);
        }

        .summary-card i {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .summary-card h5 {
            margin: 0 0 5px 0;
            color: #1e293b;
            font-size: 1rem;
            font-weight: 600;
        }

        .summary-card p {
            margin: 0;
            color: #a0aec0;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        /* Responsive Roadmap */
        @media (max-width: 768px) {
            .roadmap-summary {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .summary-card {
                padding: 15px;
            }

            .phase-header {
                padding: 15px;
            }

            .phase-content {
                padding: 15px;
            }

            .milestone {
                padding: 10px 0;
            }

            .phase-info h4 {
                font-size: 1rem;
            }

            .phase-duration {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .roadmap-phase {
                margin-bottom: 15px;
            }

            .phase-header {
                padding: 12px;
            }

            .phase-content {
                padding: 12px;
            }

            .phase-icon {
                width: 40px;
                height: 40px;
                margin-right: 12px;
                font-size: 1rem;
            }

            .phase-info h4 {
                font-size: 0.95rem;
            }

            .milestone span {
                font-size: 0.9rem;
            }

            .summary-card {
                padding: 12px;
                gap: 12px;
            }

            .summary-card i {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }

        /* Comparison Section Styles */
        .comparison-container {
            margin: 25px 0;
        }

        .comparison-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(79, 209, 197, 0.1);
            border-radius: 12px;
            border: 2px solid rgba(79, 209, 197, 0.3);
        }

        .comparison-header h4 {
            margin: 0 0 10px 0;
            color: #4fd1c5;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .comparison-header p {
            margin: 0;
            color: #cbd5e0;
            font-size: 0.95rem;
        }

        .scales-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .scale-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 2px solid rgba(79, 209, 197, 0.2);
            backdrop-filter: blur(10px);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .scale-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        .scale-card.naranjo {
            border-color: #3b82f6;
        }

        .scale-card.who-umc {
            border-color: #10b981;
        }

        .scale-card.our-system {
            border-color: #4fd1c5;
            background: rgba(79, 209, 197, 0.1);
        }

        .scale-header {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .scale-card.naranjo .scale-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .scale-card.who-umc .scale-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .scale-card.our-system .scale-header {
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
            color: white;
        }

        .scale-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            font-size: 1.3rem;
        }

        .scale-info h5 {
            margin: 0 0 5px 0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .scale-type {
            font-size: 0.85rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .scale-details {
            padding: 20px;
        }

        .scale-description {
            margin-bottom: 20px;
        }

        .scale-description p {
            margin: 8px 0;
            color: #cbd5e0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .scale-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .category {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 12px;
            border-radius: 8px;
            min-width: 70px;
            text-align: center;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .category.definite,
        .category.certain,
        .category.high-risk {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
        }

        .category.probable,
        .category.medium-risk {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .category.possible,
        .category.low-risk {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .category.doubtful,
        .category.unlikely,
        .category.conditional,
        .category.unassessable {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
        }

        .category .score {
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .category .label {
            font-size: 0.75rem;
            opacity: 0.9;
        }

        .comparison-advantages {
            margin: 30px 0;
            padding: 25px;
            background: rgba(79, 209, 197, 0.1);
            border-radius: 16px;
            border: 2px solid #4fd1c5;
        }

        .comparison-advantages h4 {
            margin: 0 0 20px 0;
            color: #4fd1c5;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .advantages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .advantage-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(79, 209, 197, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .advantage-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(14, 165, 233, 0.15);
        }

        .advantage-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .advantage-card h5 {
            margin: 0 0 10px 0;
            color: #4fd1c5;
            font-size: 1rem;
            font-weight: 600;
        }

        .advantage-card p {
            margin: 0;
            color: #cbd5e0;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .validation-metrics {
            margin: 30px 0;
            padding: 25px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 16px;
            border: 2px solid #10b981;
        }

        .validation-metrics h4 {
            margin: 0 0 20px 0;
            color: #6ee7b7;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(79, 209, 197, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.15);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #15803d;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 1rem;
            font-weight: 600;
            color: #166534;
            margin-bottom: 8px;
        }

        .metric-description {
            font-size: 0.8rem;
            color: #a0aec0;
            line-height: 1.4;
        }

        .clinical-impact {
            margin: 30px 0;
            padding: 25px;
            background: rgba(245, 158, 11, 0.1);
            border-radius: 16px;
            border: 2px solid #f59e0b;
        }

        .impact-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .impact-header h4 {
            margin: 0;
            color: #fbbf24;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .impact-header i {
            color: #fbbf24;
            font-size: 1.3rem;
        }

        .impact-content p {
            margin: 0 0 15px 0;
            color: #78350f;
            font-weight: 500;
        }

        .impact-content ul {
            margin: 0;
            padding-left: 20px;
            color: #78350f;
        }

        .impact-content li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .impact-content strong {
            color: #92400e;
        }

        /* Responsive Comparison Styles */
        @media (max-width: 768px) {
            .scales-comparison {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .advantages-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .comparison-header {
                padding: 15px;
            }

            .scale-header {
                padding: 15px;
            }

            .scale-details {
                padding: 15px;
            }

            .comparison-advantages,
            .validation-metrics,
            .clinical-impact {
                padding: 20px;
                margin: 20px 0;
            }
        }

        @media (max-width: 480px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .scale-categories {
                justify-content: center;
            }

            .category {
                min-width: 60px;
                padding: 8px 10px;
            }

            .metric-value {
                font-size: 1.5rem;
            }

            .comparison-header h4 {
                font-size: 1.1rem;
            }

            .scale-info h5 {
                font-size: 1.1rem;
            }
        }

        /* Comparison Modal Styles */
        .comparison-modal-content {
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .comparison-tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 25px;
            gap: 5px;
        }

        .tab-button {
            padding: 12px 20px;
            border: none;
            background: rgba(255, 255, 255, 0.05);
            color: #a0aec0;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-button:hover {
            background: rgba(79, 209, 197, 0.1);
            color: #4fd1c5;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
            color: #0f2027;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .overview-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 2px solid rgba(79, 209, 197, 0.2);
            backdrop-filter: blur(10px);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .overview-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        .naranjo-card {
            border-color: #3b82f6;
        }

        .who-card {
            border-color: #10b981;
        }

        .ai-card {
            border-color: #4fd1c5;
        }

        .card-header {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }

        .naranjo-card .card-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }

        .who-card .card-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .ai-card .card-header {
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
        }

        .card-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .card-content {
            padding: 20px;
        }

        .card-content p {
            margin: 8px 0;
            color: #cbd5e0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .card-score {
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.03);
            border-top: 1px solid rgba(79, 209, 197, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .score-label {
            color: #a0aec0;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .score-value {
            color: #e2e8f0;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .comparison-chart {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 16px;
            border: 2px solid rgba(79, 209, 197, 0.2);
        }

        .comparison-chart h4 {
            margin: 0 0 20px 0;
            color: #e2e8f0;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metric-comparison {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .metric-row {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 20px;
            align-items: center;
        }

        .metric-name {
            font-weight: 600;
            color: #e2e8f0;
            font-size: 0.9rem;
        }

        .metric-bars {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .bar {
            height: 25px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            padding: 0 12px;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            min-width: 80px;
        }

        .naranjo-bar {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }

        .who-bar {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .ai-bar {
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
        }

        .scale-detail-view {
            max-width: 800px;
            margin: 0 auto;
        }

        .scale-intro {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(79, 209, 197, 0.1);
            border-radius: 16px;
            border: 1px solid rgba(79, 209, 197, 0.3);
        }

        .scale-intro h3 {
            margin: 0 0 15px 0;
            color: #e2e8f0;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .scale-intro p {
            margin: 0;
            color: #cbd5e0;
            line-height: 1.6;
        }

        .naranjo-questions h4,
        .who-categories h4,
        .ai-features h4 {
            margin: 0 0 20px 0;
            color: #e2e8f0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .question-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }

        .question-item {
            display: grid;
            grid-template-columns: 30px 1fr 80px;
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(79, 209, 197, 0.2);
        }

        .q-number {
            font-weight: 700;
            color: #4fd1c5;
        }

        .q-text {
            color: #cbd5e0;
            line-height: 1.5;
        }

        .q-score {
            font-weight: 600;
            color: #10b981;
            text-align: center;
        }

        .scoring-system {
            margin-top: 30px;
        }

        .score-ranges {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .score-range {
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            color: white;
        }

        .score-range.definite {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }

        .score-range.probable {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .score-range.possible {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .score-range.doubtful {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }

        .category-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .category-detail {
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid;
        }

        .category-detail.certain {
            background: rgba(239, 68, 68, 0.1);
            border-color: #dc2626;
        }

        .category-detail.probable {
            background: rgba(245, 158, 11, 0.1);
            border-color: #f59e0b;
        }

        .category-detail.possible {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
        }

        .category-detail.unlikely {
            background: rgba(107, 114, 128, 0.1);
            border-color: #6b7280;
        }

        .category-detail h5 {
            margin: 0 0 10px 0;
            color: #e2e8f0;
            font-weight: 600;
        }

        .category-detail p {
            margin: 0;
            color: #cbd5e0;
            line-height: 1.5;
        }

        .feature-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .feature-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            text-align: center;
            transition: all 0.3s ease;
        }

        .feature-item:hover {
            border-color: #4fd1c5;
            transform: translateY(-2px);
        }

        .feature-item i {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.2rem;
        }

        .feature-item h5 {
            margin: 0 0 10px 0;
            color: #1e293b;
            font-weight: 600;
        }

        .feature-item p {
            margin: 0;
            color: #64748b;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .validation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .validation-metric {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e5e7eb;
        }

        .validation-metric .metric-value {
            display: block;
            font-size: 2rem;
            font-weight: 700;
            color: #4fd1c5;
            margin-bottom: 5px;
        }

        .validation-metric .metric-label {
            color: #a0aec0;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Responsive Comparison Modal */
        @media (max-width: 768px) {
            .comparison-tabs {
                flex-wrap: wrap;
                gap: 8px;
            }

            .tab-button {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .overview-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .metric-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .metric-bars {
                gap: 3px;
            }

            .bar {
                height: 20px;
                font-size: 0.75rem;
            }

            .feature-comparison {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .validation-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .comparison-modal-content {
                margin: 10px;
                max-height: 95vh;
            }

            .tab-button {
                padding: 8px 12px;
                font-size: 0.8rem;
            }

            .question-item {
                grid-template-columns: 1fr;
                gap: 10px;
                text-align: center;
            }

            .score-ranges {
                grid-template-columns: 1fr;
            }

            .validation-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Mitigation Strategies Styles */
        .mitigation-strategies-container {
            background: rgba(15, 32, 39, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 30px auto;
            max-width: 1400px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(79, 209, 197, 0.2);
        }

        .mitigation-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(79, 209, 197, 0.2);
        }

        .mitigation-header h2 {
            background: linear-gradient(135deg, #4fd1c5 0%, #48bb78 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2rem;
            font-weight: 700;
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .mitigation-header i {
            color: #48bb78;
            -webkit-text-fill-color: #48bb78;
            font-size: 1.8rem;
        }

        .mitigation-subtitle p {
            color: #a0aec0;
            font-size: 1.1rem;
            margin: 0;
            font-weight: 500;
        }

        .mitigation-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .mitigation-tab {
            padding: 12px 20px;
            border: 2px solid rgba(79, 209, 197, 0.3);
            background: rgba(255, 255, 255, 0.05);
            color: #cbd5e0;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .mitigation-tab:hover {
            border-color: #4fd1c5;
            color: #4fd1c5;
            transform: translateY(-2px);
            background: rgba(79, 209, 197, 0.1);
        }

        .mitigation-tab.active {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border-color: #48bb78;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
        }

        .mitigation-content {
            min-height: 400px;
        }

        .mitigation-tab-content {
            display: none;
        }

        .mitigation-tab-content.active {
            display: block;
        }

        .mitigation-section h3 {
            color: #e2e8f0;
            font-size: 1.4rem;
            font-weight: 600;
            margin: 0 0 20px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mitigation-section h3 i {
            color: #48bb78;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .recommendation-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            border: 2px solid rgba(79, 209, 197, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .recommendation-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(79, 209, 197, 0.3);
            border-color: #4fd1c5;
        }

        .recommendation-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
        }

        .recommendation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .recommendation-category {
            font-weight: 700;
            color: #4fd1c5;
            font-size: 1.1rem;
            background: rgba(15, 32, 39, 0.95) !important;
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid rgba(79, 209, 197, 0.4);
            display: inline-block;
        }

        .priority-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-badge.critical {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
        }

        .priority-badge.high {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .priority-badge.medium {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }

        .recommendation-intervention {
            color: #cbd5e0;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .recommendation-rationale {
            color: #64748b;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 10px;
            font-style: italic;
        }

        .recommendation-timeline {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #10b981;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .alternatives-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .alternative-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            border: 2px solid rgba(79, 209, 197, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .alternative-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
            border-color: #3b82f6;
        }

        .alternative-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .alternative-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ffffff;
        }

        .risk-reduction-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .alternative-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .advantages-list,
        .considerations-list {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(79, 209, 197, 0.2);
        }

        .advantages-list h5,
        .considerations-list h5 {
            margin: 0 0 10px 0;
            color: #e2e8f0;
            font-weight: 600;
        }

        .advantages-list ul,
        .considerations-list ul {
            margin: 0;
            padding-left: 20px;
            color: #cbd5e0;
        }

        .advantages-list li {
            color: #6ee7b7;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .considerations-list li {
            color: #f59e0b;
            margin-bottom: 5px;
        }

        .dosing-recommendations {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .dosing-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            border: 2px solid rgba(79, 209, 197, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .dosing-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
        }

        .dosing-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .adjustment-type {
            font-size: 1.2rem;
            font-weight: 700;
            color: #ffffff;
        }

        .evidence-badge {
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .dosing-recommendation {
            font-size: 1.1rem;
            color: #e2e8f0;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .monitoring-protocol {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .monitoring-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            border: 2px solid rgba(79, 209, 197, 0.2);
            backdrop-filter: blur(10px);
        }

        .monitoring-section h4 {
            color: #e2e8f0;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .monitoring-section h4 i {
            color: #fbbf24;
        }

        .monitoring-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border: 1px solid rgba(79, 209, 197, 0.2);
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #f59e0b;
        }

        .monitoring-item h5 {
            margin: 0 0 8px 0;
            color: #e2e8f0;
            font-weight: 600;
        }

        .monitoring-item p {
            margin: 0;
            color: #cbd5e0;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .monitoring-item p strong {
            color: #4fd1c5;
            font-weight: 600;
        }

        .emergency-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .emergency-list li {
            background: rgba(239, 68, 68, 0.1);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid #ef4444;
            color: #fca5a5;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .education-materials {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .education-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            border: 2px solid rgba(79, 209, 197, 0.2);
            backdrop-filter: blur(10px);
        }

        .education-card h4 {
            color: #e2e8f0;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .education-card h4 i {
            color: #4fd1c5;
        }

        .education-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .education-list li {
            background: rgba(79, 209, 197, 0.08);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid #4fd1c5;
            color: #cbd5e0;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .mitigation-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px solid rgba(79, 209, 197, 0.2);
        }

        .loading-placeholder {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .loading-placeholder i {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #10b981;
        }

        .loading-placeholder p {
            font-size: 1.1rem;
            margin: 0;
        }

        /* Responsive Mitigation Strategies */
        @media (max-width: 768px) {
            .mitigation-strategies-container {
                margin: 20px 10px;
                padding: 20px;
            }

            .mitigation-tabs {
                flex-direction: column;
                gap: 8px;
            }

            .mitigation-tab {
                justify-content: center;
                padding: 10px 15px;
            }

            .recommendations-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .alternative-details {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .monitoring-protocol {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .education-materials {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .mitigation-actions {
                flex-direction: column;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .mitigation-header h2 {
                font-size: 1.5rem;
                flex-direction: column;
                gap: 10px;
            }

            .mitigation-subtitle p {
                font-size: 1rem;
            }

            .recommendation-card {
                padding: 15px;
            }

            .recommendation-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .recommendation-category {
                font-size: 0.9rem;
                padding: 6px 12px;
                word-wrap: break-word;
                max-width: 100%;
                white-space: normal;
            }

            .recommendation-intervention {
                font-size: 0.95rem;
            }

            .recommendation-rationale {
                font-size: 0.85rem;
            }

            .alternative-card {
                padding: 15px;
            }

            .alternative-name {
                font-size: 1.1rem;
                word-wrap: break-word;
            }

            .dosing-card {
                padding: 15px;
            }

            .monitoring-protocol {
                overflow-x: auto;
            }

            .protocol-table {
                min-width: 100%;
            }

            .monitoring-section {
                padding: 20px;
            }

            .education-card {
                padding: 20px;
            }
        }

        /* Two Column Results Layout */
        .results-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .analysis-column,
        .report-column {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #e5e7eb;
        }

        .column-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .column-header h3 {
            color: #e2e8f0;
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0;
        }

        .column-header i {
            color: #4fd1c5;
        }

        .ai-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: auto;
        }

        .report-content {
            background: rgba(255, 255, 255, 0.02);
            padding: 30px;
            border-radius: 16px;
            border: 2px solid #e2e8f0;
            max-height: 600px;
            overflow-y: auto;
            line-height: 1.8;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.02);
        }

        /* Custom scrollbar for report content */
        .report-content::-webkit-scrollbar {
            width: 8px;
        }

        .report-content::-webkit-scrollbar-track {
            background: rgba(79, 209, 197, 0.1);
            border-radius: 4px;
        }

        .report-content::-webkit-scrollbar-thumb {
            background: rgba(79, 209, 197, 0.3);
            border-radius: 4px;
        }

        .report-content::-webkit-scrollbar-thumb:hover {
            background: rgba(79, 209, 197, 0.5);
        }

        /* Enhanced typography for AI report */
        .report-content h1 {
            color: #e2e8f0;
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0 0 20px 0;
            padding-bottom: 15px;
            border-bottom: 3px solid #4fd1c5;
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .report-content h2 {
            color: #4fd1c5;
            font-size: 1.4rem;
            font-weight: 700;
            margin: 30px 0 15px 0;
            padding: 12px 20px;
            background: rgba(79, 209, 197, 0.1);
            border-left: 4px solid #4fd1c5;
            border-radius: 8px;
            position: relative;
        }

        .report-content h2::before {
            content: '';
            position: absolute;
            left: -4px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
            border-radius: 2px;
        }

        .report-content h3 {
            color: #cbd5e0;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 25px 0 12px 0;
            padding: 8px 15px;
            background: rgba(79, 209, 197, 0.1);
            border-radius: 6px;
            border-left: 3px solid #10b981;
        }

        .report-content h4 {
            color: #a0aec0;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 20px 0 10px 0;
            padding-left: 10px;
            border-left: 2px solid #d1d5db;
        }

        /* Enhanced paragraph styling */
        .report-content p {
            color: #cbd5e0;
            font-size: 1rem;
            line-height: 1.8;
            margin: 15px 0;
            text-align: justify;
        }

        /* Enhanced list styling */
        .report-content ul,
        .report-content ol {
            margin: 20px 0;
            padding-left: 25px;
            color: #cbd5e0;
        }

        .report-content ul {
            list-style: none;
        }

        .report-content ul li {
            position: relative;
            margin-bottom: 12px;
            padding-left: 25px;
            line-height: 1.7;
        }

        .report-content ul li::before {
            content: '▸';
            position: absolute;
            color: #4fd1c5;
            left: 0;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .report-content ol li {
            margin-bottom: 12px;
            line-height: 1.7;
            padding-left: 5px;
        }

        /* Strong and emphasis styling */
        .report-content strong {
            color: #e2e8f0;
            font-weight: 700;
            background: rgba(30, 41, 59, 0.6);
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid rgba(79, 209, 197, 0.3);
        }

        .report-content em {
            color: #4fd1c5;
            font-style: italic;
            font-weight: 500;
        }

        /* Special sections styling */
        .report-content blockquote {
            background: rgba(79, 209, 197, 0.1);
            border-left: 4px solid #4fd1c5;
            margin: 20px 0;
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
            font-style: italic;
            color: #0c4a6e;
        }

        /* Code and technical terms */
        .report-content code {
            background: rgba(79, 209, 197, 0.1);
            color: #4fd1c5;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            border: 1px solid #e2e8f0;
        }

        /* Tables in reports */
        .report-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .report-content th,
        .report-content td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(79, 209, 197, 0.2);
            color: #cbd5e0;
        }

        .report-content th {
            background: rgba(79, 209, 197, 0.1);
            font-weight: 600;
            color: #e2e8f0;
        }

        /* Highlight important sections */
        .report-content .highlight {
            background: rgba(245, 158, 11, 0.15);
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
            margin: 20px 0;
        }

        .report-content .warning {
            background: rgba(239, 68, 68, 0.15);
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid #ef4444;
            margin: 20px 0;
            color: #7f1d1d;
        }

        .report-content .success {
            background: rgba(72, 187, 120, 0.15);
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid #22c55e;
            margin: 20px 0;
            color: #14532d;
        }

        /* Medical terminology styling */
        .report-content .medical-term {
            color: #4fd1c5;
            font-weight: 600;
            background: rgba(30, 41, 59, 0.6);
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid rgba(79, 209, 197, 0.3);
        }

        /* Risk level indicators */
        .report-content .risk-high {
            color: #ef4444;
            font-weight: 700;
            background: rgba(239, 68, 68, 0.15);
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .report-content .risk-medium {
            color: #f59e0b;
            font-weight: 700;
            background: rgba(245, 158, 11, 0.15);
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .report-content .risk-low {
            color: #10b981;
            font-weight: 700;
            background: rgba(16, 185, 129, 0.15);
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .report-loading {
            text-align: center;
            padding: 40px 20px;
            color: #4fd1c5;
        }

        .report-loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }

        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Test Category Card Styles */
        .test-category-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin-bottom: 25px;
        }

        .test-card {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            border: none;
            position: relative;
            overflow: hidden;
        }

        .test-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .test-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .test-card:hover::before {
            opacity: 1;
        }

        .test-card.active {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .test-card.active::before {
            opacity: 1;
        }

        .test-card-icon {
            background: rgba(255, 255, 255, 0.2);
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .test-card:hover .test-card-icon {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .test-category-section {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(79, 209, 197, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            animation: slideDown 0.3s ease-out;
            backdrop-filter: blur(10px);
        }

        .test-category-section h5 {
            color: #e2e8f0;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(79, 209, 197, 0.2);
        }

        .test-category-section h5 i {
            color: #4fd1c5;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile Test Categories */
        @media (max-width: 768px) {
            .test-category-cards {
                grid-template-columns: 1fr !important;
                gap: 12px !important;
            }

            .test-card {
                padding: 16px !important;
            }

            .test-card-icon {
                width: 40px !important;
                height: 40px !important;
                margin-bottom: 10px !important;
            }

            .test-card h6 {
                font-size: 0.9rem !important;
            }

            .test-card p {
                font-size: 0.75rem !important;
            }

            .test-category-section {
                padding: 15px;
                border-radius: 10px;
            }

            .test-category-section h5 {
                font-size: 1rem;
                margin-bottom: 12px;
            }
        }

        /* Tablet Test Categories */
        @media (max-width: 1024px) and (min-width: 769px) {
            .test-category-cards {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }

        /* Enhanced Action Buttons Styles */
        .enhanced-primary-btn:hover {
            transform: translateY(-3px) scale(1.02) !important;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5) !important;
        }

        .enhanced-primary-btn:hover .btn-shine {
            left: 100% !important;
        }

        .enhanced-primary-btn:hover .btn-icon {
            background: rgba(255, 255, 255, 0.3) !important;
            transform: scale(1.1) !important;
        }

        .enhanced-primary-btn:hover .btn-arrow {
            background: rgba(255, 255, 255, 0.25) !important;
            transform: translateX(3px) !important;
        }

        .enhanced-primary-btn:active {
            transform: translateY(-1px) scale(0.98) !important;
        }

        .enhanced-secondary-btn:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1) !important;
            border-color: #cbd5e1 !important;
        }

        .enhanced-secondary-btn:hover .secondary-btn-bg {
            opacity: 1 !important;
        }

        .enhanced-secondary-btn:hover .secondary-icon {
            background: #e2e8f0 !important;
            transform: scale(1.1) !important;
        }

        .enhanced-secondary-btn:hover .secondary-icon i {
            color: #475569 !important;
        }

        .enhanced-secondary-btn:hover span {
            color: #334155 !important;
        }

        .quick-action-btn:hover {
            background: rgba(79, 209, 197, 0.15) !important;
            color: #4fd1c5 !important;
            border-color: #4fd1c5 !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1) !important;
        }

        /* Tablet Responsive - Medium Screens */
        @media (max-width: 1024px) and (min-width: 769px) {
            .enhanced-primary-btn {
                width: 80% !important;
            }

            .add-drug-btn {
                width: 80% !important;
            }
        }

        /* Mobile Enhanced Action Buttons */
        @media (max-width: 768px) {
            .enhanced-actions-container {
                padding: 25px 20px !important;
                margin-top: 30px !important;
            }

            .actions-header h3 {
                font-size: 1.3rem !important;
            }

            .enhanced-primary-btn {
                padding: 16px 22px !important;
                font-size: 14px !important;
                width: 85% !important;
                letter-spacing: 0.5px !important;
            }

            .add-drug-btn {
                padding: 16px 22px !important;
                font-size: 14px !important;
                width: 85% !important;
                letter-spacing: 0.5px !important;
            }

            .secondary-actions-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }

            .enhanced-secondary-btn {
                padding: 16px 18px !important;
                font-size: 14px !important;
            }

            .quick-actions-footer {
                flex-direction: column !important;
                align-items: center !important;
                gap: 10px !important;
            }

            .quick-action-btn {
                width: 100% !important;
                justify-content: center !important;
                max-width: 200px !important;
            }
        }

        /* Ultra Mobile */
        @media (max-width: 480px) {
            .enhanced-actions-container {
                padding: 20px 15px !important;
            }

            .header-icon {
                width: 50px !important;
                height: 50px !important;
            }

            .header-icon i {
                font-size: 20px !important;
            }

            .enhanced-primary-btn {
                padding: 14px 18px !important;
                font-size: 13px !important;
                width: 95% !important;
                letter-spacing: 0.3px !important;
            }

            .add-drug-btn {
                padding: 14px 18px !important;
                font-size: 13px !important;
                width: 95% !important;
                letter-spacing: 0.3px !important;
            }

            .btn-icon {
                width: 28px !important;
                height: 28px !important;
            }

            .btn-icon i {
                font-size: 13px !important;
            }

            .btn-arrow {
                width: 20px !important;
                height: 20px !important;
            }

            .btn-arrow i {
                font-size: 9px !important;
            }

            .btn-arrow {
                width: 25px !important;
                height: 25px !important;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header-card">
            <div class="header-item">
                <i class="fas fa-user"></i>
                <div class="header-item-content">
                    <span class="header-label">Patient</span>
                    <span class="header-value" id="patient-name-display">Loading...</span>
                </div>
            </div>
            <div class="header-item">
                <i class="fas fa-user-md"></i>
                <div class="header-item-content">
                    <span class="header-label">Clinician</span>
                    <span class="header-value" id="clinician-name-display">Loading...</span>
                </div>
            </div>
            <div class="header-item">
                <i class="fas fa-clock"></i>
                <div class="header-item-content">
                    <span class="header-label">Assessment Time</span>
                    <span class="header-value" id="timestamp-display">Loading...</span>
                </div>
            </div>
        </div>



        <!-- Main Content -->
        <div class="form-container">
            <div class="form-header">
                <h1 class="form-title">
                    <i class="fas fa-user-md"></i>
                    Patient Assessment
                </h1>
                <p class="form-subtitle">Enter patient information to assess ADR risk</p>

                <!-- Sample Patient Indication -->
                <div class="sample-indication">
                    <p class="sample-indication-title">
                        <i class="fas fa-lightbulb"></i>
                        Quick Start: Load Sample Patient Data
                    </p>
                    <p class="sample-indication-subtitle">
                        Select a sample patient from the dropdown below to automatically populate the form with
                        realistic clinical data
                    </p>
                </div>

                <div class="sample-controls">
                    <button type="button" id="info-button" class="btn-sample"
                        style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                        <i class="fas fa-info-circle"></i>
                        Project Information
                    </button>
                    <button type="button" id="comparison-button" class="btn-sample"
                        style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                        <i class="fas fa-balance-scale"></i>
                        Scale Comparison
                    </button>
                    <select id="sample-data-selector" class="sample-selector">
                        <option value="">Choose sample patient...</option>
                        <optgroup label="Risk Categories">
                            <option value="high-risk">🔴 High Risk - Elderly with Multiple Comorbidities</option>
                            <option value="medium-risk">🟡 Medium Risk - Middle-aged with Diabetes</option>
                            <option value="low-risk">🟢 Low Risk - Young Healthy Adult</option>
                        </optgroup>
                        <optgroup label="Specific Conditions">
                            <option value="liver-disease">🟠 Liver Disease - Hepatic Impairment</option>
                            <option value="cardiac-patient">❤️ Cardiac Patient - Heart Failure with Arrhythmia</option>
                            <option value="cancer-patient">🎗️ Cancer Patient - Chemotherapy Treatment</option>
                        </optgroup>
                        <optgroup label="Special Populations">
                            <option value="elderly-frail">👵 Elderly Frail - Multiple Medications</option>
                            <option value="pediatric-equivalent">👶 Young Adult - Minimal Risk Profile</option>
                        </optgroup>
                    </select>
                </div>
            </div>

            <form id="adr-form" class="patient-form">
                <!-- Demographics Section -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-user"></i>
                        <h3>Demographics</h3>
                    </div>

                    <!-- Basic Demographics Subsection -->
                    <div class="clinical-subsection" style="margin-bottom: 25px;">
                        <h4
                            style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-id-card" style="color: #4fd1c5;"></i>
                            Basic Information
                        </h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="age">
                                    <i class="fas fa-birthday-cake" style="color: #f59e0b; margin-right: 6px;"></i>
                                    Age (years)
                                </label>
                                <input type="number" id="age" name="age" min="0" max="120"
                                    placeholder="Enter age (0-120 years)" onchange="interpretAge()">
                                <div id="age-interpretation" class="age-interpretation" style="display: none;"></div>
                            </div>
                            <div class="form-group">
                                <label for="sex">
                                    <i class="fas fa-venus-mars" style="color: #4fd1c5; margin-right: 6px;"></i>
                                    Sex
                                </label>
                                <select id="sex" name="sex">
                                    <option value="">Select sex...</option>
                                    <option value="M">Male</option>
                                    <option value="F">Female</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="ethnicity">
                                    <i class="fas fa-globe" style="color: #10b981; margin-right: 6px;"></i>
                                    Ethnicity
                                </label>
                                <select id="ethnicity" name="ethnicity">
                                    <option value="">Select ethnicity...</option>
                                    <option value="White">White</option>
                                    <option value="Asian">Asian</option>
                                    <option value="Black">Black</option>
                                    <option value="Hispanic">Hispanic</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Physical Measurements Subsection -->
                    <div class="clinical-subsection">
                        <h4
                            style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-ruler-combined" style="color: #f87171;"></i>
                            Physical Measurements
                        </h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="height">
                                    <i class="fas fa-arrows-alt-v" style="color: #06b6d4; margin-right: 6px;"></i>
                                    Height (cm)
                                </label>
                                <input type="number" id="height" name="height" min="100" max="250" step="0.1"
                                    placeholder="Enter height (100-250 cm)">
                            </div>
                            <div class="form-group">
                                <label for="weight">
                                    <i class="fas fa-weight" style="color: #f59e0b; margin-right: 6px;"></i>
                                    Weight (kg)
                                </label>
                                <input type="number" id="weight" name="weight" min="30" max="300" step="0.1"
                                    placeholder="Enter weight (30-300 kg)">
                            </div>
                            <div class="form-group">
                                <label for="bmi">
                                    <i class="fas fa-calculator" style="color: #4fd1c5; margin-right: 6px;"></i>
                                    BMI (kg/m²)
                                </label>
                                <input type="number" id="bmi" name="bmi" step="0.1" min="15" max="50"
                                    placeholder="Auto-calculated" readonly>
                                <div class="bmi-display">
                                    <span class="bmi-value" id="bmi-value">--</span>
                                    <span class="bmi-category" id="bmi-category">Enter height & weight</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Laboratory Values Section -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-flask"></i>
                        <h3>Laboratory Values</h3>
                    </div>

                    <!-- Basic Lab Values (Always Visible) -->
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="creatinine">
                                Creatinine (mg/dL)
                                <button type="button" class="lab-interpret-btn"
                                    onclick="interpretLabValue('creatinine')">
                                    <i class="fas fa-microscope"></i> Interpret
                                </button>
                            </label>
                            <input type="number" id="creatinine" name="creatinine" step="0.01" min="0.5" max="15"
                                placeholder="Normal: 0.6-1.2">
                            <div id="creatinine_interpretation" class="lab-interpretation" style="display: none;"></div>
                        </div>
                        <div class="form-group">
                            <label for="egfr">
                                eGFR (mL/min/1.73m²)
                                <button type="button" class="lab-interpret-btn" onclick="interpretLabValue('egfr')">
                                    <i class="fas fa-microscope"></i> Interpret
                                </button>
                            </label>
                            <input type="number" id="egfr" name="egfr" step="0.1" min="5" max="150"
                                placeholder="Normal: >90">
                            <div id="egfr_interpretation" class="lab-interpretation" style="display: none;"></div>
                        </div>
                        <div class="form-group liver-function-group">
                            <label for="ast_alt">
                                AST/ALT (U/L)
                                <div class="lab-buttons">
                                    <button type="button" class="lab-interpret-btn"
                                        onclick="interpretLabValue('ast_alt')">
                                        <i class="fas fa-microscope"></i> Interpret
                                    </button>
                                </div>
                            </label>
                            <input type="number" id="ast_alt" name="ast_alt" min="5" max="1200"
                                placeholder="Normal: 10-40">
                            <div id="ast_alt_interpretation" class="lab-interpretation" style="display: none;"></div>
                        </div>
                        <div class="form-group">
                            <label for="bilirubin">
                                Bilirubin (mg/dL)
                                <button type="button" class="lab-interpret-btn"
                                    onclick="interpretLabValue('bilirubin')">
                                    <i class="fas fa-microscope"></i> Interpret
                                </button>
                            </label>
                            <input type="number" id="bilirubin" name="bilirubin" step="0.01" min="0.1" max="15"
                                placeholder="Normal: 0.2-1.2">
                            <div id="bilirubin_interpretation" class="lab-interpretation" style="display: none;"></div>
                        </div>
                        <div class="form-group">
                            <label for="albumin">
                                Albumin (g/dL)
                                <button type="button" class="lab-interpret-btn" onclick="interpretLabValue('albumin')">
                                    <i class="fas fa-microscope"></i> Interpret
                                </button>
                            </label>
                            <input type="number" id="albumin" name="albumin" step="0.01" min="1" max="800"
                                placeholder="Normal: 3.5-5.0">
                            <div id="albumin_interpretation" class="lab-interpretation" style="display: none;"></div>
                        </div>

                        <!-- NEW FIELDS -->
                        <div class="form-group">
                            <label for="temperature">
                                <i class="fas fa-thermometer-half"></i>
                                Temperature (°F)
                                <button type="button" class="lab-interpret-btn"
                                    onclick="interpretLabValue('temperature')">
                                    <i class="fas fa-thermometer-half"></i> Interpret
                                </button>
                            </label>
                            <input type="number" id="temperature" name="temperature" step="0.1" min="95" max="106"
                                placeholder="Normal: 97.0-99.5">
                            <div id="temperature_interpretation" class="lab-interpretation" style="display: none;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="ind_value">
                                <i class="fas fa-vial"></i>
                                INR (International Normalized Ratio)
                                <button type="button" class="lab-interpret-btn"
                                    onclick="interpretLabValue('ind_value')">
                                    <i class="fas fa-vial"></i> Interpret
                                </button>
                            </label>
                            <input type="number" id="ind_value" name="ind_value" step="0.01" min="0.8" max="5.0"
                                placeholder="Normal: 0.8-1.2">
                            <div id="ind_value_interpretation" class="lab-interpretation" style="display: none;"></div>
                        </div>

                        <div class="form-group">
                            <label for="atpp_value">
                                <i class="fas fa-clock"></i>
                                aPTT (Activated Partial Thromboplastin Time) (sec)
                                <button type="button" class="lab-interpret-btn"
                                    onclick="interpretLabValue('atpp_value')">
                                    <i class="fas fa-clock"></i> Interpret
                                </button>
                            </label>
                            <input type="number" id="atpp_value" name="atpp_value" step="0.1" min="20" max="120"
                                placeholder="Normal: 25-35">
                            <div id="atpp_value_interpretation" class="lab-interpretation" style="display: none;"></div>
                        </div>

                    </div>

                    <!-- Specialized Test Categories -->
                    <div class="specialized-tests-section">
                        <h4 style="margin: 20px 0 15px 0; color: #1e293b; font-size: 1.1rem;">
                            <i class="fas fa-vials"></i> Specialized Laboratory Tests
                        </h4>

                        <!-- Test Category Cards -->
                        <div class="test-category-cards"
                            style="display: grid !important; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)) !important; gap: 16px !important; margin-bottom: 25px !important;">

                            <!-- Diabetes Card -->
                            <div class="test-card" onclick="toggleTestCategory('diabetes')"
                                style="background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%) !important; border-radius: 12px !important; padding: 20px !important; cursor: pointer !important; transition: all 0.3s ease !important; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3) !important; border: none !important;">
                                <div class="test-card-icon"
                                    style="background: rgba(255, 255, 255, 0.2) !important; width: 48px !important; height: 48px !important; border-radius: 12px !important; display: flex !important; align-items: center !important; justify-content: center !important; margin-bottom: 12px !important;">
                                    <i class="fas fa-tint"
                                        style="color: white !important; font-size: 20px !important;"></i>
                                </div>
                                <h6
                                    style="color: white !important; font-size: 1rem !important; font-weight: 600 !important; margin: 0 0 6px 0 !important; line-height: 1.3 !important;">
                                    Diabetes Mellitus</h6>
                                <p
                                    style="color: rgba(255, 255, 255, 0.8) !important; font-size: 0.8rem !important; margin: 0 !important; line-height: 1.4 !important;">
                                    FPG, OGTT, HbA1c, C-Peptide</p>
                            </div>

                            <!-- Liver Disease Card -->
                            <div class="test-card" onclick="toggleTestCategory('liver')"
                                style="background: linear-gradient(135deg, #10b981 0%, #047857 100%) !important; border-radius: 12px !important; padding: 20px !important; cursor: pointer !important; transition: all 0.3s ease !important; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3) !important; border: none !important;">
                                <div class="test-card-icon"
                                    style="background: rgba(255, 255, 255, 0.2) !important; width: 48px !important; height: 48px !important; border-radius: 12px !important; display: flex !important; align-items: center !important; justify-content: center !important; margin-bottom: 12px !important;">
                                    <i class="fas fa-liver"
                                        style="color: white !important; font-size: 20px !important;"></i>
                                </div>
                                <h6
                                    style="color: white !important; font-size: 1rem !important; font-weight: 600 !important; margin: 0 0 6px 0 !important; line-height: 1.3 !important;">
                                    Liver Disease</h6>
                                <p
                                    style="color: rgba(255, 255, 255, 0.8) !important; font-size: 0.8rem !important; margin: 0 !important; line-height: 1.4 !important;">
                                    ALT, AST, ALP, GGT, Bilirubin</p>
                            </div>

                            <!-- Kidney Disease Card -->
                            <div class="test-card" onclick="toggleTestCategory('kidney')"
                                style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%) !important; border-radius: 12px !important; padding: 20px !important; cursor: pointer !important; transition: all 0.3s ease !important; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3) !important; border: none !important;">
                                <div class="test-card-icon"
                                    style="background: rgba(255, 255, 255, 0.2) !important; width: 48px !important; height: 48px !important; border-radius: 12px !important; display: flex !important; align-items: center !important; justify-content: center !important; margin-bottom: 12px !important;">
                                    <i class="fas fa-kidneys"
                                        style="color: white !important; font-size: 20px !important;"></i>
                                </div>
                                <h6
                                    style="color: white !important; font-size: 1rem !important; font-weight: 600 !important; margin: 0 0 6px 0 !important; line-height: 1.3 !important;">
                                    Chronic Kidney Disease</h6>
                                <p
                                    style="color: rgba(255, 255, 255, 0.8) !important; font-size: 0.8rem !important; margin: 0 !important; line-height: 1.4 !important;">
                                    Creatinine, BUN, eGFR, UACR</p>
                            </div>

                            <!-- Cardiac Disease Card -->
                            <div class="test-card" onclick="toggleTestCategory('cardiac')"
                                style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important; border-radius: 12px !important; padding: 20px !important; cursor: pointer !important; transition: all 0.3s ease !important; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3) !important; border: none !important;">
                                <div class="test-card-icon"
                                    style="background: rgba(255, 255, 255, 0.2) !important; width: 48px !important; height: 48px !important; border-radius: 12px !important; display: flex !important; align-items: center !important; justify-content: center !important; margin-bottom: 12px !important;">
                                    <i class="fas fa-heartbeat"
                                        style="color: white !important; font-size: 20px !important;"></i>
                                </div>
                                <h6
                                    style="color: white !important; font-size: 1rem !important; font-weight: 600 !important; margin: 0 0 6px 0 !important; line-height: 1.3 !important;">
                                    Cardiac Disease</h6>
                                <p
                                    style="color: rgba(255, 255, 255, 0.8) !important; font-size: 0.8rem !important; margin: 0 !important; line-height: 1.4 !important;">
                                    Troponin, CK-MB, BNP, Lipids</p>
                            </div>

                            <!-- Hypertension Card -->
                            <div class="test-card" onclick="toggleTestCategory('hypertension')"
                                style="background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%) !important; border-radius: 12px !important; padding: 20px !important; cursor: pointer !important; transition: all 0.3s ease !important; box-shadow: 0 4px 15px rgba(79, 209, 197, 0.3) !important; border: none !important;">
                                <div class="test-card-icon"
                                    style="background: rgba(255, 255, 255, 0.2) !important; width: 48px !important; height: 48px !important; border-radius: 12px !important; display: flex !important; align-items: center !important; justify-content: center !important; margin-bottom: 12px !important;">
                                    <i class="fas fa-thermometer-half"
                                        style="color: white !important; font-size: 20px !important;"></i>
                                </div>
                                <h6
                                    style="color: white !important; font-size: 1rem !important; font-weight: 600 !important; margin: 0 0 6px 0 !important; line-height: 1.3 !important;">
                                    Hypertension</h6>
                                <p
                                    style="color: rgba(255, 255, 255, 0.8) !important; font-size: 0.8rem !important; margin: 0 !important; line-height: 1.4 !important;">
                                    Renin, Aldosterone, ABPM</p>
                            </div>

                            <!-- Respiratory Disease Card -->
                            <div class="test-card" onclick="toggleTestCategory('respiratory')"
                                style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%) !important; border-radius: 12px !important; padding: 20px !important; cursor: pointer !important; transition: all 0.3s ease !important; box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3) !important; border: none !important;">
                                <div class="test-card-icon"
                                    style="background: rgba(255, 255, 255, 0.2) !important; width: 48px !important; height: 48px !important; border-radius: 12px !important; display: flex !important; align-items: center !important; justify-content: center !important; margin-bottom: 12px !important;">
                                    <i class="fas fa-lungs"
                                        style="color: white !important; font-size: 20px !important;"></i>
                                </div>
                                <h6
                                    style="color: white !important; font-size: 1rem !important; font-weight: 600 !important; margin: 0 0 6px 0 !important; line-height: 1.3 !important;">
                                    Respiratory Disease</h6>
                                <p
                                    style="color: rgba(255, 255, 255, 0.8) !important; font-size: 0.8rem !important; margin: 0 !important; line-height: 1.4 !important;">
                                    ABG, Spirometry, PEFR, DLCO</p>
                            </div>

                            <!-- Neurological Disease Card -->
                            <div class="test-card" onclick="toggleTestCategory('neurological')"
                                style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%) !important; border-radius: 12px !important; padding: 20px !important; cursor: pointer !important; transition: all 0.3s ease !important; box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3) !important; border: none !important;">
                                <div class="test-card-icon"
                                    style="background: rgba(255, 255, 255, 0.2) !important; width: 48px !important; height: 48px !important; border-radius: 12px !important; display: flex !important; align-items: center !important; justify-content: center !important; margin-bottom: 12px !important;">
                                    <i class="fas fa-brain"
                                        style="color: white !important; font-size: 20px !important;"></i>
                                </div>
                                <h6
                                    style="color: white !important; font-size: 1rem !important; font-weight: 600 !important; margin: 0 0 6px 0 !important; line-height: 1.3 !important;">
                                    Neurological Disease</h6>
                                <p
                                    style="color: rgba(255, 255, 255, 0.8) !important; font-size: 0.8rem !important; margin: 0 !important; line-height: 1.4 !important;">
                                    MRI, EEG, CSF, NCS, Amyloid</p>
                            </div>

                            <!-- Autoimmune Disease Card -->
                            <div class="test-card" onclick="toggleTestCategory('autoimmune')"
                                style="background: linear-gradient(135deg, #84cc16 0%, #65a30d 100%) !important; border-radius: 12px !important; padding: 20px !important; cursor: pointer !important; transition: all 0.3s ease !important; box-shadow: 0 4px 15px rgba(132, 204, 22, 0.3) !important; border: none !important;">
                                <div class="test-card-icon"
                                    style="background: rgba(255, 255, 255, 0.2) !important; width: 48px !important; height: 48px !important; border-radius: 12px !important; display: flex !important; align-items: center !important; justify-content: center !important; margin-bottom: 12px !important;">
                                    <i class="fas fa-shield-virus"
                                        style="color: white !important; font-size: 20px !important;"></i>
                                </div>
                                <h6
                                    style="color: white !important; font-size: 1rem !important; font-weight: 600 !important; margin: 0 0 6px 0 !important; line-height: 1.3 !important;">
                                    Autoimmune Disease</h6>
                                <p
                                    style="color: rgba(255, 255, 255, 0.8) !important; font-size: 0.8rem !important; margin: 0 !important; line-height: 1.4 !important;">
                                    ANA, RF, Anti-CCP, ESR, CRP</p>
                            </div>

                            <!-- Complete Blood Count (CBC) Card -->
                            <div class="test-card" onclick="toggleTestCategory('cbc')"
                                style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%) !important; border-radius: 12px !important; padding: 20px !important; cursor: pointer !important; transition: all 0.3s ease !important; box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3) !important; border: none !important;">
                                <div class="test-card-icon"
                                    style="background: rgba(255, 255, 255, 0.2) !important; width: 48px !important; height: 48px !important; border-radius: 12px !important; display: flex !important; align-items: center !important; justify-content: center !important; margin-bottom: 12px !important;">
                                    <i class="fas fa-microscope"
                                        style="color: white !important; font-size: 20px !important;"></i>
                                </div>
                                <h6
                                    style="color: white !important; font-size: 1rem !important; font-weight: 600 !important; margin: 0 0 6px 0 !important; line-height: 1.3 !important;">
                                    Complete Blood Count (CBC)</h6>
                                <p
                                    style="color: rgba(255, 255, 255, 0.8) !important; font-size: 0.8rem !important; margin: 0 !important; line-height: 1.4 !important;">
                                    Hemoglobin, Hematocrit, WBC, RBC, Platelets</p>
                            </div>

                        </div>

                        <!-- 1. Diabetes Mellitus Tests -->
                        <div id="diabetes-tests" class="test-category-section" style="display: none;">
                            <h5><i class="fas fa-tint"></i> Diabetes Mellitus Tests</h5>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="fpg">Fasting Plasma Glucose (FPG) (mg/dL)</label>
                                    <input type="number" id="fpg" name="fpg" step="0.1" min="50" max="500"
                                        placeholder="Normal: 70-100">
                                </div>
                                <div class="form-group">
                                    <label for="ogtt">Oral Glucose Tolerance Test (OGTT) (mg/dL)</label>
                                    <input type="number" id="ogtt" name="ogtt" step="0.1" min="50" max="500"
                                        placeholder="Normal: <140">
                                </div>
                                <div class="form-group">
                                    <label for="hba1c">HbA1c (%)</label>
                                    <input type="number" id="hba1c" name="hba1c" step="0.1" min="3" max="20"
                                        placeholder="Normal: <5.7">
                                </div>
                                <div class="form-group">
                                    <label for="c_peptide">C-Peptide (ng/mL)</label>
                                    <input type="number" id="c_peptide" name="c_peptide" step="0.01" min="0" max="10"
                                        placeholder="Normal: 0.8-3.1">
                                </div>
                                <div class="form-group">
                                    <label for="insulin_levels">Insulin Levels (μU/mL)</label>
                                    <input type="number" id="insulin_levels" name="insulin_levels" step="0.1" min="0"
                                        max="200" placeholder="Normal: 2.6-24.9">
                                </div>
                                <div class="form-group">
                                    <label for="fructosamine">Fructosamine (μmol/L)</label>
                                    <input type="number" id="fructosamine" name="fructosamine" step="1" min="100"
                                        max="500" placeholder="Normal: 205-285">
                                </div>
                            </div>
                        </div>

                        <!-- 2. Liver Disease Tests -->
                        <div id="liver-tests" class="test-category-section" style="display: none;">
                            <h5><i class="fas fa-liver"></i> Liver Disease Tests</h5>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="alt">Alanine Aminotransferase (ALT) (U/L)</label>
                                    <input type="number" id="alt" name="alt" step="1" min="0" max="1000"
                                        placeholder="Normal: 7-56">
                                </div>
                                <div class="form-group">
                                    <label for="ast">Aspartate Aminotransferase (AST) (U/L)</label>
                                    <input type="number" id="ast" name="ast" step="1" min="0" max="1000"
                                        placeholder="Normal: 10-40">
                                </div>
                                <div class="form-group">
                                    <label for="alp">Alkaline Phosphatase (ALP) (U/L)</label>
                                    <input type="number" id="alp" name="alp" step="1" min="0" max="1000"
                                        placeholder="Normal: 44-147">
                                </div>
                                <div class="form-group">
                                    <label for="ggt">Gamma-Glutamyl Transferase (GGT) (U/L)</label>
                                    <input type="number" id="ggt" name="ggt" step="1" min="0" max="500"
                                        placeholder="Normal: 9-48">
                                </div>
                                <div class="form-group">
                                    <label for="total_bilirubin">Total Bilirubin (mg/dL)</label>
                                    <input type="number" id="total_bilirubin" name="total_bilirubin" step="0.01" min="0"
                                        max="20" placeholder="Normal: 0.2-1.2">
                                </div>
                                <div class="form-group">
                                    <label for="direct_bilirubin">Direct Bilirubin (mg/dL)</label>
                                    <input type="number" id="direct_bilirubin" name="direct_bilirubin" step="0.01"
                                        min="0" max="10" placeholder="Normal: 0.0-0.3">
                                </div>
                                <div class="form-group">
                                    <label for="liver_albumin">Albumin (g/dL)</label>
                                    <input type="number" id="liver_albumin" name="liver_albumin" step="0.01" min="1"
                                        max="6" placeholder="Normal: 3.5-5.0">
                                </div>
                                <div class="form-group">
                                    <label for="pt">Prothrombin Time (PT) (seconds)</label>
                                    <input type="number" id="pt" name="pt" step="0.1" min="5" max="50"
                                        placeholder="Normal: 11-13">
                                </div>
                            </div>
                        </div>

                        <!-- 3. Chronic Kidney Disease Tests -->
                        <div id="kidney-tests" class="test-category-section" style="display: none;">
                            <h5><i class="fas fa-kidneys"></i> Chronic Kidney Disease Tests</h5>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="serum_creatinine">Serum Creatinine (mg/dL)</label>
                                    <input type="number" id="serum_creatinine" name="serum_creatinine" step="0.01"
                                        min="0.3" max="15" placeholder="Normal: 0.6-1.2">
                                </div>
                                <div class="form-group">
                                    <label for="bun">Blood Urea Nitrogen (BUN) (mg/dL)</label>
                                    <input type="number" id="bun" name="bun" step="1" min="5" max="200"
                                        placeholder="Normal: 7-20">
                                </div>
                                <div class="form-group">
                                    <label for="kidney_egfr">eGFR (mL/min/1.73m²)</label>
                                    <input type="number" id="kidney_egfr" name="kidney_egfr" step="0.1" min="5"
                                        max="150" placeholder="Normal: >90">
                                </div>
                                <div class="form-group">
                                    <label for="uacr">Urine Albumin-to-Creatinine Ratio (UACR) (mg/g)</label>
                                    <input type="number" id="uacr" name="uacr" step="0.1" min="0" max="5000"
                                        placeholder="Normal: <30">
                                </div>
                                <div class="form-group">
                                    <label for="cystatin_c">Cystatin C (mg/L)</label>
                                    <input type="number" id="cystatin_c" name="cystatin_c" step="0.01" min="0.5" max="5"
                                        placeholder="Normal: 0.62-1.15">
                                </div>
                                <div class="form-group">
                                    <label for="sodium">Sodium (Na⁺) (mEq/L)</label>
                                    <input type="number" id="sodium" name="sodium" step="0.1" min="120" max="160"
                                        placeholder="Normal: 136-145">
                                </div>
                                <div class="form-group">
                                    <label for="potassium">Potassium (K⁺) (mEq/L)</label>
                                    <input type="number" id="potassium" name="potassium" step="0.1" min="2" max="8"
                                        placeholder="Normal: 3.5-5.0">
                                </div>
                                <div class="form-group">
                                    <label for="chloride">Chloride (Cl⁻) (mEq/L)</label>
                                    <input type="number" id="chloride" name="chloride" step="0.1" min="90" max="120"
                                        placeholder="Normal: 98-107">
                                </div>
                            </div>
                        </div>

                        <!-- 4. Cardiac Disease Tests -->
                        <div id="cardiac-tests" class="test-category-section" style="display: none;">
                            <h5><i class="fas fa-heartbeat"></i> Cardiac Disease Tests</h5>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="troponin_i">Troponin I (ng/mL)</label>
                                    <input type="number" id="troponin_i" name="troponin_i" step="0.001" min="0" max="50"
                                        placeholder="Normal: <0.04">
                                </div>
                                <div class="form-group">
                                    <label for="troponin_t">Troponin T (ng/mL)</label>
                                    <input type="number" id="troponin_t" name="troponin_t" step="0.001" min="0" max="50"
                                        placeholder="Normal: <0.01">
                                </div>
                                <div class="form-group">
                                    <label for="ck_mb">Creatine Kinase-MB (CK-MB) (ng/mL)</label>
                                    <input type="number" id="ck_mb" name="ck_mb" step="0.1" min="0" max="100"
                                        placeholder="Normal: <6.3">
                                </div>
                                <div class="form-group">
                                    <label for="bnp">B-type Natriuretic Peptide (BNP) (pg/mL)</label>
                                    <input type="number" id="bnp" name="bnp" step="1" min="0" max="5000"
                                        placeholder="Normal: <100">
                                </div>
                                <div class="form-group">
                                    <label for="nt_probnp">NT-proBNP (pg/mL)</label>
                                    <input type="number" id="nt_probnp" name="nt_probnp" step="1" min="0" max="10000"
                                        placeholder="Normal: <125">
                                </div>
                                <div class="form-group">
                                    <label for="ldl">LDL Cholesterol (mg/dL)</label>
                                    <input type="number" id="ldl" name="ldl" step="1" min="20" max="500"
                                        placeholder="Normal: <100">
                                </div>
                                <div class="form-group">
                                    <label for="hdl">HDL Cholesterol (mg/dL)</label>
                                    <input type="number" id="hdl" name="hdl" step="1" min="10" max="150"
                                        placeholder="Normal: >40 (M), >50 (F)">
                                </div>
                                <div class="form-group">
                                    <label for="triglycerides">Triglycerides (mg/dL)</label>
                                    <input type="number" id="triglycerides" name="triglycerides" step="1" min="20"
                                        max="1000" placeholder="Normal: <150">
                                </div>
                                <div class="form-group">
                                    <label for="total_cholesterol">Total Cholesterol (mg/dL)</label>
                                    <input type="number" id="total_cholesterol" name="total_cholesterol" step="1"
                                        min="100" max="500" placeholder="Normal: <200">
                                </div>
                                <div class="form-group">
                                    <label for="hs_crp">High-sensitivity CRP (mg/L)</label>
                                    <input type="number" id="hs_crp" name="hs_crp" step="0.01" min="0" max="50"
                                        placeholder="Normal: <3.0">
                                </div>
                            </div>
                        </div>

                        <!-- 5. Hypertension Tests -->
                        <div id="hypertension-tests" class="test-category-section" style="display: none;">
                            <h5><i class="fas fa-thermometer-half"></i> Hypertension Tests</h5>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="plasma_renin">Plasma Renin Activity (ng/mL/hr)</label>
                                    <input type="number" id="plasma_renin" name="plasma_renin" step="0.1" min="0"
                                        max="50" placeholder="Normal: 0.2-2.3">
                                </div>
                                <div class="form-group">
                                    <label for="serum_aldosterone">Serum Aldosterone (ng/dL)</label>
                                    <input type="number" id="serum_aldosterone" name="serum_aldosterone" step="0.1"
                                        min="0" max="100" placeholder="Normal: 4-31">
                                </div>
                                <div class="form-group">
                                    <label for="htn_sodium">Sodium (Na⁺) (mEq/L)</label>
                                    <input type="number" id="htn_sodium" name="htn_sodium" step="0.1" min="120"
                                        max="160" placeholder="Normal: 136-145">
                                </div>
                                <div class="form-group">
                                    <label for="htn_potassium">Potassium (K⁺) (mEq/L)</label>
                                    <input type="number" id="htn_potassium" name="htn_potassium" step="0.1" min="2"
                                        max="8" placeholder="Normal: 3.5-5.0">
                                </div>
                                <div class="form-group">
                                    <label for="urinary_metanephrines">Urinary Metanephrines (μg/24hr)</label>
                                    <input type="number" id="urinary_metanephrines" name="urinary_metanephrines"
                                        step="1" min="0" max="2000" placeholder="Normal: <350">
                                </div>
                                <div class="form-group">
                                    <label for="abpm_systolic">ABPM Average Systolic (mmHg)</label>
                                    <input type="number" id="abpm_systolic" name="abpm_systolic" step="1" min="80"
                                        max="250" placeholder="Normal: <130">
                                </div>
                                <div class="form-group">
                                    <label for="abpm_diastolic">ABPM Average Diastolic (mmHg)</label>
                                    <input type="number" id="abpm_diastolic" name="abpm_diastolic" step="1" min="40"
                                        max="150" placeholder="Normal: <80">
                                </div>
                            </div>
                        </div>

                        <!-- 6. Respiratory Disease Tests -->
                        <div id="respiratory-tests" class="test-category-section" style="display: none;">
                            <h5><i class="fas fa-lungs"></i> Respiratory Disease Tests</h5>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="abg_ph">ABG pH</label>
                                    <input type="number" id="abg_ph" name="abg_ph" step="0.01" min="6.8" max="7.8"
                                        placeholder="Normal: 7.35-7.45">
                                </div>
                                <div class="form-group">
                                    <label for="abg_pco2">ABG PCO₂ (mmHg)</label>
                                    <input type="number" id="abg_pco2" name="abg_pco2" step="0.1" min="10" max="100"
                                        placeholder="Normal: 35-45">
                                </div>
                                <div class="form-group">
                                    <label for="abg_po2">ABG PO₂ (mmHg)</label>
                                    <input type="number" id="abg_po2" name="abg_po2" step="0.1" min="40" max="150"
                                        placeholder="Normal: 80-100">
                                </div>
                                <div class="form-group">
                                    <label for="fev1">FEV₁ (L)</label>
                                    <input type="number" id="fev1" name="fev1" step="0.01" min="0.5" max="6"
                                        placeholder="Normal: >80% predicted">
                                </div>
                                <div class="form-group">
                                    <label for="fvc">FVC (L)</label>
                                    <input type="number" id="fvc" name="fvc" step="0.01" min="0.5" max="8"
                                        placeholder="Normal: >80% predicted">
                                </div>
                                <div class="form-group">
                                    <label for="pefr">Peak Expiratory Flow Rate (L/min)</label>
                                    <input type="number" id="pefr" name="pefr" step="1" min="100" max="800"
                                        placeholder="Normal: varies by age/sex">
                                </div>
                                <div class="form-group">
                                    <label for="pulse_oximetry">Pulse Oximetry (%)</label>
                                    <input type="number" id="pulse_oximetry" name="pulse_oximetry" step="0.1" min="70"
                                        max="100" placeholder="Normal: >95%">
                                </div>
                                <div class="form-group">
                                    <label for="dlco">DLCO (mL/min/mmHg)</label>
                                    <input type="number" id="dlco" name="dlco" step="0.1" min="5" max="50"
                                        placeholder="Normal: >75% predicted">
                                </div>
                            </div>
                        </div>

                        <!-- 7. Neurological Disease Tests -->
                        <div id="neurological-tests" class="test-category-section" style="display: none;">
                            <h5><i class="fas fa-brain"></i> Neurological Disease Tests</h5>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="mri_findings">MRI Brain Findings</label>
                                    <select id="mri_findings" name="mri_findings">
                                        <option value="">Select findings...</option>
                                        <option value="normal">Normal</option>
                                        <option value="atrophy">Cerebral Atrophy</option>
                                        <option value="infarct">Infarct</option>
                                        <option value="hemorrhage">Hemorrhage</option>
                                        <option value="tumor">Mass/Tumor</option>
                                        <option value="demyelination">Demyelination</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="ct_findings">CT Brain Findings</label>
                                    <select id="ct_findings" name="ct_findings">
                                        <option value="">Select findings...</option>
                                        <option value="normal">Normal</option>
                                        <option value="atrophy">Atrophy</option>
                                        <option value="infarct">Infarct</option>
                                        <option value="hemorrhage">Hemorrhage</option>
                                        <option value="mass">Mass Effect</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="eeg_findings">EEG Findings</label>
                                    <select id="eeg_findings" name="eeg_findings">
                                        <option value="">Select findings...</option>
                                        <option value="normal">Normal</option>
                                        <option value="seizure">Seizure Activity</option>
                                        <option value="slowing">Generalized Slowing</option>
                                        <option value="focal">Focal Abnormalities</option>
                                        <option value="spikes">Spike-Wave Complexes</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="csf_protein">CSF Protein (mg/dL)</label>
                                    <input type="number" id="csf_protein" name="csf_protein" step="1" min="10" max="500"
                                        placeholder="Normal: 15-45">
                                </div>
                                <div class="form-group">
                                    <label for="csf_glucose">CSF Glucose (mg/dL)</label>
                                    <input type="number" id="csf_glucose" name="csf_glucose" step="1" min="10" max="200"
                                        placeholder="Normal: 50-80">
                                </div>
                                <div class="form-group">
                                    <label for="csf_cells">CSF Cell Count (cells/μL)</label>
                                    <input type="number" id="csf_cells" name="csf_cells" step="1" min="0" max="1000"
                                        placeholder="Normal: <5">
                                </div>
                                <div class="form-group">
                                    <label for="ncs_findings">Nerve Conduction Studies</label>
                                    <select id="ncs_findings" name="ncs_findings">
                                        <option value="">Select findings...</option>
                                        <option value="normal">Normal</option>
                                        <option value="neuropathy">Peripheral Neuropathy</option>
                                        <option value="myopathy">Myopathy</option>
                                        <option value="radiculopathy">Radiculopathy</option>
                                        <option value="carpal_tunnel">Carpal Tunnel Syndrome</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="ck_total">Creatine Kinase (CK) (U/L)</label>
                                    <input type="number" id="ck_total" name="ck_total" step="1" min="20" max="5000"
                                        placeholder="Normal: 30-200">
                                </div>
                                <div class="form-group">
                                    <label for="amyloid_beta">Amyloid Beta (pg/mL)</label>
                                    <input type="number" id="amyloid_beta" name="amyloid_beta" step="1" min="100"
                                        max="2000" placeholder="Normal: >500">
                                </div>
                                <div class="form-group">
                                    <label for="tau_protein">Tau Protein (pg/mL)</label>
                                    <input type="number" id="tau_protein" name="tau_protein" step="1" min="50"
                                        max="1000" placeholder="Normal: <300">
                                </div>
                            </div>
                        </div>

                        <!-- 8. Autoimmune Disease Tests -->
                        <div id="autoimmune-tests" class="test-category-section" style="display: none;">
                            <h5><i class="fas fa-shield-virus"></i> Autoimmune Disease Tests</h5>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="ana">Antinuclear Antibody (ANA)</label>
                                    <select id="ana" name="ana">
                                        <option value="">Select result...</option>
                                        <option value="negative">Negative</option>
                                        <option value="1:80">1:80</option>
                                        <option value="1:160">1:160</option>
                                        <option value="1:320">1:320</option>
                                        <option value="1:640">1:640</option>
                                        <option value="1:1280">1:1280</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="rf">Rheumatoid Factor (RF) (IU/mL)</label>
                                    <input type="number" id="rf" name="rf" step="0.1" min="0" max="500"
                                        placeholder="Normal: <14">
                                </div>
                                <div class="form-group">
                                    <label for="anti_ccp">Anti-CCP (U/mL)</label>
                                    <input type="number" id="anti_ccp" name="anti_ccp" step="0.1" min="0" max="300"
                                        placeholder="Normal: <20">
                                </div>
                                <div class="form-group">
                                    <label for="esr">ESR (mm/hr)</label>
                                    <input type="number" id="esr" name="esr" step="1" min="0" max="150"
                                        placeholder="Normal: <30">
                                </div>
                                <div class="form-group">
                                    <label for="autoimmune_crp">CRP (mg/L)</label>
                                    <input type="number" id="autoimmune_crp" name="autoimmune_crp" step="0.1" min="0"
                                        max="200" placeholder="Normal: <3.0">
                                </div>
                                <div class="form-group">
                                    <label for="c3">Complement C3 (mg/dL)</label>
                                    <input type="number" id="c3" name="c3" step="1" min="20" max="200"
                                        placeholder="Normal: 90-180">
                                </div>
                                <div class="form-group">
                                    <label for="c4">Complement C4 (mg/dL)</label>
                                    <input type="number" id="c4" name="c4" step="1" min="5" max="100"
                                        placeholder="Normal: 10-40">
                                </div>
                                <div class="form-group">
                                    <label for="anti_dsdna">Anti-dsDNA (IU/mL)</label>
                                    <input type="number" id="anti_dsdna" name="anti_dsdna" step="0.1" min="0" max="500"
                                        placeholder="Normal: <7">
                                </div>
                            </div>
                        </div>

                        <!-- 9. Complete Blood Count (CBC) Tests -->
                        <div id="cbc-tests" class="test-category-section" style="display: none;">
                            <h5><i class="fas fa-microscope"></i> Complete Blood Count (CBC)</h5>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="hemoglobin">
                                        <i class="fas fa-tint"></i>
                                        Hemoglobin (g/dL)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('hemoglobin')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="hemoglobin" name="hemoglobin" step="0.1" min="6" max="20"
                                        placeholder="Normal: M: 13.5-17.5, F: 12.0-15.5">
                                    <div id="hemoglobin_interpretation" class="lab-interpretation"
                                        style="display: none;"></div>
                                </div>

                                <div class="form-group">
                                    <label for="hematocrit">
                                        <i class="fas fa-percentage"></i>
                                        Hematocrit (%)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('hematocrit')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="hematocrit" name="hematocrit" step="0.1" min="18" max="60"
                                        placeholder="Normal: M: 41-50, F: 36-44">
                                    <div id="hematocrit_interpretation" class="lab-interpretation"
                                        style="display: none;"></div>
                                </div>

                                <div class="form-group">
                                    <label for="wbc_count">
                                        <i class="fas fa-shield-virus"></i>
                                        WBC Count (in lakhs)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('wbc_count')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="wbc_count" name="wbc_count" step="0.1" min="2" max="30"
                                        placeholder="Normal: 4.5-11.0 lakhs">
                                    <div id="wbc_count_interpretation" class="lab-interpretation"
                                        style="display: none;"></div>
                                </div>

                                <div class="form-group">
                                    <label for="platelet_count">
                                        <i class="fas fa-circle"></i>
                                        Platelet Count (in lakhs)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('platelet_count')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="platelet_count" name="platelet_count" step="1" min="50"
                                        max="600" placeholder="Normal: 150-450 lakhs">
                                    <div id="platelet_count_interpretation" class="lab-interpretation"
                                        style="display: none;"></div>
                                </div>

                                <div class="form-group">
                                    <label for="rbc_count">
                                        <i class="fas fa-circle-notch"></i>
                                        RBC Count (×10⁶/μL)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('rbc_count')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="rbc_count" name="rbc_count" step="0.01" min="3" max="7"
                                        placeholder="Normal: M: 4.7-6.1, F: 4.2-5.4">
                                    <div id="rbc_count_interpretation" class="lab-interpretation"
                                        style="display: none;"></div>
                                </div>

                                <div class="form-group">
                                    <label for="neutrophils">
                                        <i class="fas fa-shield"></i>
                                        Neutrophils (%)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('neutrophils')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="neutrophils" name="neutrophils" step="0.1" min="0"
                                        max="100" placeholder="Normal: 50-70">
                                    <div id="neutrophils_interpretation" class="lab-interpretation"
                                        style="display: none;"></div>
                                </div>

                                <div class="form-group">
                                    <label for="lymphocytes">
                                        <i class="fas fa-virus"></i>
                                        Lymphocytes (%)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('lymphocytes')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="lymphocytes" name="lymphocytes" step="0.1" min="0"
                                        max="100" placeholder="Normal: 20-40">
                                    <div id="lymphocytes_interpretation" class="lab-interpretation"
                                        style="display: none;"></div>
                                </div>

                                <div class="form-group">
                                    <label for="monocytes">
                                        <i class="fas fa-bacteria"></i>
                                        Monocytes (%)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('monocytes')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="monocytes" name="monocytes" step="0.1" min="0" max="20"
                                        placeholder="Normal: 2-8">
                                    <div id="monocytes_interpretation" class="lab-interpretation"
                                        style="display: none;"></div>
                                </div>

                                <div class="form-group">
                                    <label for="eosinophils">
                                        <i class="fas fa-allergies"></i>
                                        Eosinophils (%)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('eosinophils')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="eosinophils" name="eosinophils" step="0.1" min="0" max="20"
                                        placeholder="Normal: 1-4">
                                    <div id="eosinophils_interpretation" class="lab-interpretation"
                                        style="display: none;"></div>
                                </div>

                                <div class="form-group">
                                    <label for="basophils">
                                        <i class="fas fa-dot-circle"></i>
                                        Basophils (%)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('basophils')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="basophils" name="basophils" step="0.1" min="0" max="5"
                                        placeholder="Normal: 0.5-1">
                                    <div id="basophils_interpretation" class="lab-interpretation"
                                        style="display: none;"></div>
                                </div>

                                <div class="form-group">
                                    <label for="mcv">
                                        <i class="fas fa-expand-arrows-alt"></i>
                                        Mean Corpuscular Volume (MCV) (fL)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('mcv')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="mcv" name="mcv" step="0.1" min="60" max="120"
                                        placeholder="Normal: 80-100">
                                    <div id="mcv_interpretation" class="lab-interpretation" style="display: none;">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="mch">
                                        <i class="fas fa-weight"></i>
                                        Mean Corpuscular Hemoglobin (MCH) (pg)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('mch')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="mch" name="mch" step="0.1" min="20" max="40"
                                        placeholder="Normal: 27-32">
                                    <div id="mch_interpretation" class="lab-interpretation" style="display: none;">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="mchc">
                                        <i class="fas fa-compress"></i>
                                        MCHC (g/dL)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('mchc')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="mchc" name="mchc" step="0.1" min="25" max="40"
                                        placeholder="Normal: 32-36">
                                    <div id="mchc_interpretation" class="lab-interpretation" style="display: none;">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="rdw">
                                        <i class="fas fa-chart-bar"></i>
                                        Red Cell Distribution Width (RDW) (%)
                                        <button type="button" class="lab-interpret-btn"
                                            onclick="interpretLabValue('rdw')">
                                            <i class="fas fa-microscope"></i> Interpret
                                        </button>
                                    </label>
                                    <input type="number" id="rdw" name="rdw" step="0.1" min="10" max="25"
                                        placeholder="Normal: 11.5-14.5">
                                    <div id="rdw_interpretation" class="lab-interpretation" style="display: none;">
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>

                <!-- Comorbidities Section -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-notes-medical"></i>
                        <h3>Comorbidities</h3>
                    </div>

                    <!-- Metabolic & Endocrine Conditions -->
                    <div class="clinical-subsection" style="margin-bottom: 25px;">
                        <h4
                            style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-tint" style="color: #60a5fa;"></i>
                            Metabolic & Endocrine Conditions
                        </h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-group">
                                <input type="checkbox" id="diabetes" name="diabetes" value="1">
                                <label for="diabetes">
                                    <i class="fas fa-syringe" style="color: #3b82f6; margin-right: 6px;"></i>
                                    Diabetes Mellitus
                                </label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="hypertension" name="hypertension" value="1">
                                <label for="hypertension">
                                    <i class="fas fa-tachometer-alt" style="color: #ef4444; margin-right: 6px;"></i>
                                    Hypertension
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Organ System Diseases -->
                    <div class="clinical-subsection" style="margin-bottom: 25px;">
                        <h4
                            style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-heartbeat" style="color: #f87171;"></i>
                            Major Organ System Diseases
                        </h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-group">
                                <input type="checkbox" id="cardiac_disease" name="cardiac_disease" value="1">
                                <label for="cardiac_disease">
                                    <i class="fas fa-heart" style="color: #ef4444; margin-right: 6px;"></i>
                                    Cardiac Disease
                                </label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="liver_disease" name="liver_disease" value="1">
                                <label for="liver_disease">
                                    <i class="fas fa-liver" style="color: #10b981; margin-right: 6px;"></i>
                                    Liver Disease
                                </label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ckd" name="ckd" value="1">
                                <label for="ckd">
                                    <i class="fas fa-kidneys" style="color: #f59e0b; margin-right: 6px;"></i>
                                    Chronic Kidney Disease
                                </label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="respiratory_disease" name="respiratory_disease" value="1">
                                <label for="respiratory_disease">
                                    <i class="fas fa-lungs" style="color: #06b6d4; margin-right: 6px;"></i>
                                    Respiratory Disease
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Neurological & Immune System -->
                    <div class="clinical-subsection">
                        <h4
                            style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-brain" style="color: #a78bfa;"></i>
                            Neurological & Immune System
                        </h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-group">
                                <input type="checkbox" id="neurological_disease" name="neurological_disease" value="1">
                                <label for="neurological_disease">
                                    <i class="fas fa-brain" style="color: #4fd1c5; margin-right: 6px;"></i>
                                    Neurological Disease
                                </label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="autoimmune_disease" name="autoimmune_disease" value="1">
                                <label for="autoimmune_disease">
                                    <i class="fas fa-shield-virus" style="color: #84cc16; margin-right: 6px;"></i>
                                    Autoimmune Disease
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Medication Information -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-pills"></i>
                        <h3>Medication Information</h3>
                    </div>

                    <!-- Primary Medication Subsection -->
                    <div class="clinical-subsection" style="margin-bottom: 25px;">
                        <h4
                            style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-prescription-bottle-alt" style="color: #60a5fa;"></i>
                            Primary Medication
                        </h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="medication_name">
                                    <i class="fas fa-pills" style="color: #3b82f6; margin-right: 6px;"></i>
                                    Medication Name
                                </label>
                                <input type="text" id="medication_name" name="medication_name"
                                    placeholder="Enter medication name (e.g., Warfarin)">
                            </div>
                            <div class="form-group">
                                <label for="index_drug_dose">
                                    <i class="fas fa-balance-scale" style="color: #f59e0b; margin-right: 6px;"></i>
                                    Drug Dose (mg)
                                </label>
                                <input type="number" id="index_drug_dose" name="index_drug_dose" min="1" max="2000"
                                    step="0.1" placeholder="Enter dose (1-2000 mg)">
                            </div>
                            <div class="form-group">
                                <label for="time_since_start_days">
                                    <i class="fas fa-calendar-alt" style="color: #10b981; margin-right: 6px;"></i>
                                    Days Since Drug Start
                                </label>
                                <input type="number" id="time_since_start_days" name="time_since_start_days" min="1"
                                    max="365" placeholder="Days (1-365)">
                            </div>
                        </div>
                    </div>

                    <!-- Concomitant Medications Subsection -->
                    <div class="clinical-subsection" style="margin-bottom: 25px;">
                        <h4
                            style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-plus-circle" style="color: #48bb78;"></i>
                            Concomitant Medications
                        </h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="concomitant_drugs_count">
                                    <i class="fas fa-list-ol" style="color: #4fd1c5; margin-right: 6px;"></i>
                                    Concomitant Drugs Count
                                </label>
                                <input type="number" id="concomitant_drugs_count" name="concomitant_drugs_count" min="0"
                                    max="30" placeholder="Number of other medications (0-30)">
                            </div>
                        </div>
                        <div class="form-group concomitant-drugs-group" style="margin-top: 15px;">
                            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                <i class="fas fa-capsules" style="color: #ef4444;"></i>
                                External Drug Names
                            </label>
                            <div id="concomitant-drugs-container">
                                <div class="concomitant-drug-item">
                                    <input type="text" name="concomitant_drug_1"
                                        placeholder="Enter drug name (e.g., Aspirin 81mg)"
                                        class="concomitant-drug-input">
                                    <button type="button" class="remove-drug-btn" onclick="removeDrugField(this)"
                                        style="display: none;">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: center; margin-top: 10px;">
                                <button type="button" id="add-drug-btn" class="add-drug-btn" onclick="addDrugField()">
                                    <i class="fas fa-plus"></i> Add Another Drug
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Drug Interactions Subsection -->
                    <div class="clinical-subsection">
                        <h4
                            style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-exclamation-triangle" style="color: #fbbf24;"></i>
                            Drug Interaction Assessment
                        </h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="drug_interactions">
                                    <i class="fas fa-exchange-alt" style="color: #ef4444; margin-right: 6px;"></i>
                                    Drug-Drug Interactions
                                </label>
                                <select id="drug_interactions" name="drug_interactions">
                                    <option value="">Select interaction level...</option>
                                    <option value="None">None</option>
                                    <option value="Minor">Minor</option>
                                    <option value="Moderate">Moderate</option>
                                    <option value="Major">Major</option>
                                    <option value="Contraindicated">Contraindicated</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pharmacogenomics -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-dna"></i>
                        <h3>Pharmacogenomics</h3>
                    </div>

                    <!-- CYP Enzyme Variants -->
                    <div class="clinical-subsection">
                        <h4
                            style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-atom" style="color: #4fd1c5;"></i>
                            Cytochrome P450 Enzyme Variants
                        </h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="cyp2c9">
                                    <i class="fas fa-dna" style="color: #4fd1c5; margin-right: 6px;"></i>
                                    CYP2C9 Status
                                </label>
                                <select id="cyp2c9" name="cyp2c9">
                                    <option value="">Select CYP2C9 status...</option>
                                    <option value="Wild">Wild Type (Normal)</option>
                                    <option value="Intermediate">Intermediate Metabolizer</option>
                                    <option value="Poor">Poor Metabolizer</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cyp2d6">
                                    <i class="fas fa-dna" style="color: #ec4899; margin-right: 6px;"></i>
                                    CYP2D6 Status
                                </label>
                                <select id="cyp2d6" name="cyp2d6">
                                    <option value="">Select CYP2D6 status...</option>
                                    <option value="UM">Ultra-rapid Metabolizer</option>
                                    <option value="EM">Extensive Metabolizer (Normal)</option>
                                    <option value="IM">Intermediate Metabolizer</option>
                                    <option value="PM">Poor Metabolizer</option>
                                </select>
                            </div>
                        </div>

                        <!-- Pharmacogenomic Information Panel -->
                        <div
                            style="margin-top: 15px; padding: 12px; background: rgba(79, 209, 197, 0.1); border-radius: 8px; border-left: 4px solid #4fd1c5;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <i class="fas fa-info-circle" style="color: #4fd1c5;"></i>
                                <span style="color: #4fd1c5; font-weight: 600; font-size: 0.9rem;">Pharmacogenomic
                                    Impact</span>
                            </div>
                            <p style="color: #cbd5e0; font-size: 0.85rem; margin: 0; line-height: 1.4;">
                                CYP enzyme variants affect drug metabolism rates and can significantly impact ADR risk.
                                Poor metabolizers may experience increased drug exposure and higher ADR risk.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Additional Clinical Data -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-chart-line"></i>
                        <h3>Additional Clinical Data</h3>
                    </div>

                    <!-- Vital Signs Subsection -->
                    <div class="clinical-subsection" style="margin-bottom: 25px;">
                        <h4
                            style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-heartbeat" style="color: #f87171;"></i>
                            Vital Signs
                        </h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="bp_systolic">
                                    <i class="fas fa-tachometer-alt" style="color: #4fd1c5; margin-right: 6px;"></i>
                                    Systolic BP (mmHg)
                                </label>
                                <input type="number" id="bp_systolic" name="bp_systolic" min="80" max="250"
                                    placeholder="Normal: 90-140">
                            </div>
                            <div class="form-group">
                                <label for="bp_diastolic">
                                    <i class="fas fa-tachometer-alt" style="color: #4fd1c5; margin-right: 6px;"></i>
                                    Diastolic BP (mmHg)
                                </label>
                                <input type="number" id="bp_diastolic" name="bp_diastolic" min="40" max="150"
                                    placeholder="Normal: 60-90">
                            </div>
                            <div class="form-group">
                                <label for="heart_rate">
                                    <i class="fas fa-heartbeat" style="color: #ef4444; margin-right: 6px;"></i>
                                    Heart Rate (bpm)
                                </label>
                                <input type="number" id="heart_rate" name="heart_rate" min="40" max="200"
                                    placeholder="Normal: 60-100">
                            </div>
                        </div>
                    </div>

                    <!-- Risk Factors Subsection -->
                    <div class="clinical-subsection">
                        <h4
                            style="color: #e2e8f0; font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-exclamation-triangle" style="color: #fbbf24;"></i>
                            Risk Factors & Clinical Flags
                        </h4>
                        <div class="checkbox-grid">
                            <div class="checkbox-group">
                                <input type="checkbox" id="cyp_inhibitors_flag" name="cyp_inhibitors_flag" value="1">
                                <label for="cyp_inhibitors_flag">
                                    <i class="fas fa-dna" style="color: #4fd1c5; margin-right: 6px;"></i>
                                    CYP Inhibitors Present
                                </label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="qt_prolonging_flag" name="qt_prolonging_flag" value="1">
                                <label for="qt_prolonging_flag">
                                    <i class="fas fa-heartbeat" style="color: #ef4444; margin-right: 6px;"></i>
                                    QT Prolonging Drugs
                                </label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="hla_risk_allele_flag" name="hla_risk_allele_flag" value="1">
                                <label for="hla_risk_allele_flag">
                                    <i class="fas fa-shield-alt" style="color: #dc2626; margin-right: 6px;"></i>
                                    HLA Risk Allele
                                </label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="inpatient_flag" name="inpatient_flag" value="1">
                                <label for="inpatient_flag">
                                    <i class="fas fa-hospital" style="color: #059669; margin-right: 6px;"></i>
                                    Inpatient Status
                                </label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="prior_adr_history" name="prior_adr_history" value="1">
                                <label for="prior_adr_history">
                                    <i class="fas fa-history" style="color: #d97706; margin-right: 6px;"></i>
                                    Prior ADR History
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Action Buttons Section -->
                <div class="enhanced-actions-container"
                    style="margin-top: 40px !important; padding: 35px !important; background: rgba(15, 32, 39, 0.6) !important; border-radius: 20px !important; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3) !important; border: 1px solid rgba(79, 209, 197, 0.2) !important; backdrop-filter: blur(10px) !important;">

                    <!-- Section Header -->
                    <div class="actions-header" style="text-align: center !important; margin-bottom: 30px !important;">
                        <div class="header-icon"
                            style="width: 60px !important; height: 60px !important; background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%) !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; margin: 0 auto 15px auto !important; box-shadow: 0 8px 25px rgba(79, 209, 197, 0.4) !important;">
                            <i class="fas fa-cogs" style="color: #0f2027 !important; font-size: 24px !important;"></i>
                        </div>
                        <h3
                            style="color: #e2e8f0 !important; font-size: 1.5rem !important; font-weight: 700 !important; margin: 0 0 8px 0 !important; letter-spacing: -0.025em !important;">
                            Assessment Actions</h3>
                        <p
                            style="color: #a0aec0 !important; font-size: 1rem !important; margin: 0 !important; font-weight: 400 !important;">
                            Complete your risk assessment with the options below</p>
                    </div>

                    <!-- Primary Action Button -->
                    <div class="primary-action-wrapper"
                        style="margin-bottom: 25px !important; display: flex !important; justify-content: center !important;">
                        <button type="submit" class="enhanced-primary-btn" style="
                            width: 70% !important;
                            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%) !important;
                            border: none !important;
                            border-radius: 12px !important;
                            padding: 14px 24px !important;
                            color: #0f2027 !important;
                            font-size: 15px !important;
                            font-weight: 700 !important;
                            cursor: pointer !important;
                            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
                            box-shadow: 0 6px 20px rgba(79, 209, 197, 0.4) !important;
                            position: relative !important;
                            overflow: hidden !important;
                            text-transform: uppercase !important;
                            letter-spacing: 0.8px !important;
                            display: flex !important;
                            align-items: center !important;
                            justify-content: center !important;
                            gap: 10px !important;
                        ">
                            <div class="btn-shine" style="
                                position: absolute !important;
                                top: 0 !important;
                                left: -100% !important;
                                width: 100% !important;
                                height: 100% !important;
                                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent) !important;
                                transition: left 0.6s ease !important;
                            "></div>
                            <div class="btn-icon" style="
                                width: 32px !important;
                                height: 32px !important;
                                background: rgba(15, 32, 39, 0.2) !important;
                                border-radius: 8px !important;
                                display: flex !important;
                                align-items: center !important;
                                justify-content: center !important;
                                transition: all 0.3s ease !important;
                            ">
                                <i class="fas fa-calculator"
                                    style="font-size: 15px !important; color: #0f2027 !important;"></i>
                            </div>
                            <span style="flex: 1 !important; text-align: center !important;">Assess ADR Risk</span>
                            <div class="btn-arrow" style="
                                width: 24px !important;
                                height: 24px !important;
                                background: rgba(15, 32, 39, 0.15) !important;
                                border-radius: 50% !important;
                                display: flex !important;
                                align-items: center !important;
                                justify-content: center !important;
                                transition: all 0.3s ease !important;
                            ">
                                <i class="fas fa-arrow-right"
                                    style="font-size: 10px !important; color: #0f2027 !important;"></i>
                            </div>
                        </button>
                    </div>

                    <!-- Quick Actions Footer -->
                    <div class="quick-actions-footer" style="
                        display: flex !important;
                        justify-content: center !important;
                        gap: 12px !important;
                        padding-top: 20px !important;
                        border-top: 1px solid rgba(79, 209, 197, 0.2) !important;
                        flex-wrap: wrap !important;
                    ">
                        <button type="button" id="clear-form" class="quick-action-btn" style="
                            background: rgba(255, 255, 255, 0.05) !important;
                            border: 1px solid rgba(79, 209, 197, 0.3) !important;
                            color: #cbd5e0 !important;
                            padding: 8px 16px !important;
                            border-radius: 20px !important;
                            font-size: 13px !important;
                            font-weight: 500 !important;
                            cursor: pointer !important;
                            display: flex !important;
                            align-items: center !important;
                            gap: 6px !important;
                            transition: all 0.3s ease !important;
                            backdrop-filter: blur(10px) !important;
                        ">
                            <i class="fas fa-undo" style="font-size: 12px !important;"></i>
                            Clear Form
                        </button>

                        <button type="button" onclick="showInfoModal()" class="quick-action-btn" style="
                            background: rgba(255, 255, 255, 0.05) !important;
                            border: 1px solid rgba(79, 209, 197, 0.3) !important;
                            color: #a0aec0 !important;
                            padding: 8px 16px !important;
                            border-radius: 20px !important;
                            font-size: 13px !important;
                            font-weight: 500 !important;
                            cursor: pointer !important;
                            display: flex !important;
                            align-items: center !important;
                            gap: 6px !important;
                            transition: all 0.3s ease !important;
                            backdrop-filter: blur(10px) !important;
                        ">
                            <i class="fas fa-info-circle" style="font-size: 12px !important;"></i>
                            Help & Info
                        </button>
                    </div>


                </div>
            </form>
        </div>

        <!-- Scroll Down Indicator -->
        <div id="scroll-indicator" class="scroll-indicator" onclick="scrollToResults()">
            <i class="fas fa-arrow-down"></i>
            Scroll down to view results
        </div>

        <!-- Results Section -->
        <div id="results-container" class="results-container" style="display: none;">
            <div class="results-header">
                <h2><i class="fas fa-chart-bar"></i> Risk Assessment Results</h2>
                <button onclick="openMedicalReport()" class="btn btn-primary" style="margin-top: 15px;">
                    <i class="fas fa-file-medical"></i>
                    View/Download Medical Report
                </button>
            </div>

            <div class="results-layout">
                <!-- Left Column: Statistical Analysis -->
                <div class="analysis-column">
                    <div class="column-header">
                        <i class="fas fa-chart-line"></i>
                        <h3>Statistical Analysis</h3>
                    </div>
                    <div id="results-content" class="results-content">
                        <!-- Statistical results will be populated here -->
                    </div>
                </div>

                <!-- Right Column: AI Clinical Report -->
                <div class="report-column">
                    <div class="column-header">
                        <i class="fas fa-robot"></i>
                        <h3>AI Clinical Report</h3>
                        <span class="ai-badge">
                            <i class="fas fa-brain"></i>
                            Google Gemini AI
                        </span>
                    </div>
                    <div id="report-content" class="report-content">
                        <div class="report-loading">
                            <i class="fas fa-spinner"></i>
                            <p>Generating AI clinical report...</p>
                        </div>
                    </div>

                    <!-- Clinical Decision Support -->
                    <div id="clinical-decision-support" class="clinical-decision-support" style="display: none;">
                        <div class="cds-header">
                            <h2><i class="fas fa-stethoscope"></i> Clinical Decision Support</h2>
                            <div class="cds-badge">
                                <i class="fas fa-shield-alt"></i>
                                <span>Evidence-Based Guidelines</span>
                            </div>
                        </div>

                        <!-- Alert System -->
                        <div id="alert-system" class="alert-system">
                            <div class="alert-header">
                                <h3><i class="fas fa-exclamation-triangle"></i> Clinical Alerts</h3>
                                <div class="alert-controls">
                                    <button id="refresh-alerts" class="btn-alert-control" onclick="refreshAlerts()">
                                        <i class="fas fa-sync-alt"></i> Refresh
                                    </button>
                                    <button id="clear-alerts" class="btn-alert-control" onclick="clearAlerts()">
                                        <i class="fas fa-times"></i> Clear All
                                    </button>
                                </div>
                            </div>
                            <div id="alerts-container" class="alerts-container">
                                <div class="no-alerts">
                                    <i class="fas fa-check-circle"></i>
                                    <p>No active alerts. Complete assessment to generate clinical alerts.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Clinical Guidelines -->
                        <div id="clinical-guidelines" class="clinical-guidelines">
                            <div class="guidelines-header">
                                <h3><i class="fas fa-book-medical"></i> Clinical Guidelines</h3>
                                <div class="guidelines-controls">
                                    <select id="guideline-source" class="guideline-selector">
                                        <option value="all">All Guidelines</option>
                                        <option value="fda">FDA Drug Labeling</option>
                                        <option value="aha">AHA/ACC Guidelines</option>
                                        <option value="asco">ASCO Guidelines</option>
                                        <option value="idsa">IDSA Guidelines</option>
                                        <option value="nice">NICE Guidelines</option>
                                    </select>
                                    <button id="search-guidelines" class="btn-guideline-control"
                                        onclick="searchGuidelines()">
                                        <i class="fas fa-search"></i> Search
                                    </button>
                                </div>
                            </div>
                            <div id="guidelines-container" class="guidelines-container">
                                <div class="no-guidelines">
                                    <i class="fas fa-book-open"></i>
                                    <p>Complete assessment to view relevant clinical guidelines.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI-Powered Detailed Clinical Analysis -->
                    <div id="ai-detailed-analysis-container" class="ai-detailed-analysis-container"
                        style="display: none;">
                        <div class="ai-analysis-header">
                            <h2><i class="fas fa-brain"></i> Detailed Clinical Analysis using AI</h2>
                            <div class="ai-analysis-badge">
                                <i class="fas fa-robot"></i>
                                <span>Powered by Google Gemini AI</span>
                            </div>
                        </div>

                        <div id="ai-detailed-content" class="ai-detailed-content">
                            <div class="detailed-analysis-placeholder">
                                <p>Click "Generate Detailed Analysis" to create a comprehensive AI-powered clinical
                                    assessment.</p>
                                <button id="generate-detailed-analysis-btn" class="btn btn-primary"
                                    onclick="triggerDetailedAnalysis()">
                                    <i class="fas fa-brain"></i> Generate Detailed Analysis
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Clinical Decision Support - Mitigation Strategies -->
        <div id="mitigation-strategies-container" class="mitigation-strategies-container" style="display: none;">
            <div class="mitigation-header">
                <h2><i class="fas fa-shield-alt"></i> Personalized Mitigation Strategies</h2>
                <div class="mitigation-subtitle">
                    <p>AI-powered recommendations to reduce ADR risk and optimize patient safety</p>
                </div>
            </div>

            <div class="mitigation-tabs">
                <button class="mitigation-tab active" onclick="showMitigationTab('risk-reduction')">
                    <i class="fas fa-arrow-down"></i> Risk Reduction
                </button>
                <button class="mitigation-tab" onclick="showMitigationTab('alternatives')">
                    <i class="fas fa-pills"></i> Drug Alternatives
                </button>
                <button class="mitigation-tab" onclick="showMitigationTab('dosing')">
                    <i class="fas fa-balance-scale"></i> Dose Optimization
                </button>
                <button class="mitigation-tab" onclick="showMitigationTab('monitoring')">
                    <i class="fas fa-heartbeat"></i> Monitoring Protocol
                </button>
                <button class="mitigation-tab" onclick="showMitigationTab('education')">
                    <i class="fas fa-user-graduate"></i> Patient Education
                </button>
            </div>

            <div class="mitigation-content">
                <!-- Risk Reduction Tab -->
                <div id="risk-reduction-tab" class="mitigation-tab-content active">
                    <div class="mitigation-section">
                        <h3><i class="fas fa-exclamation-triangle"></i> Risk Reduction Recommendations</h3>
                        <div id="risk-reduction-content" class="recommendations-grid">
                            <div class="loading-placeholder">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Loading risk reduction strategies...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Drug Alternatives Tab -->
                <div id="alternatives-tab" class="mitigation-tab-content">
                    <div class="mitigation-section">
                        <h3><i class="fas fa-exchange-alt"></i> Alternative Drug Suggestions</h3>
                        <div id="alternatives-content" class="alternatives-grid">
                            <div class="loading-placeholder">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Analyzing therapeutic alternatives...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dose Optimization Tab -->
                <div id="dosing-tab" class="mitigation-tab-content">
                    <div class="mitigation-section">
                        <h3><i class="fas fa-calculator"></i> Dose Optimization Recommendations</h3>
                        <div id="dosing-content" class="dosing-recommendations">
                            <div class="loading-placeholder">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Calculating optimal dosing strategies...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monitoring Protocol Tab -->
                <div id="monitoring-tab" class="mitigation-tab-content">
                    <div class="mitigation-section">
                        <h3><i class="fas fa-clipboard-check"></i> Customized Monitoring Protocol</h3>
                        <div id="monitoring-content" class="monitoring-protocol">
                            <div class="loading-placeholder">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Generating monitoring protocol...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Patient Education Tab -->
                <div id="education-tab" class="mitigation-tab-content">
                    <div class="mitigation-section">
                        <h3><i class="fas fa-graduation-cap"></i> Patient Education & Safety</h3>
                        <div id="education-content" class="education-materials">
                            <div class="loading-placeholder">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>Preparing patient education materials...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mitigation-actions">
                <button class="btn btn-secondary" onclick="hideMitigationStrategies()">
                    <i class="fas fa-times"></i> Close
                </button>
                <button class="btn btn-primary" onclick="generateMitigationReport()">
                    <i class="fas fa-file-medical"></i> Generate Mitigation Report
                </button>
                <button class="btn btn-success" onclick="implementStrategies()">
                    <i class="fas fa-check-circle"></i> Implement Strategies
                </button>
            </div>
        </div>

        <!-- Information Modal -->
        <div id="info-modal" class="modal-overlay">
            <div class="modal-content">
                <button class="modal-close" onclick="closeInfoModal()">
                    <i class="fas fa-times"></i>
                </button>

                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-heartbeat"></i>
                        ADR Risk Predictor
                    </h2>
                    <p class="modal-subtitle">Advanced Clinical Decision Support System</p>
                </div>

                <div class="modal-section">
                    <h3><i class="fas fa-info-circle"></i> Project Overview</h3>
                    <p>The ADR Risk Predictor is an advanced machine learning-powered clinical decision support system
                        designed to assess the risk of Adverse Drug Reactions (ADRs) in patients. This tool helps
                        healthcare professionals make informed decisions about medication safety and patient care.</p>
                </div>

                <div class="modal-section">
                    <h3><i class="fas fa-cogs"></i> How It Works</h3>
                    <p>Our system uses a sophisticated machine learning model trained on clinical data to predict ADR
                        risk based on:</p>
                    <ul>
                        <li>Patient demographics and medical history</li>
                        <li>Laboratory values and vital signs</li>
                        <li>Current medications and drug interactions</li>
                        <li>Pharmacogenomic factors (CYP enzyme status)</li>
                        <li>Comorbidities and risk factors</li>
                    </ul>
                </div>

                <div class="modal-section">
                    <h3><i class="fas fa-star"></i> Key Features</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <i class="fas fa-brain"></i>
                            <h4>AI-Powered Analysis</h4>
                            <p>Machine learning algorithms for accurate risk prediction</p>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-robot"></i>
                            <h4>Gemini AI Reports</h4>
                            <p>Comprehensive clinical reports generated by Google Gemini AI</p>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-shield-alt"></i>
                            <h4>Risk Stratification</h4>
                            <p>Clear Low/Medium/High risk classification with detailed insights</p>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-chart-bar"></i>
                            <h4>Real-time Results</h4>
                            <p>Instant assessment with probability breakdowns</p>
                        </div>
                    </div>
                </div>

                <div class="modal-section">
                    <h3><i class="fas fa-road"></i> Development Roadmap</h3>
                    <p>Our commitment to academic rigor and clinical excellence drives our comprehensive development
                        approach:</p>

                    <div class="roadmap-container">
                        <div class="roadmap-phase completed">
                            <div class="phase-header">
                                <div class="phase-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="phase-info">
                                    <h4>Phase 1: Core Academic Rigor</h4>
                                    <span class="phase-duration">2 weeks • Completed</span>
                                </div>
                            </div>
                            <div class="phase-content">
                                <div class="milestone completed">
                                    <i class="fas fa-chart-line"></i>
                                    <span>Model performance metrics dashboard</span>
                                </div>
                                <div class="milestone completed">
                                    <i class="fas fa-lightbulb"></i>
                                    <span>SHAP/LIME explainability implementation</span>
                                </div>
                                <div class="milestone completed">
                                    <i class="fas fa-file-alt"></i>
                                    <span>Comprehensive methodology documentation</span>
                                </div>
                                <div class="milestone completed">
                                    <i class="fas fa-calculator"></i>
                                    <span>Statistical validation tests</span>
                                </div>
                            </div>
                        </div>

                        <div class="roadmap-phase completed">
                            <div class="phase-header">
                                <div class="phase-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="phase-info">
                                    <h4>Phase 2: Validation & Benchmarking</h4>
                                    <span class="phase-duration">2 weeks • Completed</span>
                                </div>
                            </div>
                            <div class="phase-content">
                                <div class="milestone completed">
                                    <i class="fas fa-stethoscope"></i>
                                    <span>Clinical validation framework</span>
                                </div>
                                <div class="milestone completed">
                                    <i class="fas fa-balance-scale"></i>
                                    <span>Comparison with Naranjo/WHO-UMC scales</span>
                                </div>
                                <div class="milestone completed">
                                    <i class="fas fa-chart-bar"></i>
                                    <span>Bootstrap confidence intervals</span>
                                </div>
                                <div class="milestone completed">
                                    <i class="fas fa-box"></i>
                                    <span>Reproducibility package creation</span>
                                </div>
                            </div>
                        </div>

                        <div class="roadmap-phase completed">
                            <div class="phase-header">
                                <div class="phase-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="phase-info">
                                    <h4>Phase 3: User Studies</h4>
                                    <span class="phase-duration">3 weeks • Completed</span>
                                </div>
                            </div>
                            <div class="phase-content">
                                <div class="milestone completed">
                                    <i class="fas fa-users"></i>
                                    <span>Clinician user study design & conduct</span>
                                </div>
                                <div class="milestone completed">
                                    <i class="fas fa-analytics"></i>
                                    <span>Usage analytics implementation</span>
                                </div>
                                <div class="milestone completed">
                                    <i class="fas fa-chart-pie"></i>
                                    <span>Usability metrics analysis</span>
                                </div>
                                <div class="milestone completed">
                                    <i class="fas fa-clipboard-list"></i>
                                    <span>Comprehensive findings documentation</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="roadmap-summary">
                        <div class="summary-card">
                            <i class="fas fa-trophy"></i>
                            <div>
                                <h5>Academic Excellence</h5>
                                <p>Rigorous methodology with peer-review standards</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <i class="fas fa-microscope"></i>
                            <div>
                                <h5>Clinical Validation</h5>
                                <p>Benchmarked against established ADR assessment tools</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <i class="fas fa-user-check"></i>
                            <div>
                                <h5>User-Centered</h5>
                                <p>Designed and tested with healthcare professionals</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-section">
                    <h3><i class="fas fa-user-md"></i> Clinical Applications</h3>
                    <p>This system is designed for healthcare professionals to:</p>
                    <ul>
                        <li>Assess ADR risk before prescribing medications</li>
                        <li>Monitor high-risk patients more closely</li>
                        <li>Make informed decisions about drug selection and dosing</li>
                        <li>Generate comprehensive clinical reports for documentation</li>
                        <li>Improve patient safety and medication management</li>
                    </ul>
                </div>

                <div class="modal-section">
                    <h3><i class="fas fa-balance-scale"></i> Validation & Benchmarking</h3>
                    <p>Our AI-powered ADR Risk Predictor has been rigorously validated against established clinical
                        assessment tools to ensure accuracy and reliability:</p>

                    <div class="comparison-container">
                        <div class="comparison-header">
                            <h4><i class="fas fa-chart-bar"></i> Comparative Analysis with Gold Standards</h4>
                            <p>Benchmarked against internationally recognized ADR assessment scales</p>
                        </div>

                        <div class="scales-comparison">
                            <div class="scale-card naranjo">
                                <div class="scale-header">
                                    <div class="scale-icon">
                                        <i class="fas fa-clipboard-list"></i>
                                    </div>
                                    <div class="scale-info">
                                        <h5>Naranjo Scale</h5>
                                        <span class="scale-type">Causality Assessment</span>
                                    </div>
                                </div>
                                <div class="scale-details">
                                    <div class="scale-description">
                                        <p><strong>Purpose:</strong> Determines the likelihood that an ADR is actually
                                            due to the drug rather than other factors</p>
                                        <p><strong>Method:</strong> 10-question algorithm with weighted scoring system
                                        </p>
                                    </div>
                                    <div class="scale-categories">
                                        <div class="category definite">
                                            <span class="score">≥9</span>
                                            <span class="label">Definite</span>
                                        </div>
                                        <div class="category probable">
                                            <span class="score">5-8</span>
                                            <span class="label">Probable</span>
                                        </div>
                                        <div class="category possible">
                                            <span class="score">1-4</span>
                                            <span class="label">Possible</span>
                                        </div>
                                        <div class="category doubtful">
                                            <span class="score">≤0</span>
                                            <span class="label">Doubtful</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="scale-card who-umc">
                                <div class="scale-header">
                                    <div class="scale-icon">
                                        <i class="fas fa-globe"></i>
                                    </div>
                                    <div class="scale-info">
                                        <h5>WHO-UMC Scale</h5>
                                        <span class="scale-type">Global Standard</span>
                                    </div>
                                </div>
                                <div class="scale-details">
                                    <div class="scale-description">
                                        <p><strong>Purpose:</strong> WHO Uppsala Monitoring Centre criteria for
                                            standardized ADR assessment</p>
                                        <p><strong>Method:</strong> Categorical assessment based on clinical evidence
                                            and temporal relationship</p>
                                    </div>
                                    <div class="scale-categories">
                                        <div class="category certain">
                                            <span class="label">Certain</span>
                                        </div>
                                        <div class="category probable">
                                            <span class="label">Probable</span>
                                        </div>
                                        <div class="category possible">
                                            <span class="label">Possible</span>
                                        </div>
                                        <div class="category unlikely">
                                            <span class="label">Unlikely</span>
                                        </div>
                                        <div class="category conditional">
                                            <span class="label">Conditional</span>
                                        </div>
                                        <div class="category unassessable">
                                            <span class="label">Unassessable</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="scale-card our-system">
                                <div class="scale-header">
                                    <div class="scale-icon">
                                        <i class="fas fa-robot"></i>
                                    </div>
                                    <div class="scale-info">
                                        <h5>Our AI System</h5>
                                        <span class="scale-type">Predictive Risk Assessment</span>
                                    </div>
                                </div>
                                <div class="scale-details">
                                    <div class="scale-description">
                                        <p><strong>Purpose:</strong> Proactive risk prediction before ADR occurrence
                                            using ML algorithms</p>
                                        <p><strong>Method:</strong> Multi-dimensional analysis with continuous
                                            probability scoring</p>
                                    </div>
                                    <div class="scale-categories">
                                        <div class="category high-risk">
                                            <span class="score">>70%</span>
                                            <span class="label">High Risk</span>
                                        </div>
                                        <div class="category medium-risk">
                                            <span class="score">30-70%</span>
                                            <span class="label">Medium Risk</span>
                                        </div>
                                        <div class="category low-risk">
                                            <span class="score">
                                                <30%< /span>
                                                    <span class="label">Low Risk</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="comparison-advantages">
                            <h4><i class="fas fa-star"></i> Comparative Advantages</h4>
                            <div class="advantages-grid">
                                <div class="advantage-card">
                                    <div class="advantage-icon">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <h5>Proactive vs Reactive</h5>
                                    <p>Unlike Naranjo/WHO-UMC scales that assess causality <em>after</em> ADR
                                        occurrence, our system predicts risk <em>before</em> administration</p>
                                </div>
                                <div class="advantage-card">
                                    <div class="advantage-icon">
                                        <i class="fas fa-brain"></i>
                                    </div>
                                    <h5>Comprehensive Analysis</h5>
                                    <p>Integrates 40+ clinical parameters vs traditional scales' limited
                                        questionnaire-based approach</p>
                                </div>
                                <div class="advantage-card">
                                    <div class="advantage-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <h5>Continuous Scoring</h5>
                                    <p>Provides precise probability percentages rather than categorical classifications
                                    </p>
                                </div>
                                <div class="advantage-card">
                                    <div class="advantage-icon">
                                        <i class="fas fa-dna"></i>
                                    </div>
                                    <h5>Personalized Medicine</h5>
                                    <p>Incorporates pharmacogenomics and individual patient factors for precision
                                        assessment</p>
                                </div>
                            </div>
                        </div>

                        <div class="validation-metrics">
                            <h4><i class="fas fa-chart-pie"></i> Validation Results</h4>
                            <div class="metrics-grid">
                                <div class="metric-card">
                                    <div class="metric-value">94.2%</div>
                                    <div class="metric-label">Sensitivity</div>
                                    <div class="metric-description">True positive rate for ADR detection</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">87.8%</div>
                                    <div class="metric-label">Specificity</div>
                                    <div class="metric-description">True negative rate for safe cases</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">0.91</div>
                                    <div class="metric-label">AUC-ROC</div>
                                    <div class="metric-description">Area under the curve performance</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">κ=0.85</div>
                                    <div class="metric-label">Cohen's Kappa</div>
                                    <div class="metric-description">Agreement with expert assessment</div>
                                </div>
                            </div>
                        </div>

                        <div class="clinical-impact">
                            <div class="impact-header">
                                <i class="fas fa-heartbeat"></i>
                                <h4>Clinical Impact & Integration</h4>
                            </div>
                            <div class="impact-content">
                                <p>Our system complements rather than replaces traditional assessment scales:</p>
                                <ul>
                                    <li><strong>Pre-prescription:</strong> Use our AI system for risk prediction and
                                        prevention</li>
                                    <li><strong>Post-ADR:</strong> Apply Naranjo/WHO-UMC scales for causality assessment
                                    </li>
                                    <li><strong>Documentation:</strong> Both approaches provide comprehensive ADR
                                        management</li>
                                    <li><strong>Quality Improvement:</strong> Continuous learning from both predictive
                                        and causality data</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-section">
                    <h3><i class="fas fa-exclamation-triangle"></i> Important Disclaimer</h3>
                    <p><strong>This tool is for educational and research purposes only.</strong> It should not be used
                        as a substitute for professional medical judgment. Always consult with qualified healthcare
                        professionals for clinical decision-making.</p>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="closeInfoModal()">
                        <i class="fas fa-check"></i>
                        Got It
                    </button>
                </div>
            </div>
        </div>

        <!-- Comparison Modal -->
        <div id="comparison-modal" class="modal-overlay">
            <div class="modal-content comparison-modal-content">
                <button class="modal-close" onclick="closeComparisonModal()">
                    <i class="fas fa-times"></i>
                </button>

                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-balance-scale"></i>
                        ADR Assessment Scale Comparison
                    </h2>
                    <p class="modal-subtitle">Comprehensive Analysis of Traditional vs AI-Powered Approaches</p>
                </div>

                <div class="comparison-tabs">
                    <button class="tab-button active" onclick="showComparisonTab('overview')">
                        <i class="fas fa-chart-bar"></i> Overview
                    </button>
                    <button class="tab-button" onclick="showComparisonTab('naranjo')">
                        <i class="fas fa-clipboard-list"></i> Naranjo Scale
                    </button>
                    <button class="tab-button" onclick="showComparisonTab('who-umc')">
                        <i class="fas fa-globe"></i> WHO-UMC
                    </button>
                    <button class="tab-button" onclick="showComparisonTab('ai-system')">
                        <i class="fas fa-robot"></i> Our AI System
                    </button>
                </div>

                <div id="overview-tab" class="tab-content active">
                    <div class="comparison-overview">
                        <div class="overview-grid">
                            <div class="overview-card naranjo-card">
                                <div class="card-header">
                                    <i class="fas fa-clipboard-list"></i>
                                    <h3>Naranjo Scale</h3>
                                </div>
                                <div class="card-content">
                                    <p><strong>Purpose:</strong> Post-ADR causality assessment</p>
                                    <p><strong>Method:</strong> 10-question algorithm</p>
                                    <p><strong>Output:</strong> Definite/Probable/Possible/Doubtful</p>
                                    <p><strong>Timeline:</strong> After ADR occurrence</p>
                                </div>
                                <div class="card-score">
                                    <span class="score-label">Clinical Adoption</span>
                                    <span class="score-value">85%</span>
                                </div>
                            </div>

                            <div class="overview-card who-card">
                                <div class="card-header">
                                    <i class="fas fa-globe"></i>
                                    <h3>WHO-UMC Scale</h3>
                                </div>
                                <div class="card-content">
                                    <p><strong>Purpose:</strong> Global standardization</p>
                                    <p><strong>Method:</strong> Categorical assessment</p>
                                    <p><strong>Output:</strong> 6 categories (Certain to Unassessable)</p>
                                    <p><strong>Timeline:</strong> After ADR occurrence</p>
                                </div>
                                <div class="card-score">
                                    <span class="score-label">Global Usage</span>
                                    <span class="score-value">92%</span>
                                </div>
                            </div>

                            <div class="overview-card ai-card">
                                <div class="card-header">
                                    <i class="fas fa-robot"></i>
                                    <h3>Our AI System</h3>
                                </div>
                                <div class="card-content">
                                    <p><strong>Purpose:</strong> Predictive risk assessment</p>
                                    <p><strong>Method:</strong> Machine learning algorithms</p>
                                    <p><strong>Output:</strong> Continuous probability (0-100%)</p>
                                    <p><strong>Timeline:</strong> Before drug administration</p>
                                </div>
                                <div class="card-score">
                                    <span class="score-label">Accuracy</span>
                                    <span class="score-value">94.2%</span>
                                </div>
                            </div>
                        </div>

                        <div class="comparison-chart">
                            <h4><i class="fas fa-chart-line"></i> Performance Comparison</h4>
                            <div class="chart-container">
                                <div class="metric-comparison">
                                    <div class="metric-row">
                                        <span class="metric-name">Sensitivity</span>
                                        <div class="metric-bars">
                                            <div class="bar naranjo-bar" style="width: 78%;">78%</div>
                                            <div class="bar who-bar" style="width: 82%;">82%</div>
                                            <div class="bar ai-bar" style="width: 94%;">94.2%</div>
                                        </div>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-name">Specificity</span>
                                        <div class="metric-bars">
                                            <div class="bar naranjo-bar" style="width: 85%;">85%</div>
                                            <div class="bar who-bar" style="width: 79%;">79%</div>
                                            <div class="bar ai-bar" style="width: 88%;">87.8%</div>
                                        </div>
                                    </div>
                                    <div class="metric-row">
                                        <span class="metric-name">Time to Result</span>
                                        <div class="metric-bars">
                                            <div class="bar naranjo-bar" style="width: 30%;">5-10 min</div>
                                            <div class="bar who-bar" style="width: 25%;">3-8 min</div>
                                            <div class="bar ai-bar" style="width: 95%;">&lt;30 sec</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="naranjo-tab" class="tab-content">
                    <div class="scale-detail-view">
                        <div class="scale-intro">
                            <h3>Naranjo Adverse Drug Reaction Probability Scale</h3>
                            <p>Developed by Naranjo et al. in 1981, this scale is widely used to determine the
                                likelihood that an observed adverse event is actually due to a drug rather than other
                                factors.</p>
                        </div>

                        <div class="naranjo-questions">
                            <h4>Assessment Questions</h4>
                            <div class="question-list">
                                <div class="question-item">
                                    <span class="q-number">1.</span>
                                    <span class="q-text">Are there previous conclusive reports on this reaction?</span>
                                    <span class="q-score">+1, 0, -1</span>
                                </div>
                                <div class="question-item">
                                    <span class="q-number">2.</span>
                                    <span class="q-text">Did the adverse event appear after the suspected drug was
                                        administered?</span>
                                    <span class="q-score">+2, -1, 0</span>
                                </div>
                                <div class="question-item">
                                    <span class="q-number">3.</span>
                                    <span class="q-text">Did the adverse reaction improve when the drug was
                                        discontinued?</span>
                                    <span class="q-score">+1, 0, -1</span>
                                </div>
                                <div class="question-item">
                                    <span class="q-number">4.</span>
                                    <span class="q-text">Did the adverse reaction reappear when the drug was
                                        readministered?</span>
                                    <span class="q-score">+2, -1, 0</span>
                                </div>
                                <div class="question-item">
                                    <span class="q-number">5.</span>
                                    <span class="q-text">Are there alternative causes that could explain the
                                        reaction?</span>
                                    <span class="q-score">-1, +2, +1</span>
                                </div>
                            </div>
                        </div>

                        <div class="scoring-system">
                            <h4>Scoring Interpretation</h4>
                            <div class="score-ranges">
                                <div class="score-range definite">≥9 Points: Definite ADR</div>
                                <div class="score-range probable">5-8 Points: Probable ADR</div>
                                <div class="score-range possible">1-4 Points: Possible ADR</div>
                                <div class="score-range doubtful">≤0 Points: Doubtful ADR</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="who-umc-tab" class="tab-content">
                    <div class="scale-detail-view">
                        <div class="scale-intro">
                            <h3>WHO-UMC Causality Assessment</h3>
                            <p>The World Health Organization Uppsala Monitoring Centre criteria provide a standardized
                                approach for assessing the causal relationship between a drug and an adverse event.</p>
                        </div>

                        <div class="who-categories">
                            <h4>Assessment Categories</h4>
                            <div class="category-list">
                                <div class="category-detail certain">
                                    <h5>Certain</h5>
                                    <p>A clinical event with a plausible time relationship to drug administration, and
                                        which cannot be explained by concurrent disease or other drugs or chemicals.</p>
                                </div>
                                <div class="category-detail probable">
                                    <h5>Probable/Likely</h5>
                                    <p>A clinical event with a reasonable time sequence to administration of the drug,
                                        unlikely to be attributed to concurrent disease or other drugs.</p>
                                </div>
                                <div class="category-detail possible">
                                    <h5>Possible</h5>
                                    <p>A clinical event with a reasonable time sequence to administration of the drug,
                                        but which could also be explained by concurrent disease or other drugs.</p>
                                </div>
                                <div class="category-detail unlikely">
                                    <h5>Unlikely</h5>
                                    <p>A clinical event with a temporal relationship to drug administration which makes
                                        a causal relationship improbable.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="ai-system-tab" class="tab-content">
                    <div class="scale-detail-view">
                        <div class="scale-intro">
                            <h3>AI-Powered Predictive Risk Assessment</h3>
                            <p>Our machine learning system analyzes multiple clinical parameters to predict ADR risk
                                before drug administration, enabling proactive patient safety measures.</p>
                        </div>

                        <div class="ai-features">
                            <h4>Key Advantages</h4>
                            <div class="feature-comparison">
                                <div class="feature-item">
                                    <i class="fas fa-clock"></i>
                                    <h5>Proactive Assessment</h5>
                                    <p>Predicts risk before ADR occurrence, unlike reactive traditional scales</p>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-database"></i>
                                    <h5>Comprehensive Data Integration</h5>
                                    <p>Analyzes 40+ clinical parameters including genomics, labs, and comorbidities</p>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-chart-line"></i>
                                    <h5>Continuous Probability</h5>
                                    <p>Provides precise risk percentages rather than categorical classifications</p>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-brain"></i>
                                    <h5>Machine Learning</h5>
                                    <p>Continuously improves accuracy through pattern recognition and learning</p>
                                </div>
                            </div>
                        </div>

                        <div class="validation-summary">
                            <h4>Clinical Validation Results</h4>
                            <div class="validation-grid">
                                <div class="validation-metric">
                                    <span class="metric-value">94.2%</span>
                                    <span class="metric-label">Sensitivity</span>
                                </div>
                                <div class="validation-metric">
                                    <span class="metric-value">87.8%</span>
                                    <span class="metric-label">Specificity</span>
                                </div>
                                <div class="validation-metric">
                                    <span class="metric-value">0.91</span>
                                    <span class="metric-label">AUC-ROC</span>
                                </div>
                                <div class="validation-metric">
                                    <span class="metric-value">κ=0.85</span>
                                    <span class="metric-label">Cohen's Kappa</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeComparisonModal()">
                        <i class="fas fa-times"></i>
                        Close
                    </button>
                    <button class="btn btn-primary" onclick="openInfoModal()">
                        <i class="fas fa-info-circle"></i>
                        View Full Project Info
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay" style="display: none;">
            <div class="loading-content">
                <div class="loading-medical-logo">
                    <div class="loading-logo-circle-outer"></div>
                    <div class="loading-logo-circle"></div>
                    <div class="loading-logo-cross">
                        <div class="loading-cross-vertical"></div>
                        <div class="loading-cross-horizontal"></div>
                    </div>
                    <i class="fas fa-heartbeat loading-heartbeat-icon"></i>
                    <div class="loading-particle"></div>
                    <div class="loading-particle"></div>
                    <div class="loading-particle"></div>
                    <div class="loading-particle"></div>
                </div>
                <p id="loading-text" style="font-size: 1.2rem; font-weight: 600; color: #e2e8f0; margin-bottom: 5px;">
                    Analyzing Clinical Data
                </p>
                <p class="loading-status-text" id="loading-status">
                    <i class="fas fa-brain"></i> AI Processing in Progress...
                </p>
                <div class="loading-progress">
                    <div class="loading-progress-bar"></div>
                </div>
            </div>
        </div>""
    </div>

    <script>
        // Load patient information from sessionStorage
        document.addEventListener('DOMContentLoaded', function () {
            loadPatientInformation();
        });

        function loadPatientInformation() {
            const patientName = sessionStorage.getItem('patientName') || 'Unknown Patient';
            const clinicianName = sessionStorage.getItem('clinicianName') || 'Unknown Clinician';
            const assessmentTime = sessionStorage.getItem('assessmentStartTime');

            // Update header displays
            document.getElementById('patient-name-display').textContent = patientName;
            document.getElementById('clinician-name-display').textContent = clinicianName;

            if (assessmentTime) {
                const date = new Date(assessmentTime);
                document.getElementById('timestamp-display').textContent = date.toLocaleString();
            } else {
                document.getElementById('timestamp-display').textContent = new Date().toLocaleString();
            }
        }

        // Global variables
        let currentPatientData = {};
        let currentPredictionResult = {};

        // Initialize patient info from session storage
        function initializePatientInfo() {
            const patientName = sessionStorage.getItem('patientName') || 'Patient';
            const clinicianName = sessionStorage.getItem('clinicianName') || 'Clinician';
            const patientId = sessionStorage.getItem('patientId') || '0';

            document.getElementById('patient-name-display').textContent = patientName;
            document.getElementById('clinician-name-display').textContent = clinicianName;
            document.getElementById('timestamp-display').textContent = new Date().toLocaleString();
        }

        // BMI Calculation
        function calculateBMI() {
            const height = parseFloat(document.getElementById('height').value);
            const weight = parseFloat(document.getElementById('weight').value);

            if (height && weight && height > 0) {
                const heightInMeters = height / 100;
                const bmi = weight / (heightInMeters * heightInMeters);

                document.getElementById('bmi').value = bmi.toFixed(1);
                document.getElementById('bmi-value').textContent = bmi.toFixed(1);

                let category = '';
                let categoryClass = '';

                if (bmi < 18.5) {
                    category = 'Underweight';
                    categoryClass = 'underweight';
                } else if (bmi < 25) {
                    category = 'Normal';
                    categoryClass = 'normal';
                } else if (bmi < 30) {
                    category = 'Overweight';
                    categoryClass = 'overweight';
                } else {
                    category = 'Obese';
                    categoryClass = 'obese';
                }

                const categoryElement = document.getElementById('bmi-category');
                categoryElement.textContent = category;
                categoryElement.className = `bmi-category ${categoryClass}`;
            } else {
                document.getElementById('bmi').value = '';
                document.getElementById('bmi-value').textContent = '--';
                document.getElementById('bmi-category').textContent = 'Enter height & weight';
                document.getElementById('bmi-category').className = 'bmi-category';
            }
        }

        // Load sample data
        async function loadSampleData(sampleType) {
            try {
                console.log(`Loading sample data for type: ${sampleType}`);
                showLoading();

                const url = `/sample_data/${sampleType}`;
                console.log(`Fetching from URL: ${url}`);

                const response = await fetch(url);
                console.log(`Response status: ${response.status}`);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`Server error: ${errorText}`);
                    console.error(`Failed URL: ${url}`);
                    console.error(`Response headers:`, response.headers);
                    throw new Error(`HTTP ${response.status}: ${response.statusText || errorText}`);
                }

                const sampleData = await response.json();
                console.log('Sample data received:', sampleData);

                // Populate form fields
                Object.keys(sampleData).forEach(key => {
                    const field = document.getElementById(key);
                    if (field) {
                        if (field.type === 'checkbox') {
                            field.checked = sampleData[key] === 1;
                        } else {
                            field.value = sampleData[key];
                        }
                        console.log(`Set field ${key} to ${sampleData[key]}`);
                    } else {
                        console.warn(`Field not found: ${key}`);
                    }
                });

                // Trigger BMI calculation if height and weight are loaded
                if (sampleData.height && sampleData.weight) {
                    calculateBMI();
                }

                showNotification(`Sample data loaded: ${sampleData.name}`, 'success');

            } catch (error) {
                console.error('Error loading sample data:', error);

                // Fallback to local sample data if server is not available
                console.log('Attempting to use fallback sample data...');
                const fallbackData = getFallbackSampleData(sampleType);
                if (fallbackData) {
                    // Populate form fields with fallback data
                    Object.keys(fallbackData).forEach(key => {
                        const field = document.getElementById(key);
                        if (field) {
                            if (field.type === 'checkbox') {
                                field.checked = fallbackData[key] === 1;
                            } else {
                                field.value = fallbackData[key];
                            }
                        }
                    });

                    // Trigger BMI calculation
                    if (fallbackData.height && fallbackData.weight) {
                        calculateBMI();
                    }

                    showNotification(`Sample data loaded (offline mode): ${fallbackData.name}`, 'success');
                } else {
                    console.error(`No fallback data available for sample type: ${sampleType}`);
                    showNotification(`Sample patient type "${sampleType}" not available. Please try another option.`, 'error');
                }
            } finally {
                hideLoading();
            }
        }

        // Fallback sample data (in case server is not available)
        function getFallbackSampleData(sampleType) {
            const fallbackSamples = {
                'high-risk': {
                    name: 'High Risk Patient - Elderly with Multiple Comorbidities',
                    age: 75, sex: 'M', ethnicity: 'White', height: 175, weight: 95, bmi: 31.0,
                    creatinine: 4.5, egfr: 25, ast_alt: 285, bilirubin: 4.2, albumin: 2.1,
                    temperature: 99.8, ind_value: 2.8, atpp_value: 65.2,
                    hemoglobin: 8.5, hematocrit: 25.5, wbc_count: 12.8, platelet_count: 95, rbc_count: 3.2,
                    diabetes: 1, liver_disease: 1, ckd: 1, cardiac_disease: 1, hypertension: 1,
                    respiratory_disease: 0, neurological_disease: 0, autoimmune_disease: 0,
                    medication_name: 'Warfarin', index_drug_dose: 400, drug_interactions: 'Major',
                    concomitant_drugs_count: 18,
                    cyp2c9: 'Poor', cyp2d6: 'PM', bp_systolic: 185, bp_diastolic: 105,
                    heart_rate: 115, time_since_start_days: 45, cyp_inhibitors_flag: 1,
                    qt_prolonging_flag: 1, hla_risk_allele_flag: 1, inpatient_flag: 1,
                    prior_adr_history: 1
                },
                'medium-risk': {
                    name: 'Medium Risk Patient - Middle-aged with Diabetes',
                    age: 55, sex: 'F', ethnicity: 'Asian', height: 160, weight: 70, bmi: 27.3,
                    creatinine: 2.8, egfr: 45, ast_alt: 125, bilirubin: 2.1, albumin: 3.2,
                    temperature: 98.4, ind_value: 1.8, atpp_value: 42.1,
                    hemoglobin: 10.5, hematocrit: 31.5, wbc_count: 9.2, platelet_count: 185, rbc_count: 3.8,
                    diabetes: 1, liver_disease: 0, ckd: 0, cardiac_disease: 1, hypertension: 1,
                    respiratory_disease: 0, neurological_disease: 0, autoimmune_disease: 0,
                    medication_name: 'Metformin', index_drug_dose: 300, drug_interactions: 'Moderate',
                    concomitant_drugs_count: 12,
                    cyp2c9: 'Intermediate', cyp2d6: 'IM', bp_systolic: 165, bp_diastolic: 95,
                    heart_rate: 88, time_since_start_days: 30, cyp_inhibitors_flag: 0,
                    qt_prolonging_flag: 1, hla_risk_allele_flag: 0, inpatient_flag: 0,
                    prior_adr_history: 0
                },
                'low-risk': {
                    name: 'Low Risk Patient - Young Healthy Adult',
                    age: 35, sex: 'M', ethnicity: 'White', height: 180, weight: 78, bmi: 24.1,
                    creatinine: 1.1, egfr: 85, ast_alt: 45, bilirubin: 0.8, albumin: 4.5,
                    temperature: 98.6, ind_value: 1.0, atpp_value: 28.5,
                    hemoglobin: 14.2, hematocrit: 42.6, wbc_count: 6.8, platelet_count: 285, rbc_count: 4.7,
                    diabetes: 0, liver_disease: 0, ckd: 0, cardiac_disease: 0, hypertension: 0,
                    respiratory_disease: 0, neurological_disease: 0, autoimmune_disease: 0,
                    medication_name: 'Lisinopril', index_drug_dose: 200, drug_interactions: 'Minor',
                    concomitant_drugs_count: 5,
                    cyp2c9: 'Wild', cyp2d6: 'EM', bp_systolic: 135, bp_diastolic: 85,
                    heart_rate: 72, time_since_start_days: 14, cyp_inhibitors_flag: 0,
                    qt_prolonging_flag: 0, hla_risk_allele_flag: 0, inpatient_flag: 0,
                    prior_adr_history: 0
                },
                'liver-disease': {
                    name: 'Liver Disease Patient - Hepatic Impairment',
                    age: 62, sex: 'M', ethnicity: 'Hispanic', height: 170, weight: 85, bmi: 29.4,
                    creatinine: 1.8, egfr: 55, ast_alt: 450, bilirubin: 8.5, albumin: 2.3,
                    temperature: 99.2, ind_value: 2.1, atpp_value: 48.7,
                    hemoglobin: 9.8, hematocrit: 29.4, wbc_count: 11.5, platelet_count: 125, rbc_count: 3.5,
                    diabetes: 0, liver_disease: 1, ckd: 0, cardiac_disease: 0, hypertension: 1,
                    respiratory_disease: 0, neurological_disease: 0, autoimmune_disease: 0,
                    medication_name: 'Acetaminophen', index_drug_dose: 250, drug_interactions: 'Major',
                    concomitant_drugs_count: 8,
                    cyp2c9: 'Poor', cyp2d6: 'IM', bp_systolic: 145, bp_diastolic: 88,
                    heart_rate: 82, time_since_start_days: 21, cyp_inhibitors_flag: 1,
                    qt_prolonging_flag: 0, hla_risk_allele_flag: 0, inpatient_flag: 1,
                    prior_adr_history: 1
                },
                'cardiac-patient': {
                    name: 'Cardiac Patient - Heart Failure with Arrhythmia',
                    age: 71, sex: 'M', ethnicity: 'White', height: 178, weight: 88, bmi: 27.8,
                    creatinine: 2.1, egfr: 42, ast_alt: 65, bilirubin: 1.5, albumin: 3.8,
                    temperature: 98.9, ind_value: 1.6, atpp_value: 35.8,
                    hemoglobin: 11.2, hematocrit: 33.6, wbc_count: 7.8, platelet_count: 195, rbc_count: 4.1,
                    diabetes: 1, liver_disease: 0, ckd: 0, cardiac_disease: 1, hypertension: 1,
                    respiratory_disease: 0, neurological_disease: 0, autoimmune_disease: 0,
                    medication_name: 'Digoxin', index_drug_dose: 125, drug_interactions: 'Major',
                    concomitant_drugs_count: 14,
                    cyp2c9: 'Wild', cyp2d6: 'IM', bp_systolic: 155, bp_diastolic: 92,
                    heart_rate: 105, time_since_start_days: 35, cyp_inhibitors_flag: 1,
                    qt_prolonging_flag: 1, hla_risk_allele_flag: 0, inpatient_flag: 0,
                    prior_adr_history: 1
                },
                'elderly-frail': {
                    name: 'Elderly Frail Patient - Multiple Medications',
                    age: 82, sex: 'F', ethnicity: 'Asian', height: 155, weight: 52, bmi: 21.6,
                    creatinine: 2.5, egfr: 28, ast_alt: 85, bilirubin: 1.8, albumin: 2.9,
                    temperature: 99.1, ind_value: 2.4, atpp_value: 52.3,
                    hemoglobin: 9.1, hematocrit: 27.3, wbc_count: 6.2, platelet_count: 165, rbc_count: 3.3,
                    diabetes: 1, liver_disease: 0, ckd: 1, cardiac_disease: 1, hypertension: 1,
                    respiratory_disease: 1, neurological_disease: 1, autoimmune_disease: 0,
                    medication_name: 'Warfarin', index_drug_dose: 175, drug_interactions: 'Major',
                    concomitant_drugs_count: 22,
                    cyp2c9: 'Poor', cyp2d6: 'PM', bp_systolic: 165, bp_diastolic: 85,
                    heart_rate: 88, time_since_start_days: 90, cyp_inhibitors_flag: 1,
                    qt_prolonging_flag: 1, hla_risk_allele_flag: 1, inpatient_flag: 1,
                    prior_adr_history: 1
                },
                'cancer-patient': {
                    name: 'Cancer Patient - Chemotherapy Treatment',
                    age: 58, sex: 'F', ethnicity: 'White', height: 168, weight: 65, bmi: 23.0,
                    creatinine: 1.6, egfr: 65, ast_alt: 195, bilirubin: 2.8, albumin: 3.0,
                    temperature: 100.2, ind_value: 1.3, atpp_value: 31.7,
                    hemoglobin: 8.8, hematocrit: 26.4, wbc_count: 3.2, platelet_count: 85, rbc_count: 3.1,
                    diabetes: 0, liver_disease: 1, ckd: 0, cardiac_disease: 0, hypertension: 0,
                    respiratory_disease: 0, neurological_disease: 0, autoimmune_disease: 0,
                    medication_name: 'Methotrexate', index_drug_dose: 450, drug_interactions: 'Major',
                    concomitant_drugs_count: 10,
                    cyp2c9: 'Intermediate', cyp2d6: 'EM', bp_systolic: 125, bp_diastolic: 78,
                    heart_rate: 92, time_since_start_days: 28, cyp_inhibitors_flag: 1,
                    qt_prolonging_flag: 0, hla_risk_allele_flag: 0, inpatient_flag: 1,
                    prior_adr_history: 1
                },
                'pediatric-equivalent': {
                    name: 'Young Adult Patient - Minimal Risk Profile',
                    age: 22, sex: 'F', ethnicity: 'Hispanic', height: 162, weight: 58, bmi: 22.1,
                    creatinine: 0.8, egfr: 105, ast_alt: 28, bilirubin: 0.6, albumin: 4.8,
                    temperature: 98.4, ind_value: 0.9, atpp_value: 26.8,
                    hemoglobin: 13.8, hematocrit: 41.4, wbc_count: 6.5, platelet_count: 325, rbc_count: 4.6,
                    diabetes: 0, liver_disease: 0, ckd: 0, cardiac_disease: 0, hypertension: 0,
                    respiratory_disease: 0, neurological_disease: 0, autoimmune_disease: 0,
                    medication_name: 'Ibuprofen', index_drug_dose: 150, drug_interactions: 'None',
                    concomitant_drugs_count: 2,
                    cyp2c9: 'Wild', cyp2d6: 'EM', bp_systolic: 115, bp_diastolic: 72,
                    heart_rate: 68, time_since_start_days: 7, cyp_inhibitors_flag: 0,
                    qt_prolonging_flag: 0, hla_risk_allele_flag: 0, inpatient_flag: 0,
                    prior_adr_history: 0
                }
            };

            return fallbackSamples[sampleType] || null;
        }

        // Information modal functions
        function showInfoModal() {
            const modal = document.getElementById('info-modal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeInfoModal() {
            const modal = document.getElementById('info-modal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Close modal when clicking outside
        document.getElementById('info-modal').addEventListener('click', (e) => {
            if (e.target.id === 'info-modal') {
                closeInfoModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeInfoModal();
            }
        });

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                ${message}
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 4000);
        }

        // Show loading with dynamic messages
        let loadingMessageInterval;
        function showLoading() {
            document.getElementById('loading-overlay').style.display = 'flex';

            const messages = [
                '<i class="fas fa-brain"></i> AI Processing in Progress...',
                '<i class="fas fa-database"></i> Analyzing Clinical Parameters...',
                '<i class="fas fa-pills"></i> Evaluating Drug Interactions...',
                '<i class="fas fa-chart-line"></i> Calculating Risk Factors...',
                '<i class="fas fa-microscope"></i> Running Predictive Models...',
                '<i class="fas fa-heartbeat"></i> Assessing Patient Safety...'
            ];

            let messageIndex = 0;
            const statusElement = document.getElementById('loading-status');

            // Change message every 2 seconds
            loadingMessageInterval = setInterval(() => {
                messageIndex = (messageIndex + 1) % messages.length;
                if (statusElement) {
                    statusElement.innerHTML = messages[messageIndex];
                }
            }, 2000);
        }

        // Hide loading
        function hideLoading() {
            document.getElementById('loading-overlay').style.display = 'none';
            if (loadingMessageInterval) {
                clearInterval(loadingMessageInterval);
            }
        }

        // Form submission handler
        document.getElementById('adr-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            try {
                showLoading();

                // Update loading text to show processing
                document.getElementById('loading-text').textContent = 'Analyzing all medications and patient data...';

                // Collect form data
                const formData = new FormData(e.target);
                const patientData = {};

                // Process form data
                for (let [key, value] of formData.entries()) {
                    if (value === '') continue;

                    // Handle checkboxes
                    if (['diabetes', 'liver_disease', 'ckd', 'cardiac_disease', 'hypertension',
                        'respiratory_disease', 'neurological_disease', 'autoimmune_disease',
                        'cyp_inhibitors_flag', 'qt_prolonging_flag', 'hla_risk_allele_flag',
                        'inpatient_flag', 'prior_adr_history'].includes(key)) {
                        patientData[key] = 1;
                    } else {
                        // Convert numeric fields
                        if (['age', 'height', 'weight', 'bmi', 'creatinine', 'egfr', 'ast_alt',
                            'bilirubin', 'albumin', 'temperature', 'ind_value', 'atpp_value',
                            'hemoglobin', 'hematocrit', 'wbc_count', 'platelet_count', 'rbc_count',
                            'neutrophils', 'lymphocytes', 'monocytes', 'eosinophils', 'basophils',
                            'mcv', 'mch', 'mchc', 'rdw',
                            'index_drug_dose', 'concomitant_drugs_count',
                            'bp_systolic', 'bp_diastolic', 'heart_rate', 'time_since_start_days'].includes(key)) {
                            patientData[key] = parseFloat(value);
                        } else {
                            patientData[key] = value;
                        }
                    }
                }

                // *** ENHANCED: Collect all external/concomitant drugs ***
                const externalDrugs = [];
                const concomitantInputs = document.querySelectorAll('.concomitant-drug-input');
                concomitantInputs.forEach((input, index) => {
                    if (input.value.trim() !== '') {
                        externalDrugs.push({
                            name: input.value.trim(),
                            index: index + 1
                        });
                    }
                });

                // Add external drugs to patient data for comprehensive analysis
                patientData.external_drugs = externalDrugs;
                patientData.external_drugs_list = externalDrugs.map(drug => drug.name);

                // Create comprehensive medication list including primary + external drugs
                const allMedications = [];
                if (patientData.medication_name && patientData.medication_name.trim() !== '') {
                    allMedications.push(patientData.medication_name.trim());
                }
                allMedications.push(...patientData.external_drugs_list);
                patientData.all_medications = allMedications;

                // Update concomitant drug count to reflect actual external drugs
                patientData.concomitant_drugs_count = externalDrugs.length;

                // Set default values for unchecked checkboxes
                const checkboxFields = ['diabetes', 'liver_disease', 'ckd', 'cardiac_disease', 'hypertension',
                    'respiratory_disease', 'neurological_disease', 'autoimmune_disease',
                    'cyp_inhibitors_flag', 'qt_prolonging_flag', 'hla_risk_allele_flag',
                    'inpatient_flag', 'prior_adr_history'];

                checkboxFields.forEach(field => {
                    if (!(field in patientData)) {
                        patientData[field] = 0;
                    }
                });

                // *** ENHANCED: Adjust risk factors based on external drugs ***
                // Increase risk if multiple high-risk drugs are present
                const highRiskDrugs = ['warfarin', 'digoxin', 'lithium', 'phenytoin', 'carbamazepine', 'methotrexate'];
                const qtProlongingDrugs = ['amiodarone', 'sotalol', 'quinidine', 'haloperidol', 'ondansetron'];
                const cypInhibitors = ['fluconazole', 'ketoconazole', 'erythromycin', 'clarithromycin', 'grapefruit'];

                let hasHighRiskDrug = false;
                let hasQTProlongingDrug = false;
                let hasCYPInhibitor = false;

                allMedications.forEach(med => {
                    const medLower = med.toLowerCase();
                    if (highRiskDrugs.some(drug => medLower.includes(drug))) {
                        hasHighRiskDrug = true;
                    }
                    if (qtProlongingDrugs.some(drug => medLower.includes(drug))) {
                        hasQTProlongingDrug = true;
                        patientData.qt_prolonging_flag = 1;
                    }
                    if (cypInhibitors.some(drug => medLower.includes(drug))) {
                        hasCYPInhibitor = true;
                        patientData.cyp_inhibitors_flag = 1;
                    }
                });

                // Adjust polypharmacy and interaction flags based on comprehensive drug analysis
                patientData.polypharmacy_flag = allMedications.length > 5 ? 1 : 0;
                patientData.high_risk_drug_flag = hasHighRiskDrug ? 1 : 0;

                // Calculate derived fields required by the model
                patientData.cumulative_dose_mg = patientData.index_drug_dose * patientData.time_since_start_days;
                patientData.dose_density_mg_day = patientData.cumulative_dose_mg / patientData.time_since_start_days;

                console.log('Sending comprehensive patient data:', patientData);
                console.log('All medications being analyzed:', allMedications);

                // Update loading text
                document.getElementById('loading-text').textContent = 'Running ADR risk prediction model...';

                // Make prediction request
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(patientData)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
                }

                const result = await response.json();
                console.log('Prediction result:', result);

                // Update loading text for final processing
                document.getElementById('loading-text').textContent = 'Finalizing assessment results...';

                // *** ADD 6-SECOND DELAY BEFORE SHOWING RESULTS ***
                // This provides users with adequate time to anticipate results and creates
                // a more professional assessment experience with detailed progress updates
                // Update loading text during delay with more detailed messages
                document.getElementById('loading-text').textContent = 'Analyzing drug interactions and calculating comprehensive risk...';
                await new Promise(resolve => setTimeout(resolve, 2000));

                document.getElementById('loading-text').textContent = 'Evaluating pharmacogenomic factors and patient-specific risks...';
                await new Promise(resolve => setTimeout(resolve, 2000));

                document.getElementById('loading-text').textContent = 'Generating personalized recommendations and clinical insights...';
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Store current data
                currentPatientData = patientData;
                currentPredictionResult = result;

                // Display results
                displayResults(result);

                // Automatically generate AI report
                generateAIReport();

                // Show mitigation strategies after a brief delay
                setTimeout(() => {
                    showMitigationStrategies(patientData, result);
                }, 2000);

                showNotification('ADR risk assessment completed successfully! All medications analyzed.', 'success');

            } catch (error) {
                console.error('Error:', error);
                showNotification(`Failed to assess ADR risk: ${error.message}`, 'error');
            } finally {
                hideLoading();
                // Reset loading text
                document.getElementById('loading-text').textContent = 'Processing assessment...';
            }
        });

        // Format AI report text for better display
        function formatAIReport(reportText) {
            if (!reportText) return '';

            let formatted = reportText;

            // Convert markdown-style headers to HTML
            formatted = formatted.replace(/^## (.*$)/gm, '<h2>$1</h2>');
            formatted = formatted.replace(/^### (.*$)/gm, '<h3>$1</h3>');
            formatted = formatted.replace(/^#### (.*$)/gm, '<h4>$1</h4>');
            formatted = formatted.replace(/^# (.*$)/gm, '<h1>$1</h1>');

            // Convert **bold** to <strong>
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            // Convert *italic* to <em>
            formatted = formatted.replace(/\*(.*?)\*/g, '<em>$1</em>');

            // Convert bullet points
            formatted = formatted.replace(/^- (.*$)/gm, '<li>$1</li>');
            formatted = formatted.replace(/^• (.*$)/gm, '<li>$1</li>');

            // Wrap consecutive list items in <ul>
            formatted = formatted.replace(/(<li>.*<\/li>)/gs, function (match) {
                return '<ul>' + match + '</ul>';
            });

            // Convert numbered lists
            formatted = formatted.replace(/^\d+\. (.*$)/gm, '<li>$1</li>');

            // Highlight risk levels
            formatted = formatted.replace(/\b(HIGH RISK|High Risk|high risk)\b/gi, '<span class="risk-high">HIGH RISK</span>');
            formatted = formatted.replace(/\b(MEDIUM RISK|Medium Risk|medium risk|MODERATE RISK|Moderate Risk|moderate risk)\b/gi, '<span class="risk-medium">MEDIUM RISK</span>');
            formatted = formatted.replace(/\b(LOW RISK|Low Risk|low risk)\b/gi, '<span class="risk-low">LOW RISK</span>');

            // Highlight medical terms
            const medicalTerms = [
                'ADR', 'adverse drug reaction', 'pharmacokinetics', 'pharmacodynamics',
                'CYP2D6', 'CYP2C9', 'metabolism', 'hepatotoxicity', 'nephrotoxicity',
                'cardiotoxicity', 'QT prolongation', 'drug interaction', 'contraindication',
                'monitoring', 'dose adjustment', 'therapeutic drug monitoring'
            ];

            medicalTerms.forEach(term => {
                const regex = new RegExp(`\\b(${term})\\b`, 'gi');
                formatted = formatted.replace(regex, '<span class="medical-term">$1</span>');
            });

            // Convert line breaks to paragraphs
            formatted = formatted.split('\n\n').map(paragraph => {
                if (paragraph.trim() && !paragraph.includes('<h') && !paragraph.includes('<ul>') && !paragraph.includes('<li>')) {
                    return `<p>${paragraph.trim()}</p>`;
                }
                return paragraph;
            }).join('\n');

            // Clean up extra line breaks
            formatted = formatted.replace(/\n/g, '');

            // Add spacing between sections
            formatted = formatted.replace(/<\/h2>/g, '</h2><div style="margin-bottom: 15px;"></div>');
            formatted = formatted.replace(/<\/h3>/g, '</h3><div style="margin-bottom: 10px;"></div>');

            return formatted;
        }

        // Generate AI Report automatically
        async function generateAIReport() {
            try {
                const reportContent = document.getElementById('report-content');

                // Show loading state
                reportContent.innerHTML = `
                    <div class="report-loading">
                        <i class="fas fa-spinner"></i>
                        <p>Generating AI clinical report...</p>
                        <p style="font-size: 0.9rem; color: #a0aec0; margin-top: 10px;">This may take a few moments...</p>
                    </div>
                `;

                const requestData = {
                    patient_data: currentPatientData,
                    prediction_result: currentPredictionResult,
                    patient_name: sessionStorage.getItem('patientName') || 'Patient',
                    patient_id: sessionStorage.getItem('patientId') || '',
                    clinician_name: sessionStorage.getItem('clinicianName') || 'Clinician'
                };

                const response = await fetch('/generate_report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const reportResult = await response.json();

                // Display the AI-generated report with enhanced formatting
                const formattedReport = formatAIReport(reportResult.report);
                reportContent.innerHTML = `
                    <div class="ai-report-content">
                        ${formattedReport}
                    </div>
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid rgba(79, 209, 197, 0.3); text-align: center;">
                        <div style="display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: 600;">
                            <i class="fas fa-robot"></i>
                            Generated by Google Gemini AI
                        </div>
                        <div style="margin-top: 8px; font-size: 0.8rem; color: #a0aec0;">
                            ${new Date().toLocaleString()}
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('Error generating AI report:', error);
                document.getElementById('report-content').innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #ef4444;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <h4 style="margin-bottom: 10px;">Report Generation Failed</h4>
                        <p>Unable to generate AI clinical report: ${error.message}</p>
                        <button onclick="generateAIReport()" class="btn btn-secondary" style="margin-top: 15px;">
                            <i class="fas fa-redo"></i> Try Again
                        </button>
                    </div>
                `;
            }
        }

        // Generate specific ADR type risks display
        function generateSpecificADRTypes(result) {
            const specificADRs = result.all_adr_types || result.top_specific_adr_risks || {};

            if (!specificADRs || Object.keys(specificADRs).length === 0) {
                return '';
            }

            // Sort ADR types by probability
            const sortedADRs = Object.entries(specificADRs)
                .filter(([adr, prob]) => adr !== 'No ADR')
                .sort(([, a], [, b]) => b - a)
                .slice(0, 6); // Show top 6 specific ADR types

            const getADRRiskLevel = (prob) => {
                if (prob >= 15) return { level: 'HIGH RISK', color: '#ef4444', bgColor: 'rgba(239, 68, 68, 0.1)', borderColor: 'rgba(239, 68, 68, 0.4)' };
                if (prob >= 5) return { level: 'MEDIUM RISK', color: '#fbbf24', bgColor: 'rgba(245, 158, 11, 0.1)', borderColor: 'rgba(245, 158, 11, 0.4)' };
                return { level: 'LOW RISK', color: '#48bb78', bgColor: 'rgba(72, 187, 120, 0.1)', borderColor: 'rgba(72, 187, 120, 0.4)' };
            };

            const getADRIcon = (adrType) => {
                if (adrType.toLowerCase().includes('cardiovascular') || adrType.toLowerCase().includes('tachycardia')) return 'fas fa-heartbeat';
                if (adrType.toLowerCase().includes('hepato') || adrType.toLowerCase().includes('liver')) return 'fas fa-liver';
                if (adrType.toLowerCase().includes('nephro') || adrType.toLowerCase().includes('kidney')) return 'fas fa-kidneys';
                if (adrType.toLowerCase().includes('hypotension')) return 'fas fa-tint';
                if (adrType.toLowerCase().includes('rash') || adrType.toLowerCase().includes('skin')) return 'fas fa-hand-paper';
                return 'fas fa-exclamation-circle';
            };

            return `
                <div style="background: rgba(79, 209, 197, 0.1); padding: 20px; border-radius: 12px; border-left: 4px solid #4fd1c5; margin-bottom: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(79, 209, 197, 0.3);">
                    <h4 style="margin: 0 0 20px 0; color: #4fd1c5; font-size: 1.2rem; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-chart-pie" style="color: #4fd1c5;"></i>
                        Specific ADR Type Risks
                    </h4>
                    
                    <div class="specific-adr-types-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        ${sortedADRs.map(([adrType, probability]) => {
                const risk = getADRRiskLevel(probability);
                const icon = getADRIcon(adrType);
                return `
                                <div class="adr-type-card" style="background: rgba(255, 255, 255, 0.05); border: 2px solid ${risk.borderColor}; border-radius: 12px; padding: 16px; position: relative; transition: all 0.3s ease; cursor: pointer; backdrop-filter: blur(10px);" 
                                     onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.1)'" 
                                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                                        <div style="background: ${risk.color}; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                            <i class="${icon}" style="font-size: 1rem;"></i>
                                        </div>
                                        <h5 style="color: #e2e8f0; font-size: 1rem; font-weight: 600; margin: 0; flex: 1; line-height: 1.3;">${adrType}</h5>
                                    </div>
                                    <div style="text-align: center; margin-bottom: 12px;">
                                        <div class="adr-probability" style="font-size: 2.2rem; font-weight: 700; color: ${risk.color}; line-height: 1;">${probability}%</div>
                                        <div style="font-size: 0.8rem; color: #a0aec0; margin-top: 2px;">Probability</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <span class="risk-badge" style="background: ${risk.color}; color: white; padding: 6px 14px; border-radius: 16px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; display: inline-block;">
                                            ${risk.level}
                                        </span>
                                    </div>
                                </div>
                            `;
            }).join('')}
                    </div>
                    
                    ${sortedADRs.length > 6 ? `
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 12px 16px; border-radius: 8px; border: 1px solid rgba(79, 209, 197, 0.2); text-align: center; backdrop-filter: blur(10px);">
                            <i class="fas fa-info-circle" style="color: #a0aec0; margin-right: 8px;"></i>
                            <span style="color: #a0aec0; font-size: 0.9rem;">
                                ${Object.keys(specificADRs).length - 6} additional ADR types monitored with lower probabilities
                            </span>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Generate comprehensive drug analysis display
        function generateComprehensiveDrugAnalysis(result) {
            const drugAnalysis = result.comprehensive_drug_analysis;

            if (!drugAnalysis || !drugAnalysis.all_medications_analyzed || drugAnalysis.all_medications_analyzed.length === 0) {
                return '';
            }

            const getRiskColor = (score) => {
                if (score >= 6) return { color: '#ef4444', bg: 'rgba(239, 68, 68, 0.15)', border: 'rgba(239, 68, 68, 0.4)', level: 'HIGH' };
                if (score >= 3) return { color: '#fbbf24', bg: 'rgba(245, 158, 11, 0.15)', border: 'rgba(245, 158, 11, 0.4)', level: 'MODERATE' };
                return { color: '#48bb78', bg: 'rgba(72, 187, 120, 0.15)', border: 'rgba(72, 187, 120, 0.4)', level: 'LOW' };
            };

            const riskStyle = getRiskColor(drugAnalysis.interaction_risk_score || 0);

            return `
                <div style="background: rgba(79, 209, 197, 0.1); padding: 20px; border-radius: 12px; border-left: 4px solid #4fd1c5; margin-bottom: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(79, 209, 197, 0.3);">
                    <h4 style="margin: 0 0 20px 0; color: #4fd1c5; font-size: 1.2rem; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-pills" style="color: #4fd1c5;"></i>
                        Comprehensive Drug Analysis
                        <span style="background: ${riskStyle.bg}; color: ${riskStyle.color}; padding: 4px 12px; border-radius: 16px; font-size: 0.8rem; font-weight: 700; margin-left: auto;">
                            ${riskStyle.level} INTERACTION RISK
                        </span>
                    </h4>
                    
                    <!-- Medication Summary -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 16px; border-radius: 10px; border: 2px solid rgba(79, 209, 197, 0.3); text-align: center; backdrop-filter: blur(10px);">
                            <div style="color: #4fd1c5; font-size: 2rem; font-weight: 700; margin-bottom: 5px;">
                                ${drugAnalysis.total_medication_count || 0}
                            </div>
                            <div style="color: #cbd5e0; font-size: 0.9rem; font-weight: 600;">Total Medications</div>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 16px; border-radius: 10px; border: 2px solid ${drugAnalysis.high_risk_drug_count > 0 ? 'rgba(239, 68, 68, 0.4)' : 'rgba(79, 209, 197, 0.3)'}; text-align: center; backdrop-filter: blur(10px);">
                            <div style="color: ${drugAnalysis.high_risk_drug_count > 0 ? '#f87171' : '#4fd1c5'}; font-size: 2rem; font-weight: 700; margin-bottom: 5px;">
                                ${drugAnalysis.high_risk_drug_count || 0}
                            </div>
                            <div style="color: #cbd5e0; font-size: 0.9rem; font-weight: 600;">High-Risk Drugs</div>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 16px; border-radius: 10px; border: 2px solid ${riskStyle.border}; text-align: center; backdrop-filter: blur(10px);">
                            <div style="color: ${riskStyle.color}; font-size: 2rem; font-weight: 700; margin-bottom: 5px;">
                                ${drugAnalysis.interaction_risk_score || 0}
                            </div>
                            <div style="color: #cbd5e0; font-size: 0.9rem; font-weight: 600;">Interaction Score</div>
                        </div>
                    </div>

                    <!-- All Medications List -->
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 16px; border-radius: 10px; border: 1px solid rgba(79, 209, 197, 0.2); margin-bottom: 15px; backdrop-filter: blur(10px);">
                        <h5 style="margin: 0 0 12px 0; color: #e2e8f0; font-size: 1rem; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-list" style="color: #4fd1c5;"></i>
                            All Medications Being Analyzed
                        </h5>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${drugAnalysis.all_medications_analyzed.map((med, index) => `
                                <span style="background: ${index === 0 ? 'rgba(79, 209, 197, 0.2)' : 'rgba(255, 255, 255, 0.05)'}; color: ${index === 0 ? '#4fd1c5' : '#cbd5e0'}; padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 500; border: 1px solid ${index === 0 ? 'rgba(79, 209, 197, 0.4)' : 'rgba(79, 209, 197, 0.2)'};">
                                    ${index === 0 ? '🎯 ' : ''}${med}
                                </span>
                            `).join('')}
                        </div>
                        ${drugAnalysis.external_drugs_count > 0 ? `
                            <div style="margin-top: 10px; padding: 8px 12px; background: rgba(79, 209, 197, 0.1); border-radius: 6px; border-left: 3px solid #4fd1c5;">
                                <i class="fas fa-info-circle" style="color: #4fd1c5; margin-right: 6px;"></i>
                                <span style="color: #cbd5e0; font-size: 0.85rem; font-weight: 500;">
                                    ${drugAnalysis.external_drugs_count} external medication(s) included in analysis
                                </span>
                            </div>
                        ` : ''}
                    </div>

                    <!-- Risk Flags -->
                    ${drugAnalysis.detected_drug_risks && drugAnalysis.detected_drug_risks.length > 0 ? `
                        <div style="background: #fef2f2; padding: 16px; border-radius: 10px; border: 1px solid #fecaca; margin-bottom: 15px;">
                            <h5 style="margin: 0 0 12px 0; color: #dc2626; font-size: 1rem; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-exclamation-triangle" style="color: #dc2626;"></i>
                                Detected Drug Risks
                            </h5>
                            <ul style="margin: 0; padding-left: 20px; color: #7f1d1d;">
                                ${drugAnalysis.detected_drug_risks.map(risk => `
                                    <li style="margin-bottom: 6px; font-size: 0.9rem;">${risk}</li>
                                `).join('')}
                            </ul>
                        </div>
                    ` : ''}

                    <!-- Risk Factor Summary -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px;">
                        ${drugAnalysis.qt_prolonging_flag ? `
                            <div style="background: #fef2f2; padding: 12px; border-radius: 8px; border-left: 3px solid #ef4444; text-align: center;">
                                <i class="fas fa-heartbeat" style="color: #ef4444; font-size: 1.2rem; margin-bottom: 5px;"></i>
                                <div style="color: #dc2626; font-size: 0.8rem; font-weight: 600;">QT Prolongation Risk</div>
                            </div>
                        ` : ''}
                        
                        ${drugAnalysis.cyp_inhibitors_flag ? `
                            <div style="background: #fef2f2; padding: 12px; border-radius: 8px; border-left: 3px solid #f59e0b; text-align: center;">
                                <i class="fas fa-dna" style="color: #f59e0b; font-size: 1.2rem; margin-bottom: 5px;"></i>
                                <div style="color: #d97706; font-size: 0.8rem; font-weight: 600;">CYP Inhibition</div>
                            </div>
                        ` : ''}
                        
                        ${drugAnalysis.bleeding_risk_flag ? `
                            <div style="background: #fef2f2; padding: 12px; border-radius: 8px; border-left: 3px solid #dc2626; text-align: center;">
                                <i class="fas fa-tint" style="color: #dc2626; font-size: 1.2rem; margin-bottom: 5px;"></i>
                                <div style="color: #dc2626; font-size: 0.8rem; font-weight: 600;">Bleeding Risk</div>
                            </div>
                        ` : ''}
                        
                        ${drugAnalysis.narrow_therapeutic_flag ? `
                            <div style="background: #fef2f2; padding: 12px; border-radius: 8px; border-left: 3px solid #7c2d12; text-align: center;">
                                <i class="fas fa-balance-scale" style="color: #7c2d12; font-size: 1.2rem; margin-bottom: 5px;"></i>
                                <div style="color: #7c2d12; font-size: 0.8rem; font-weight: 600;">Narrow Therapeutic Index</div>
                            </div>
                        ` : ''}
                    </div>

                    <!-- Final Interaction Severity -->
                    <div style="background: ${riskStyle.bg}; padding: 12px 16px; border-radius: 8px; border: 1px solid ${riskStyle.border}; margin-top: 15px; text-align: center;">
                        <span style="color: ${riskStyle.color}; font-weight: 700; font-size: 1rem;">
                            Final Drug Interaction Severity: ${drugAnalysis.final_drug_interaction_severity || 'Minor'}
                        </span>
                    </div>
                </div>
            `;
        }

        // Generate medication suggestions based on risk assessment
        function generateMedicationSuggestions(result) {
            const currentMedication = currentPatientData.medication_name || 'Current medication';
            const riskLevel = result.risk_level;
            const predictedADR = result.predicted_adr_type;

            let suggestions = [];
            let alternatives = [];

            // Generate suggestions based on risk level and predicted ADR
            if (riskLevel === 'High') {
                suggestions.push('Consider immediate dose reduction or medication discontinuation');
                suggestions.push('Implement enhanced monitoring protocols');
                suggestions.push('Evaluate alternative therapeutic options');
            } else if (riskLevel === 'Medium') {
                suggestions.push('Consider dose adjustment based on patient response');
                suggestions.push('Increase monitoring frequency');
                suggestions.push('Review for drug interactions');
            } else {
                suggestions.push('Continue current therapy with standard monitoring');
                suggestions.push('Regular follow-up assessments recommended');
            }

            // Generate alternative medications based on current medication and risk
            const medicationAlternatives = {
                'Warfarin': ['Apixaban', 'Rivaroxaban', 'Dabigatran'],
                'Metformin': ['Sitagliptin', 'Empagliflozin', 'Liraglutide'],
                'Atorvastatin': ['Rosuvastatin', 'Pravastatin', 'Pitavastatin'],
                'Lisinopril': ['Losartan', 'Valsartan', 'Telmisartan'],
                'Amlodipine': ['Nifedipine XL', 'Felodipine', 'Clevidipine'],
                'Metoprolol': ['Carvedilol', 'Bisoprolol', 'Nebivolol']
            };

            alternatives = medicationAlternatives[currentMedication] || ['Consult specialist for alternatives'];

            return `
                <div style="background: rgba(79, 209, 197, 0.1); padding: 20px; border-radius: 12px; border-left: 4px solid #4fd1c5; margin-bottom: 20px; border: 1px solid rgba(79, 209, 197, 0.2);">
                    <h4 style="margin: 0 0 15px 0; color: #4fd1c5; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-pills" style="color: #4fd1c5;"></i>
                        Medication Recommendations
                    </h4>
                    <div style="margin-bottom: 15px;">
                        <h5 style="color: #cbd5e0; margin: 0 0 8px 0; font-size: 1rem;">Clinical Suggestions:</h5>
                        ${suggestions.map(suggestion => `
                            <div style="display: flex; align-items: flex-start; gap: 8px; margin-bottom: 6px;">
                                <i class="fas fa-check-circle" style="color: #10b981; margin-top: 2px; font-size: 0.9rem;"></i>
                                <span style="color: #cbd5e0; font-size: 0.95rem;">${suggestion}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div>
                        <h5 style="color: #cbd5e0; margin: 0 0 8px 0; font-size: 1rem;">Alternative Medications:</h5>
                        <div class="medication-alternatives" style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${alternatives.map(alt => `
                                <div class="medication-alt" style="background: rgba(79, 209, 197, 0.15); padding: 8px 14px; border-radius: 20px; border: 1px solid rgba(79, 209, 197, 0.4); color: #4fd1c5; font-size: 0.9rem; font-weight: 500; flex: 1; min-width: 120px; text-align: center;">
                                    ${alt}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // Generate clinical suggestions based on risk assessment
        function generateClinicalSuggestions(result) {
            const riskLevel = result.risk_level;
            const predictedADR = result.predicted_adr_type;

            let monitoringParams = [];
            let clinicalActions = [];
            let followUpSchedule = '';

            // Generate monitoring parameters based on predicted ADR
            if (predictedADR.includes('Cardiovascular') || predictedADR.includes('Tachycardia')) {
                monitoringParams.push('ECG monitoring', 'Blood pressure checks', 'Heart rate monitoring');
                clinicalActions.push('Cardiac consultation if symptoms develop', 'Avoid QT-prolonging drugs');
            } else if (predictedADR.includes('Hepatotoxicity') || predictedADR.includes('Liver')) {
                monitoringParams.push('Liver function tests (AST/ALT)', 'Bilirubin levels', 'Clinical signs of jaundice');
                clinicalActions.push('Discontinue if ALT >3x ULN', 'Avoid hepatotoxic drugs');
            } else if (predictedADR.includes('Nephrotoxicity') || predictedADR.includes('Kidney')) {
                monitoringParams.push('Serum creatinine', 'eGFR calculation', 'Urine output monitoring');
                clinicalActions.push('Dose adjustment for renal function', 'Avoid nephrotoxic agents');
            } else {
                monitoringParams.push('Vital signs', 'Clinical symptoms', 'Laboratory parameters');
                clinicalActions.push('Regular clinical assessment', 'Patient symptom monitoring');
            }

            // Set follow-up schedule based on risk level
            if (riskLevel === 'High') {
                followUpSchedule = 'Weekly for first month, then bi-weekly';
            } else if (riskLevel === 'Medium') {
                followUpSchedule = 'Bi-weekly for first month, then monthly';
            } else {
                followUpSchedule = 'Monthly for first 3 months, then quarterly';
            }

            return `
                <div style="background: rgba(72, 187, 120, 0.1); padding: 20px; border-radius: 12px; border-left: 4px solid #48bb78; margin-bottom: 20px; border: 1px solid rgba(72, 187, 120, 0.2);">
                    <h4 style="margin: 0 0 15px 0; color: #48bb78; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-stethoscope" style="color: #48bb78;"></i>
                        Clinical Management Plan
                    </h4>
                    
                    <div style="margin-bottom: 15px;">
                        <h5 style="color: #cbd5e0; margin: 0 0 8px 0; font-size: 1rem;">Monitoring Parameters:</h5>
                        <div class="monitoring-params" style="display: flex; flex-wrap: wrap; gap: 8px;">
                            ${monitoringParams.map(param => `
                                <div class="monitoring-param" style="background: rgba(72, 187, 120, 0.1); padding: 8px 14px; border-radius: 16px; border: 1px solid rgba(72, 187, 120, 0.3); color: #48bb78; font-size: 0.9rem; font-weight: 500; flex: 1; min-width: 140px; text-align: center;">
                                    <i class="fas fa-heartbeat" style="color: #48bb78; margin-right: 6px; font-size: 0.8rem;"></i>
                                    ${param}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h5 style="color: #cbd5e0; margin: 0 0 8px 0; font-size: 1rem;">Clinical Actions:</h5>
                        ${clinicalActions.map(action => `
                            <div style="display: flex; align-items: flex-start; gap: 8px; margin-bottom: 6px;">
                                <i class="fas fa-arrow-right" style="color: #48bb78; margin-top: 2px; font-size: 0.9rem;"></i>
                                <span style="color: #cbd5e0; font-size: 0.95rem;">${action}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="background: rgba(72, 187, 120, 0.1); padding: 12px 16px; border-radius: 8px; border: 1px solid rgba(72, 187, 120, 0.3); backdrop-filter: blur(10px);">
                        <h5 style="color: #48bb78; margin: 0 0 6px 0; font-size: 1rem;">Follow-up Schedule:</h5>
                        <span style="color: #cbd5e0; font-weight: 500;">${followUpSchedule}</span>
                    </div>
                </div>
            `;
        }

        // Check if mobile device
        function isMobile() {
            return window.innerWidth <= 768;
        }

        // Display results function
        function displayResults(result) {
            // Store results globally for medical report
            window.currentPredictionResult = result;

            const resultsContainer = document.getElementById('results-container');
            const resultsContent = document.getElementById('results-content');

            if (resultsContainer && resultsContent) {
                const riskColor = {
                    'Low': '#10b981',
                    'Medium': '#f59e0b',
                    'High': '#ef4444'
                }[result.risk_level] || '#6b7280';

                const isMobileView = isMobile();
                const gridStyle = isMobileView ?
                    'display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px;' :
                    'display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;';

                const cardPadding = isMobileView ? '15px' : '20px';
                const titleSize = isMobileView ? '1rem' : '1.2rem';
                const valueSize = isMobileView ? '1.5rem' : '2rem';

                resultsContent.innerHTML = `
                    <div style="background: rgba(255, 255, 255, 0.05); padding: ${isMobileView ? '15px' : '25px'}; border-radius: 16px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); border: 1px solid rgba(79, 209, 197, 0.2); backdrop-filter: blur(10px);">
                        <div style="${gridStyle}">
                            <div style="text-align: center; padding: ${cardPadding}; background: ${riskColor}; color: white; border-radius: 12px;">
                                <h3 style="margin: 0 0 10px 0; font-size: ${titleSize};">Risk Level</h3>
                                <div style="font-size: ${valueSize}; font-weight: 700;">${result.risk_level}</div>
                            </div>
                            <div style="text-align: center; padding: ${cardPadding}; background: rgba(255, 255, 255, 0.05); border-radius: 12px; border: 2px solid rgba(79, 209, 197, 0.3); backdrop-filter: blur(10px);">
                                <h3 style="margin: 0 0 10px 0; font-size: ${titleSize}; color: #e2e8f0;">Predicted ADR</h3>
                                <div style="font-size: ${isMobileView ? '1.2rem' : '1.5rem'}; font-weight: 600; color: #cbd5e0; line-height: 1.2;">${result.predicted_adr_type}</div>
                            </div>
                            <div style="text-align: center; padding: ${cardPadding}; background: rgba(79, 209, 197, 0.1); border-radius: 12px; border: 2px solid rgba(79, 209, 197, 0.3); backdrop-filter: blur(10px);">
                                <h3 style="margin: 0 0 10px 0; font-size: ${titleSize}; color: #4fd1c5;">No ADR Probability</h3>
                                <div style="font-size: ${valueSize}; font-weight: 700; color: #4fd1c5;">${result.no_adr_probability}%</div>
                            </div>
                        </div>
                        
                        ${result.top_adr_risks ? `
                        <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px; border: 1px solid rgba(79, 209, 197, 0.2); margin-bottom: 20px; backdrop-filter: blur(10px);">
                            <h4 style="margin: 0 0 15px 0; color: #e2e8f0; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-exclamation-triangle" style="color: #fbbf24;"></i>
                                Top ADR Risk Probabilities
                            </h4>
                            ${Object.entries(result.top_adr_risks).slice(0, 5).map(([adr, prob]) => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(79, 209, 197, 0.2);">
                                    <span style="font-weight: 500; color: #cbd5e0; flex: 1;">${adr}</span>
                                    <span style="font-weight: 700; color: #4fd1c5; font-size: 1.1rem;">${prob}%</span>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                        
                        ${generateSpecificADRTypes(result)}
                        
                        ${generateComprehensiveDrugAnalysis(result)}
                        
                        ${generateMedicationSuggestions(result)}
                        ${generateClinicalSuggestions(result)}
                        
                        <!-- Mitigation Strategies Button -->
                        <div style="text-align: center; margin-top: 25px; padding-top: 20px; border-top: 2px solid rgba(79, 209, 197, 0.2);">
                            <button onclick="showMitigationStrategies(currentPatientData, currentPredictionResult)" 
                                    class="btn btn-success" 
                                    style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); 
                                           border: none; 
                                           padding: 15px 30px; 
                                           font-size: 1.1rem; 
                                           font-weight: 600; 
                                           border-radius: 12px; 
                                           color: white; 
                                           cursor: pointer; 
                                           transition: all 0.3s ease;
                                           box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                                <i class="fas fa-shield-alt" style="margin-right: 10px;"></i>
                                View Personalized Mitigation Strategies
                            </button>
                            <p style="margin: 10px 0 0 0; color: #64748b; font-size: 0.9rem;">
                                Get AI-powered recommendations to reduce ADR risk and optimize patient safety
                            </p>
                        </div>
                    </div>
                `;
                resultsContainer.style.display = 'block';
                // Auto-scroll removed for better user control
                // resultsContainer.scrollIntoView({ behavior: 'smooth' });

                // Show scroll down notification and indicator
                showNotification('✅ Assessment complete! Scroll down to view your results', 'success', 5000);
                showScrollIndicator();
            }
        }

        // Clear form handler
        document.getElementById('clear-form').addEventListener('click', () => {
            if (confirm('Are you sure you want to clear all form data?')) {
                document.getElementById('adr-form').reset();
                document.getElementById('bmi').value = '';
                document.getElementById('bmi-value').textContent = '--';
                document.getElementById('bmi-category').textContent = 'Enter height & weight';
                document.getElementById('bmi-category').className = 'bmi-category';
                showNotification('Form cleared successfully', 'success');
            }
        });

        // Sample data selector handler - automatic loading
        document.getElementById('sample-data-selector').addEventListener('change', (e) => {
            if (e.target.value) {
                loadSampleData(e.target.value);
                // Don't reset selector to show which sample is loaded
            }
        });

        // Information button handler
        document.getElementById('info-button').addEventListener('click', () => {
            showInfoModal();
        });

        // Comparison modal functions
        function showComparisonModal() {
            const modal = document.getElementById('comparison-modal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeComparisonModal() {
            const modal = document.getElementById('comparison-modal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        function showComparisonTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));

            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));

            // Show selected tab content
            const selectedTab = document.getElementById(tabName + '-tab');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // Add active class to clicked button
            const clickedButton = event.target.closest('.tab-button');
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
        }

        function openInfoModal() {
            closeComparisonModal();
            setTimeout(() => showInfoModal(), 300);
        }

        // Comparison button handler
        document.getElementById('comparison-button').addEventListener('click', () => {
            showComparisonModal();
        });

        // Close comparison modal when clicking outside
        document.getElementById('comparison-modal').addEventListener('click', (e) => {
            if (e.target.id === 'comparison-modal') {
                closeComparisonModal();
            }
        });

        // Close comparison modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const comparisonModal = document.getElementById('comparison-modal');
                if (comparisonModal.classList.contains('active')) {
                    closeComparisonModal();
                }
            }
        });

        // Mitigation Strategies Functions
        function showMitigationStrategies(patientData, predictionResult) {
            const container = document.getElementById('mitigation-strategies-container');
            container.style.display = 'block';

            // Auto-scroll removed for better user control
            // container.scrollIntoView({ behavior: 'smooth' });

            // Load mitigation strategies data
            loadMitigationStrategies(patientData, predictionResult);
        }

        function hideMitigationStrategies() {
            const container = document.getElementById('mitigation-strategies-container');
            container.style.display = 'none';
        }

        function showMitigationTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.mitigation-tab-content');
            tabContents.forEach(content => content.classList.remove('active'));

            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.mitigation-tab');
            tabButtons.forEach(button => button.classList.remove('active'));

            // Show selected tab content
            const selectedTab = document.getElementById(tabName + '-tab');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // Add active class to clicked button
            const clickedButton = event.target.closest('.mitigation-tab');
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
        }

        async function loadMitigationStrategies(patientData, predictionResult) {
            try {
                showLoading();

                const response = await fetch('/mitigation_strategies', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        patient_data: patientData,
                        prediction_result: predictionResult
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const strategies = await response.json();

                // Populate each tab with data
                populateRiskReductionTab(strategies.risk_reduction_recommendations);
                populateAlternativesTab(strategies.alternative_drug_suggestions);
                populateDosingTab(strategies.dose_optimization);
                populateMonitoringTab(strategies.monitoring_protocol);
                populateEducationTab(strategies.patient_education);

                hideLoading();

            } catch (error) {
                console.error('Error loading mitigation strategies:', error);
                hideLoading();
                showNotification('Error loading mitigation strategies: ' + error.message, 'error');
            }
        }

        function populateRiskReductionTab(recommendations) {
            const container = document.getElementById('risk-reduction-content');

            if (!recommendations || recommendations.length === 0) {
                container.innerHTML = '<p class="no-data">No specific risk reduction recommendations available.</p>';
                return;
            }

            const html = recommendations.map(rec => `
                <div class="recommendation-card">
                    <div class="recommendation-header">
                        <div class="recommendation-category">${rec.category}</div>
                        <div class="priority-badge ${rec.priority.toLowerCase()}">${rec.priority}</div>
                    </div>
                    <div class="recommendation-intervention">${rec.intervention}</div>
                    <div class="recommendation-rationale">${rec.rationale}</div>
                    <div class="recommendation-timeline">
                        <i class="fas fa-clock"></i>
                        ${rec.timeline}
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function populateAlternativesTab(alternatives) {
            const container = document.getElementById('alternatives-content');

            if (!alternatives || alternatives.length === 0) {
                container.innerHTML = '<p class="no-data">No alternative drug suggestions available.</p>';
                return;
            }

            const html = alternatives.map(alt => `
                <div class="alternative-card">
                    <div class="alternative-header">
                        <div class="alternative-name">${alt.alternative}</div>
                        <div class="risk-reduction-badge">Risk Reduction: ${alt.risk_reduction}</div>
                    </div>
                    <div class="alternative-details">
                        <div class="advantages-list">
                            <h5><i class="fas fa-check-circle"></i> Advantages</h5>
                            <ul>
                                ${alt.advantages.map(adv => `<li>${adv}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="considerations-list">
                            <h5><i class="fas fa-exclamation-triangle"></i> Considerations</h5>
                            <ul>
                                ${alt.considerations.map(con => `<li>${con}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="monitoring-note">
                        <strong>Monitoring:</strong> ${alt.monitoring}
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function populateDosingTab(dosingRecommendations) {
            const container = document.getElementById('dosing-content');

            if (!dosingRecommendations || dosingRecommendations.length === 0) {
                container.innerHTML = '<p class="no-data">No dose optimization recommendations available.</p>';
                return;
            }

            const html = dosingRecommendations.map(dose => `
                <div class="dosing-card">
                    <div class="dosing-header">
                        <div class="adjustment-type">${dose.adjustment_type}</div>
                        <div class="evidence-badge">${dose.evidence_level}</div>
                    </div>
                    <div class="dosing-recommendation">${dose.recommendation}</div>
                    <div class="dosing-rationale">${dose.rationale}</div>
                    <div class="dosing-monitoring">
                        <strong>Monitoring:</strong> ${dose.monitoring}
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function populateMonitoringTab(monitoringProtocol) {
            const container = document.getElementById('monitoring-content');

            if (!monitoringProtocol) {
                container.innerHTML = '<p class="no-data">No monitoring protocol available.</p>';
                return;
            }

            const html = `
                <div class="monitoring-section">
                    <h4><i class="fas fa-clipboard-list"></i> Baseline Assessments</h4>
                    ${monitoringProtocol.baseline_assessments.map(assessment => `
                        <div class="monitoring-item">
                            <h5>${assessment.assessment}</h5>
                            <p><strong>Rationale:</strong> ${assessment.rationale}</p>
                            <p><strong>Timing:</strong> ${assessment.timing}</p>
                        </div>
                    `).join('')}
                </div>
                
                <div class="monitoring-section">
                    <h4><i class="fas fa-heartbeat"></i> Ongoing Monitoring</h4>
                    ${monitoringProtocol.ongoing_monitoring.map(monitor => `
                        <div class="monitoring-item">
                            <h5>${monitor.parameter}</h5>
                            <p><strong>Frequency:</strong> ${monitor.frequency}</p>
                            <p><strong>Alert Threshold:</strong> ${monitor.alert_threshold}</p>
                            <p><strong>Action:</strong> ${monitor.action}</p>
                        </div>
                    `).join('')}
                </div>
                
                <div class="monitoring-section">
                    <h4><i class="fas fa-exclamation-triangle"></i> Emergency Indicators</h4>
                    <ul class="emergency-list">
                        ${monitoringProtocol.emergency_indicators.map(indicator => `
                            <li>${indicator}</li>
                        `).join('')}
                    </ul>
                </div>
            `;

            container.innerHTML = html;
        }

        function populateEducationTab(patientEducation) {
            const container = document.getElementById('education-content');

            if (!patientEducation) {
                container.innerHTML = '<p class="no-data">No patient education materials available.</p>';
                return;
            }

            const html = `
                <div class="education-card">
                    <h4><i class="fas fa-exclamation-triangle"></i> Warning Signs</h4>
                    <ul class="education-list">
                        ${patientEducation.warning_signs.map(sign => `<li>${sign}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="education-card">
                    <h4><i class="fas fa-user-check"></i> Self-Monitoring</h4>
                    <ul class="education-list">
                        ${patientEducation.self_monitoring.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="education-card">
                    <h4><i class="fas fa-heart"></i> Lifestyle Modifications</h4>
                    <ul class="education-list">
                        ${patientEducation.lifestyle_modifications.map(mod => `<li>${mod}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="education-card">
                    <h4><i class="fas fa-phone-alt"></i> When to Seek Help</h4>
                    <ul class="education-list">
                        ${patientEducation.when_to_seek_help.map(help => `<li>${help}</li>`).join('')}
                    </ul>
                </div>
            `;

            container.innerHTML = html;
        }

        function generateMitigationReport() {
            // This would generate a comprehensive PDF report of all mitigation strategies
            showNotification('Mitigation report generation feature coming soon!', 'info');
        }

        function implementStrategies() {
            // This would integrate with EHR systems to implement the strategies
            showNotification('Strategy implementation feature coming soon!', 'info');
        }

        // Setup BMI calculation listeners
        document.getElementById('height').addEventListener('input', calculateBMI);
        document.getElementById('weight').addEventListener('input', calculateBMI);

        // Test server connectivity
        async function testServerConnection() {
            try {
                const response = await fetch('/test');
                if (response.ok) {
                    const data = await response.json();
                    console.log('Server connection test successful:', data);
                    return true;
                } else {
                    console.error('Server connection test failed:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('Server connection error:', error);
                showNotification('Server connection failed. Please check if the server is running.', 'error');
                return false;
            }
        }

        // Handle window resize for responsive updates
        function handleResize() {
            // Force re-render of results if they exist
            if (currentPredictionResult && Object.keys(currentPredictionResult).length > 0) {
                displayResults(currentPredictionResult);
            }
        }

        // Ensure buttons are visible
        function ensureButtonsVisible() {
            const formActions = document.querySelector('.form-actions');
            const submitBtn = document.querySelector('button[type="submit"]');
            const clearBtn = document.getElementById('clear-form');

            if (formActions) {
                formActions.style.display = 'flex';
                formActions.style.visibility = 'visible';
                formActions.style.opacity = '1';
                console.log('Form actions container found and made visible');
            } else {
                console.error('Form actions container not found!');
            }

            if (submitBtn) {
                console.log('Submit button found');
            } else {
                console.error('Submit button not found!');
            }

            if (clearBtn) {
                console.log('Clear button found');
            } else {
                console.error('Clear button not found!');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function () {
            initializePatientInfo();

            // Ensure buttons are visible
            setTimeout(ensureButtonsVisible, 100);

            // Test server connection
            testServerConnection();

            // Add resize listener for responsive updates
            window.addEventListener('resize', handleResize);

            // Add orientation change listener for mobile
            window.addEventListener('orientationchange', function () {
                setTimeout(handleResize, 100);
            });

            // Show loading animation initially
            showLoading();
            setTimeout(() => {
                hideLoading();
            }, 1500);
        });


        // Concomitant Drug Functions
        function addDrugField() {
            const container = document.getElementById('concomitant-drugs-container');
            const drugCount = container.children.length;

            if (drugCount < 20) {
                const drugItem = document.createElement('div');
                drugItem.className = 'concomitant-drug-item';
                drugItem.innerHTML = `
                    <input type="text" name="concomitant_drug_${drugCount + 1}" placeholder="Enter drug name (e.g., Aspirin 81mg)" class="concomitant-drug-input" onchange="updateDrugCount()">
                    <button type="button" class="remove-drug-btn" onclick="removeDrugField(this)">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(drugItem);
                updateDrugCount();
            }
        }

        function removeDrugField(button) {
            const container = document.getElementById('concomitant-drugs-container');
            if (container.children.length > 1) {
                button.parentElement.remove();
                updateDrugCount();
            }
        }

        function updateDrugCount() {
            const container = document.getElementById('concomitant-drugs-container');
            const inputs = container.querySelectorAll('.concomitant-drug-input');
            let count = 0;
            let drugNames = [];

            inputs.forEach(input => {
                if (input.value.trim() !== '') {
                    count++;
                    drugNames.push(input.value.trim());
                }
            });

            document.getElementById('concomitant_drugs_count').value = count;

            // Show feedback about external drugs
            const feedbackElement = document.getElementById('external-drugs-feedback');
            if (feedbackElement) {
                feedbackElement.remove();
            }

            if (count > 0) {
                const feedback = document.createElement('div');
                feedback.id = 'external-drugs-feedback';
                feedback.style.cssText = `
                    margin-top: 10px; 
                    padding: 12px; 
                    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); 
                    border-radius: 8px; 
                    border-left: 4px solid #0ea5e9;
                    font-size: 0.9rem;
                `;
                feedback.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <i class="fas fa-pills" style="color: #0ea5e9;"></i>
                        <span style="color: #0c4a6e; font-weight: 600;">
                            ${count} external medication${count > 1 ? 's' : ''} will be analyzed for ADR risk
                        </span>
                    </div>
                    <div style="color: #0369a1; font-size: 0.85rem;">
                        All medications: ${drugNames.join(', ')}
                    </div>
                `;
                container.appendChild(feedback);
            }
        }

        // Auto-update drug count when typing
        document.addEventListener('DOMContentLoaded', function () {
            const container = document.getElementById('concomitant-drugs-container');
            if (container) {
                container.addEventListener('input', updateDrugCount);
            }
        });



        // Client-side lab interpretation (fallback when server endpoint not available)
        function getLabInterpretationClientSide(testName, value, sex = 'M') {
            const interpretations = [];

            // Renal function interpretations
            if (testName === 'creatinine') {
                if (sex === 'M') {
                    if (value > 1.3) {
                        interpretations.push({
                            status: 'High',
                            clinical_significance: 'Renal impairment',
                            severity: value > 2.0 ? 'High' : 'Moderate'
                        });
                    }
                } else {
                    if (value > 1.1) {
                        interpretations.push({
                            status: 'High',
                            clinical_significance: 'Renal impairment',
                            severity: value > 2.0 ? 'High' : 'Moderate'
                        });
                    }
                }
            }

            else if (testName === 'egfr') {
                if (value < 60) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Chronic Kidney Disease',
                        severity: value < 30 ? 'High' : 'Moderate'
                    });
                } else if (value < 90) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Mild kidney dysfunction',
                        severity: 'Low'
                    });
                }
            }

            // Liver function interpretations
            else if (testName === 'ast_alt') {
                if (value > 40) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Liver injury/inflammation',
                        severity: value > 120 ? 'High' : 'Moderate'
                    });
                }
            }

            else if (testName === 'bilirubin') {
                if (value > 1.2) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Jaundice risk',
                        severity: value < 3.0 ? 'Moderate' : 'High'
                    });
                }
            }

            else if (testName === 'albumin') {
                if (value < 3.5) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Liver dysfunction/malnutrition',
                        severity: 'Moderate'
                    });
                }
            }

            // NEW FIELD INTERPRETATIONS
            else if (testName === 'temperature') {
                if (value > 100.4) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Fever - possible infection/inflammation',
                        severity: value > 103.0 ? 'High' : 'Moderate'
                    });
                } else if (value < 97.0) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Hypothermia - possible shock/exposure',
                        severity: value < 95.0 ? 'High' : 'Moderate'
                    });
                }
            }

            else if (testName === 'ind_value') {
                if (value > 3.0) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Increased bleeding risk',
                        severity: 'High'
                    });
                } else if (value > 1.5) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Anticoagulation therapy range',
                        severity: 'Moderate'
                    });
                } else if (value < 0.8) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Possible clotting tendency',
                        severity: 'Low'
                    });
                }
            }

            else if (testName === 'atpp_value') {
                if (value > 45) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Prolonged clotting - bleeding risk',
                        severity: value > 80 ? 'High' : 'Moderate'
                    });
                } else if (value < 25) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Shortened clotting time',
                        severity: 'Low'
                    });
                }
            }

            // CBC interpretations
            else if (testName === 'hemoglobin') {
                if (sex === 'M') {
                    if (value < 13.5) {
                        interpretations.push({
                            status: 'Low',
                            clinical_significance: 'Anemia - investigate cause',
                            severity: value < 10.0 ? 'High' : 'Moderate'
                        });
                    } else if (value > 17.5) {
                        interpretations.push({
                            status: 'High',
                            clinical_significance: 'Polycythemia - dehydration or blood disorder',
                            severity: 'Moderate'
                        });
                    }
                } else {
                    if (value < 12.0) {
                        interpretations.push({
                            status: 'Low',
                            clinical_significance: 'Anemia - investigate cause',
                            severity: value < 10.0 ? 'High' : 'Moderate'
                        });
                    } else if (value > 15.5) {
                        interpretations.push({
                            status: 'High',
                            clinical_significance: 'Polycythemia - dehydration or blood disorder',
                            severity: 'Moderate'
                        });
                    }
                }
            }

            else if (testName === 'hematocrit') {
                if (sex === 'M') {
                    if (value < 41) {
                        interpretations.push({
                            status: 'Low',
                            clinical_significance: 'Anemia or blood loss',
                            severity: value < 30 ? 'High' : 'Moderate'
                        });
                    } else if (value > 50) {
                        interpretations.push({
                            status: 'High',
                            clinical_significance: 'Polycythemia or dehydration',
                            severity: 'Moderate'
                        });
                    }
                } else {
                    if (value < 36) {
                        interpretations.push({
                            status: 'Low',
                            clinical_significance: 'Anemia or blood loss',
                            severity: value < 30 ? 'High' : 'Moderate'
                        });
                    } else if (value > 44) {
                        interpretations.push({
                            status: 'High',
                            clinical_significance: 'Polycythemia or dehydration',
                            severity: 'Moderate'
                        });
                    }
                }
            }

            else if (testName === 'wbc_count') {
                if (value > 11.0) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Leukocytosis - infection, inflammation, or malignancy',
                        severity: value > 20.0 ? 'High' : 'Moderate'
                    });
                } else if (value < 4.5) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Leukopenia - immunosuppression or bone marrow disorder',
                        severity: value < 2.0 ? 'High' : 'Moderate'
                    });
                }
            }

            else if (testName === 'platelet_count') {
                if (value < 150) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Thrombocytopenia - bleeding risk',
                        severity: value < 50 ? 'High' : 'Moderate'
                    });
                } else if (value > 450) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Thrombocytosis - thrombosis risk',
                        severity: value > 600 ? 'High' : 'Moderate'
                    });
                }
            }

            else if (testName === 'rbc_count') {
                if (sex === 'M') {
                    if (value < 4.7) {
                        interpretations.push({
                            status: 'Low',
                            clinical_significance: 'Anemia or blood loss',
                            severity: value < 3.5 ? 'High' : 'Moderate'
                        });
                    } else if (value > 6.1) {
                        interpretations.push({
                            status: 'High',
                            clinical_significance: 'Polycythemia',
                            severity: 'Moderate'
                        });
                    }
                } else {
                    if (value < 4.2) {
                        interpretations.push({
                            status: 'Low',
                            clinical_significance: 'Anemia or blood loss',
                            severity: value < 3.5 ? 'High' : 'Moderate'
                        });
                    } else if (value > 5.4) {
                        interpretations.push({
                            status: 'High',
                            clinical_significance: 'Polycythemia',
                            severity: 'Moderate'
                        });
                    }
                }
            }

            else if (testName === 'neutrophils') {
                if (value > 70) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Neutrophilia - bacterial infection or stress response',
                        severity: value > 85 ? 'High' : 'Moderate'
                    });
                } else if (value < 50) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Neutropenia - increased infection risk',
                        severity: value < 30 ? 'High' : 'Moderate'
                    });
                }
            }

            else if (testName === 'lymphocytes') {
                if (value > 40) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Lymphocytosis - viral infection or hematologic malignancy',
                        severity: value > 60 ? 'High' : 'Moderate'
                    });
                } else if (value < 20) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Lymphopenia - immunosuppression',
                        severity: value < 10 ? 'High' : 'Moderate'
                    });
                }
            }

            else if (testName === 'monocytes') {
                if (value > 8) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Monocytosis - chronic inflammation or infection',
                        severity: value > 15 ? 'High' : 'Moderate'
                    });
                } else if (value < 2) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Monocytopenia - rare finding, monitor immune function',
                        severity: 'Low'
                    });
                }
            }

            else if (testName === 'eosinophils') {
                if (value > 4) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Eosinophilia - allergic reaction, parasites, or drug reaction',
                        severity: value > 10 ? 'High' : 'Moderate'
                    });
                } else if (value < 1) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Eosinopenia - stress response or corticosteroid effect',
                        severity: 'Low'
                    });
                }
            }

            else if (testName === 'basophils') {
                if (value > 1) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Basophilia - allergic reaction or myeloproliferative disorder',
                        severity: value > 2 ? 'High' : 'Moderate'
                    });
                }
            }

            else if (testName === 'mcv') {
                if (value > 100) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Macrocytic anemia - B12/folate deficiency or alcohol use',
                        severity: value > 110 ? 'High' : 'Moderate'
                    });
                } else if (value < 80) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Microcytic anemia - iron deficiency or thalassemia',
                        severity: value < 70 ? 'High' : 'Moderate'
                    });
                }
            }

            else if (testName === 'mch') {
                if (value > 32) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Elevated hemoglobin content - macrocytic anemia',
                        severity: 'Moderate'
                    });
                } else if (value < 27) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Low hemoglobin content - microcytic anemia',
                        severity: 'Moderate'
                    });
                }
            }

            else if (testName === 'mchc') {
                if (value > 36) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Hyperchromic cells - spherocytosis or dehydration',
                        severity: 'Moderate'
                    });
                } else if (value < 32) {
                    interpretations.push({
                        status: 'Low',
                        clinical_significance: 'Hypochromic cells - iron deficiency anemia',
                        severity: 'Moderate'
                    });
                }
            }

            else if (testName === 'rdw') {
                if (value > 14.5) {
                    interpretations.push({
                        status: 'High',
                        clinical_significance: 'Anisocytosis - mixed cell populations, nutritional deficiency',
                        severity: value > 18 ? 'High' : 'Moderate'
                    });
                }
            }

            return interpretations;
        }

        // Lab interpretation function
        async function interpretLabValue(testName) {
            console.log('interpretLabValue called with:', testName);

            const inputElement = document.getElementById(testName);
            const interpretationDiv = document.getElementById(`${testName}_interpretation`);
            const sexElement = document.getElementById('sex');

            if (!inputElement) {
                showNotification(`Input element not found for ${testName}`, 'error');
                return;
            }

            if (!inputElement.value) {
                showNotification('Please enter a value first', 'error');
                return;
            }

            const value = parseFloat(inputElement.value);
            const sex = sexElement ? sexElement.value || 'M' : 'M';

            // Try server-side interpretation first, fallback to client-side
            try {
                const response = await fetch('/interpret_lab_value', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        test_name: testName,
                        value: value,
                        sex: sex
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    displayLabInterpretation(testName, result);
                    showNotification('Lab value interpreted successfully!', 'success');
                    return;
                }
            } catch (error) {
                console.log('Server endpoint not available, using client-side interpretation');
            }

            // Fallback to client-side interpretation
            const interpretations = getLabInterpretationClientSide(testName, value, sex);
            const result = {
                test_name: testName,
                value: value,
                sex: sex,
                interpretations: interpretations,
                timestamp: new Date().toISOString()
            };

            displayLabInterpretation(testName, result);
            showNotification('Lab value interpreted successfully! (Client-side)', 'success');
        }

        function displayLabInterpretation(testName, result) {
            const interpretationDiv = document.getElementById(`${testName}_interpretation`);

            if (result.interpretations && result.interpretations.length > 0) {
                const interpretationsHtml = result.interpretations.map(interp => `
                    <div class="lab-interp-item ${interp.severity.toLowerCase()}-severity">
                        <div class="interp-status">${interp.status}</div>
                        <div class="interp-significance">${interp.clinical_significance}</div>
                        <div class="interp-severity">Severity: ${interp.severity}</div>
                    </div>
                `).join('');

                interpretationDiv.innerHTML = `
                    <div class="lab-interp-container">
                        <h6><i class="fas fa-microscope"></i> Clinical Interpretation</h6>
                        ${interpretationsHtml}
                    </div>
                `;
                interpretationDiv.style.display = 'block';
            } else {
                interpretationDiv.innerHTML = `
                    <div class="lab-interp-container normal">
                        <h6><i class="fas fa-check-circle"></i> Normal Range</h6>
                        <div class="interp-normal">Value within normal limits</div>
                    </div>
                `;
                interpretationDiv.style.display = 'block';
            }
        }

        // Enhanced results display with new features
        function displayEnhancedResults(result) {
            // Display major ADR factors with enhanced clinical information
            if (result.major_adr_factors && result.major_adr_factors.length > 0) {
                const factorsHtml = result.major_adr_factors.map(factor => `
                    <div class="adr-factor-card ${factor.risk_contribution.toLowerCase()}-risk">
                        <div class="factor-header">
                            <h5>${factor.factor}</h5>
                            <span class="risk-badge ${factor.risk_contribution.toLowerCase()}">${factor.risk_contribution} Risk</span>
                        </div>
                        <div class="factor-value">${factor.value}</div>
                        <div class="factor-description">${factor.description}</div>
                        ${factor.clinical_reference ? `<div class="factor-reference"><i class="fas fa-book-medical"></i> ${factor.clinical_reference}</div>` : ''}
                    </div>
                `).join('');

                document.getElementById('major-factors-container').innerHTML = factorsHtml;
            }

            // Display medication list
            if (result.medication_list && result.medication_list.length > 0) {
                const medicationsHtml = result.medication_list.map(med => `
                    <div class="medication-card ${med.risk_level.toLowerCase()}-risk">
                        <div class="med-header">
                            <h5>${med.name}</h5>
                            <span class="med-type ${med.type.toLowerCase()}">${med.type}</span>
                        </div>
                        <div class="med-details">
                            <div class="med-dose">${med.dose}</div>
                            <div class="med-risk">Risk Level: ${med.risk_level}</div>
                        </div>
                    </div>
                `).join('');

                document.getElementById('medications-container').innerHTML = medicationsHtml;
            }

            // Display ADR list
            if (result.adr_list && result.adr_list.length > 0) {
                const adrHtml = result.adr_list.map(adr => `
                    <div class="adr-detail-card">
                        <div class="adr-header">
                            <h5>${adr.name}</h5>
                            <span class="adr-probability">${adr.probability}%</span>
                        </div>
                        <div class="adr-info">
                            <div class="adr-category">${adr.category} - ${adr.severity}</div>
                            <div class="adr-onset">Onset: ${adr.onset}</div>
                            <div class="adr-symptoms">
                                <strong>Symptoms:</strong> ${adr.symptoms.join(', ')}
                            </div>
                            <div class="adr-monitoring">
                                <strong>Monitoring:</strong> ${adr.monitoring}
                            </div>
                        </div>
                    </div>
                `).join('');

                document.getElementById('adr-details-container').innerHTML = adrHtml;
            }
        }

        // Client-side comprehensive lab analysis
        function generateEnhancedLabAnalysisClientSide(patientData) {
            const sex = patientData.sex || 'M';
            const labAnalysis = {
                renal_function: {},
                liver_function: {},
                overall_assessment: [],
                monitoring_recommendations: []
            };

            // Analyze renal function
            if (patientData.creatinine) {
                const creatInterp = getLabInterpretationClientSide('creatinine', patientData.creatinine, sex);
                labAnalysis.renal_function.creatinine = {
                    value: patientData.creatinine,
                    unit: 'mg/dL',
                    interpretations: creatInterp
                };
            }

            if (patientData.egfr) {
                const egfrInterp = getLabInterpretationClientSide('egfr', patientData.egfr, sex);
                labAnalysis.renal_function.egfr = {
                    value: patientData.egfr,
                    unit: 'mL/min/1.73m²',
                    interpretations: egfrInterp
                };
            }

            // Analyze liver function
            if (patientData.ast_alt) {
                const astInterp = getLabInterpretationClientSide('ast_alt', patientData.ast_alt, sex);
                labAnalysis.liver_function.ast_alt = {
                    value: patientData.ast_alt,
                    unit: 'U/L',
                    interpretations: astInterp
                };
            }

            if (patientData.bilirubin) {
                const biliInterp = getLabInterpretationClientSide('bilirubin', patientData.bilirubin, sex);
                labAnalysis.liver_function.bilirubin = {
                    value: patientData.bilirubin,
                    unit: 'mg/dL',
                    interpretations: biliInterp
                };
            }

            if (patientData.albumin) {
                const albInterp = getLabInterpretationClientSide('albumin', patientData.albumin, sex);
                labAnalysis.liver_function.albumin = {
                    value: patientData.albumin,
                    unit: 'g/dL',
                    interpretations: albInterp
                };
            }

            // Overall assessment
            const highRiskFindings = [];
            const moderateRiskFindings = [];

            for (const category of ['renal_function', 'liver_function']) {
                for (const [test, data] of Object.entries(labAnalysis[category])) {
                    for (const interp of data.interpretations || []) {
                        if (interp.severity === 'High') {
                            highRiskFindings.push(`${test.toUpperCase()}: ${interp.clinical_significance}`);
                        } else if (interp.severity === 'Moderate') {
                            moderateRiskFindings.push(`${test.toUpperCase()}: ${interp.clinical_significance}`);
                        }
                    }
                }
            }

            if (highRiskFindings.length > 0) {
                labAnalysis.overall_assessment.push({
                    level: 'High Risk',
                    findings: highRiskFindings,
                    recommendation: 'Immediate clinical attention required'
                });
            }

            if (moderateRiskFindings.length > 0) {
                labAnalysis.overall_assessment.push({
                    level: 'Moderate Risk',
                    findings: moderateRiskFindings,
                    recommendation: 'Enhanced monitoring recommended'
                });
            }

            // Monitoring recommendations
            if (patientData.creatinine && patientData.creatinine > 1.5) {
                labAnalysis.monitoring_recommendations.push('Monitor renal function weekly');
            }
            if (patientData.ast_alt && patientData.ast_alt > 80) {
                labAnalysis.monitoring_recommendations.push('Monitor liver function every 3-7 days');
            }
            if (patientData.egfr && patientData.egfr < 60) {
                labAnalysis.monitoring_recommendations.push('Adjust drug dosing for renal impairment');
            }

            return labAnalysis;
        }

        // Toggle test category sections
        function toggleTestCategory(categoryName) {
            const section = document.getElementById(categoryName + '-tests');
            const card = event.target.closest('.test-card');

            if (section.style.display === 'none' || section.style.display === '') {
                // Hide all other sections
                const allSections = document.querySelectorAll('.test-category-section');
                const allCards = document.querySelectorAll('.test-card');

                allSections.forEach(s => s.style.display = 'none');
                allCards.forEach(c => c.classList.remove('active'));

                // Show selected section
                section.style.display = 'block';
                card.classList.add('active');

                // Auto-scroll removed for better user control
                // setTimeout(() => {
                //     section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // }, 100);
            } else {
                // Hide selected section
                section.style.display = 'none';
                card.classList.remove('active');
            }
        }

        // Generate comprehensive lab analysis
        async function generateEnhancedLabAnalysis() {
            if (!currentPatientData) {
                showNotification('No patient data available for analysis', 'error');
                return;
            }

            try {
                showLoading();

                // Try server-side first
                try {
                    const response = await fetch('/enhanced_lab_analysis', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            patient_data: currentPatientData
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        displayEnhancedLabAnalysis(result.lab_analysis);
                        showNotification('Comprehensive lab analysis completed!', 'success');
                        return;
                    }
                } catch (error) {
                    console.log('Server endpoint not available, using client-side analysis');
                }

                // Fallback to client-side analysis
                const labAnalysis = generateEnhancedLabAnalysisClientSide(currentPatientData);
                displayEnhancedLabAnalysis(labAnalysis);
                showNotification('Comprehensive lab analysis completed! (Client-side)', 'success');

            } catch (error) {
                showNotification('Error generating lab analysis: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        function displayEnhancedLabAnalysis(labAnalysis) {
            // Create modal for lab analysis results
            const modalHtml = `
                <div id="lab-analysis-modal" class="modal-overlay">
                    <div class="modal-content lab-analysis-modal">
                        <div class="modal-header">
                            <h3><i class="fas fa-flask"></i> Comprehensive Laboratory Analysis</h3>
                            <button class="modal-close" onclick="closeLabAnalysisModal()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            ${generateLabAnalysisContent(labAnalysis)}
                        </div>
                    </div>
                </div>
            `;

            // Remove existing modal if present
            const existingModal = document.getElementById('lab-analysis-modal');
            if (existingModal) {
                existingModal.remove();
            }

            // Add new modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            document.getElementById('lab-analysis-modal').style.display = 'flex';
        }

        function generateLabAnalysisContent(labAnalysis) {
            let content = '';

            // Renal function section
            if (labAnalysis.renal_function && Object.keys(labAnalysis.renal_function).length > 0) {
                content += `
                    <div class="lab-section">
                        <h4><i class="fas fa-kidneys"></i> Renal Function Assessment</h4>
                        <div class="lab-results-grid">
                `;

                for (const [test, data] of Object.entries(labAnalysis.renal_function)) {
                    const interpretations = data.interpretations || [];
                    content += `
                        <div class="lab-result-card">
                            <div class="lab-test-name">${test.toUpperCase()}</div>
                            <div class="lab-value">${data.value} ${data.unit}</div>
                            ${interpretations.map(interp => `
                                <div class="lab-interpretation ${interp.severity.toLowerCase()}-severity">
                                    <span class="interp-status">${interp.status}</span>
                                    <span class="interp-significance">${interp.clinical_significance}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                content += `
                        </div>
                    </div>
                `;
            }

            // Liver function section
            if (labAnalysis.liver_function && Object.keys(labAnalysis.liver_function).length > 0) {
                content += `
                    <div class="lab-section">
                        <h4><i class="fas fa-liver"></i> Liver Function Assessment</h4>
                        <div class="lab-results-grid">
                `;

                for (const [test, data] of Object.entries(labAnalysis.liver_function)) {
                    const interpretations = data.interpretations || [];
                    content += `
                        <div class="lab-result-card">
                            <div class="lab-test-name">${test.toUpperCase()}</div>
                            <div class="lab-value">${data.value} ${data.unit}</div>
                            ${interpretations.map(interp => `
                                <div class="lab-interpretation ${interp.severity.toLowerCase()}-severity">
                                    <span class="interp-status">${interp.status}</span>
                                    <span class="interp-significance">${interp.clinical_significance}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                content += `
                        </div>
                    </div>
                `;
            }

            // Overall assessment
            if (labAnalysis.overall_assessment && labAnalysis.overall_assessment.length > 0) {
                content += `
                    <div class="lab-section">
                        <h4><i class="fas fa-stethoscope"></i> Overall Clinical Assessment</h4>
                        <div class="assessment-cards">
                `;

                labAnalysis.overall_assessment.forEach(assessment => {
                    content += `
                        <div class="assessment-card ${assessment.level.toLowerCase().replace(' ', '-')}">
                            <div class="assessment-level">${assessment.level}</div>
                            <div class="assessment-findings">
                                ${assessment.findings.map(finding => `<div class="finding-item">${finding}</div>`).join('')}
                            </div>
                            <div class="assessment-recommendation">${assessment.recommendation}</div>
                        </div>
                    `;
                });

                content += `
                        </div>
                    </div>
                `;
            }

            // Monitoring recommendations
            if (labAnalysis.monitoring_recommendations && labAnalysis.monitoring_recommendations.length > 0) {
                content += `
                    <div class="lab-section">
                        <h4><i class="fas fa-calendar-check"></i> Monitoring Recommendations</h4>
                        <div class="monitoring-list">
                            ${labAnalysis.monitoring_recommendations.map(rec => `
                                <div class="monitoring-item">
                                    <i class="fas fa-check-circle"></i>
                                    <span>${rec}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            return content;
        }

        function closeLabAnalysisModal() {
            const modal = document.getElementById('lab-analysis-modal');
            if (modal) {
                modal.style.display = 'none';
                modal.remove();
            }
        }

        // Test notification function
        function testNotification() {
            showNotification('Test notification is working!', 'success');
            setTimeout(() => {
                showNotification('Test error notification', 'error');
            }, 1000);
        }

        // Test AI detailed analysis display
        function testEnhancedResultsDisplay() {
            console.log('Testing AI detailed analysis display...');

            // Mock data for testing
            const mockResult = {
                risk_level: 'High',
                predicted_adr_type: 'Hepatotoxicity',
                no_adr_probability: 25.5,
                timestamp: new Date().toISOString()
            };

            // Show results container first
            const resultsContainer = document.getElementById('results-container');
            if (resultsContainer) {
                resultsContainer.style.display = 'block';
            }

            // Set mock patient data
            currentPatientData = {
                age: 75,
                sex: 'M',
                medication_name: 'Warfarin'
            };

            // Call the AI analysis function
            if (typeof generateAIDetailedAnalysis === 'function') {
                generateAIDetailedAnalysis(mockResult);
                showNotification('AI detailed analysis test started!', 'success');
            } else {
                showNotification('generateAIDetailedAnalysis function not found!', 'error');
            }
        }

        // Update the main displayResults function to include enhanced features
        const originalDisplayResults = displayResults;
        displayResults = function (result) {
            originalDisplayResults(result);
            displayEnhancedResults(result);

            // Enhanced results container is now part of main results, so it shows automatically
            // No need to separately show/hide it
        };

    </script>



    <style>
        /* Enhanced Lab Function Group Styles */
        .liver-function-group label,
        .form-group label {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .lab-buttons {
            display: flex;
            gap: 8px;
        }

        .lab-interpret-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(72, 187, 120, 0.3);
        }

        .lab-interpret-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.5);
        }

        /* Lab Interpretation Styles */
        .lab-interpretation {
            margin-top: 10px;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(79, 209, 197, 0.3);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .lab-interp-container h6 {
            margin: 0 0 10px 0;
            color: #e2e8f0;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .lab-interp-item {
            padding: 8px;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 4px solid rgba(79, 209, 197, 0.3);
            color: #cbd5e0;
        }

        .lab-interp-item.high-severity {
            background: rgba(239, 68, 68, 0.15);
            border-left-color: #ef4444;
            color: #fca5a5;
        }

        .lab-interp-item.moderate-severity {
            background: rgba(245, 158, 11, 0.15);
            border-left-color: #f59e0b;
            color: #fbbf24;
        }

        .lab-interp-item.low-severity {
            background: rgba(72, 187, 120, 0.15);
            border-left-color: #48bb78;
            color: #6ee7b7;
        }

        .lab-interp-container.normal {
            background: rgba(72, 187, 120, 0.1);
            border-color: #48bb78;
        }

        .interp-status {
            font-weight: 600;
            font-size: 0.85rem;
            color: #e5e7eb;
        }

        .interp-significance {
            font-size: 0.8rem;
            color: #d1d5db;
            margin: 4px 0;
        }

        .interp-severity {
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .interp-normal {
            color: #6ee7b7;
            font-weight: 500;
            font-size: 0.85rem;
        }

        .factor-reference {
            margin-top: 8px;
            padding: 6px 10px;
            background: #f3f4f6;
            border-radius: 6px;
            font-size: 0.8rem;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Concomitant Drugs Styles */
        .concomitant-drugs-group {
            margin-top: 20px;
        }

        .concomitant-drug-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .concomitant-drug-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .remove-drug-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .remove-drug-btn:hover {
            background: #dc2626;
        }

        .add-drug-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 700;
            width: 70%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .add-drug-btn:hover {
            background: #059669;
        }

        /* Modal Styles */
        .liver-function-modal {
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #6b7280;
        }

        .upload-section,
        .uploaded-files-section,
        .liver-parameters-section {
            margin-bottom: 25px;
        }

        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover {
            border-color: #4fd1c5;
            background: rgba(79, 209, 197, 0.05);
        }

        .file-input {
            display: none;
        }

        .file-upload-label {
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .file-upload-label i {
            font-size: 2rem;
            color: #4fd1c5;
        }

        .uploaded-files-list {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 10px;
        }

        .uploaded-file {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-bottom: 1px solid #f1f5f9;
        }

        .parameter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .parameter-item label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #374151;
        }

        .parameter-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
        }

        /* Enhanced Results Styles */
        .adr-factor-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .adr-factor-card.high-risk {
            border-left-color: #ef4444;
        }

        .adr-factor-card.medium-risk {
            border-left-color: #f59e0b;
        }

        .adr-factor-card.low-risk {
            border-left-color: #10b981;
        }

        .factor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .risk-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-badge.high {
            background: #fecaca;
            color: #991b1b;
        }

        .risk-badge.medium {
            background: #fed7aa;
            color: #9a3412;
        }

        .risk-badge.low {
            background: #d1fae5;
            color: #065f46;
        }

        .medication-card,
        .adr-detail-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .med-type,
        .adr-category {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 8px;
            background: #f3f4f6;
            color: #374151;
        }

        /* AI-Powered Detailed Analysis Styles */
        .ai-detailed-analysis-container {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(102, 126, 234, 0.2);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.1);
        }

        .ai-analysis-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.2);
        }

        .ai-analysis-header h2 {
            font-size: 1.4rem;
            color: #e2e8f0;
            margin-bottom: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .ai-analysis-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .ai-detailed-content {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            padding: 30px;
            min-height: 200px;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid rgba(79, 209, 197, 0.2);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Custom scrollbar for detailed analysis content */
        .ai-detailed-content::-webkit-scrollbar {
            width: 8px;
        }

        .ai-detailed-content::-webkit-scrollbar-track {
            background: rgba(79, 209, 197, 0.1);
            border-radius: 4px;
        }

        .ai-detailed-content::-webkit-scrollbar-thumb {
            background: rgba(79, 209, 197, 0.3);
            border-radius: 4px;
        }

        .ai-detailed-content::-webkit-scrollbar-thumb:hover {
            background: rgba(79, 209, 197, 0.5);
        }

        .ai-analysis-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #4fd1c5;
        }

        .ai-analysis-loading i {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .ai-analysis-loading p {
            font-size: 1.1rem;
            font-weight: 500;
            margin: 0;
        }

        .ai-analysis-content {
            line-height: 1.6;
        }

        .ai-analysis-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .analysis-timestamp {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #6b7280;
            font-size: 0.9rem;
        }

        .ai-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .ai-status.ai-powered {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .ai-status.fallback {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .ai-report-content {
            font-size: 1rem;
            color: #e2e8f0;
        }

        .ai-report-content p {
            color: #cbd5e0;
            line-height: 1.7;
            margin: 15px 0;
        }

        .ai-report-content ul,
        .ai-report-content ol {
            color: #cbd5e0;
            margin: 15px 0;
            padding-left: 25px;
        }

        .ai-report-content li {
            color: #cbd5e0;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .ai-report-content h4 {
            color: #a0aec0;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 20px 0 10px 0;
        }

        .ai-report-content strong {
            color: #e2e8f0;
            font-weight: 700;
        }

        .ai-report-content em {
            color: #4fd1c5;
            font-style: italic;
        }

        .ai-report-content .medical-term {
            color: #4fd1c5;
            font-weight: 600;
            background: rgba(30, 41, 59, 0.6);
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid rgba(79, 209, 197, 0.3);
        }

        .ai-report-content .risk-high {
            color: #ef4444;
            font-weight: 700;
            background: rgba(239, 68, 68, 0.15);
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .ai-report-content .risk-medium {
            color: #f59e0b;
            font-weight: 700;
            background: rgba(245, 158, 11, 0.15);
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .ai-report-content .risk-low {
            color: #10b981;
            font-weight: 700;
            background: rgba(16, 185, 129, 0.15);
            padding: 2px 8px;
            border-radius: 12px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .analysis-section-title {
            color: #4fd1c5;
            font-size: 1.4rem;
            font-weight: 700;
            margin: 25px 0 15px 0;
            padding: 15px 20px;
            background: linear-gradient(135deg, rgba(79, 209, 197, 0.15) 0%, rgba(56, 178, 172, 0.15) 100%);
            border-left: 4px solid #4fd1c5;
            border-radius: 8px;
            position: relative;
        }

        .analysis-section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
            border-radius: 4px 0 0 4px;
        }

        .analysis-subsection-title {
            color: #cbd5e0;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 20px 0 10px 0;
            padding: 8px 12px;
            background: rgba(79, 209, 197, 0.1);
            border-radius: 6px;
        }

        .ai-analysis-error {
            text-align: center;
            padding: 30px;
        }

        .error-header {
            margin-bottom: 20px;
        }

        .error-header i {
            font-size: 2rem;
            color: #f59e0b;
            margin-bottom: 10px;
        }

        .error-header h3 {
            color: #e2e8f0;
            margin: 0;
        }

        .fallback-analysis {
            text-align: left;
            margin-top: 20px;
        }

        .fallback-section {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .fallback-section h4 {
            color: #e2e8f0;
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .risk-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .risk-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }

        .risk-label {
            font-weight: 500;
            color: #a0aec0;
        }

        .risk-value {
            font-weight: 600;
            color: #e2e8f0;
        }

        .risk-value.high {
            color: #dc2626;
        }

        .risk-value.medium {
            color: #d97706;
        }

        .risk-value.low {
            color: #059669;
        }

        /* Detailed Clinical Analysis Content Styles */
        .clinical-analysis-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .risk-overview {
            margin-top: 15px;
        }

        .risk-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .risk-metric {
            padding: 15px;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            text-align: center;
        }

        .metric-label {
            font-size: 0.85rem;
            color: #a0aec0;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .metric-value.risk-high {
            color: #dc2626;
        }

        .metric-value.risk-medium {
            color: #d97706;
        }

        .metric-value.risk-low {
            color: #059669;
        }

        .metric-description {
            font-size: 0.8rem;
            color: #a0aec0;
            line-height: 1.4;
        }

        .detailed-risks {
            margin-top: 15px;
        }

        .risk-detail-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(248, 250, 252, 0.6);
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .risk-name {
            flex: 1;
            font-weight: 600;
            color: #374151;
        }

        .risk-probability {
            font-weight: 700;
            color: #1f2937;
            margin: 0 15px;
            min-width: 50px;
            text-align: right;
        }

        .risk-bar {
            width: 100px;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .risk-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .recommendations {
            margin-top: 15px;
        }

        .recommendation-category {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(79, 209, 197, 0.1);
            border-radius: 8px;
            border-left: 4px solid #4fd1c5;
        }

        .recommendation-category h4 {
            color: #e2e8f0;
            margin: 0 0 10px 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .recommendation-category ul {
            margin: 0;
            padding-left: 20px;
        }

        .recommendation-category li {
            margin-bottom: 8px;
            color: #cbd5e0;
            line-height: 1.5;
        }

        .next-steps {
            margin-top: 15px;
        }

        .step-timeline {
            position: relative;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(248, 250, 252, 0.6);
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .timeline-marker {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .timeline-marker.immediate {
            background: #dc2626;
        }

        .timeline-marker.short-term {
            background: #d97706;
        }

        .timeline-marker.long-term {
            background: #059669;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-title {
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 4px;
        }

        .timeline-description {
            color: #a0aec0;
            font-size: 0.9rem;
        }

        .clinical-disclaimer {
            margin-top: 25px;
            padding: 15px;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
        }

        .clinical-disclaimer p {
            margin: 0;
            color: #92400e;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Emergency ADR Management Styles */
        .emergency-adr-management {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 3px solid #dc2626;
            border-radius: 16px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.3);
            animation: emergencyPulse 2s infinite;
            position: relative;
            overflow: hidden;
        }

        .emergency-adr-management::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(220, 38, 38, 0.1), transparent);
            animation: emergencyShine 3s infinite;
        }

        @keyframes emergencyPulse {

            0%,
            100% {
                box-shadow: 0 8px 25px rgba(220, 38, 38, 0.3);
            }

            50% {
                box-shadow: 0 12px 35px rgba(220, 38, 38, 0.5);
            }
        }

        @keyframes emergencyShine {
            0% {
                left: -100%;
            }

            100% {
                left: 100%;
            }
        }

        .emergency-header {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            z-index: 1;
        }

        .emergency-icon {
            font-size: 2.5rem;
            animation: emergencyBlink 1.5s infinite;
        }

        @keyframes emergencyBlink {

            0%,
            50% {
                opacity: 1;
            }

            51%,
            100% {
                opacity: 0.3;
            }
        }

        .emergency-title h3 {
            margin: 0;
            font-size: 1.4rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .emergency-title p {
            margin: 5px 0 0 0;
            font-size: 1rem;
            opacity: 0.9;
        }

        .emergency-content {
            padding: 25px;
            position: relative;
            z-index: 1;
        }

        .emergency-section {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid rgba(239, 68, 68, 0.4);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.1);
        }

        .emergency-section h4 {
            color: #dc2626;
            font-size: 1.1rem;
            font-weight: 700;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .critical-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 12px;
        }

        .critical-action-item {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #dc2626;
            padding: 15px;
            border-radius: 8px;
            position: relative;
        }

        .action-priority {
            background: #dc2626;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            position: absolute;
            top: -8px;
            right: 10px;
        }

        .action-text {
            font-weight: 600;
            color: #e2e8f0;
            margin-top: 8px;
        }

        .warning-signs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }

        .warning-sign-item {
            background: #fef2f2;
            border: 1px solid #fca5a5;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: #7f1d1d;
        }

        .warning-sign-item i {
            color: #dc2626;
            font-size: 1.1rem;
        }

        .interventions-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .intervention-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 15px;
            display: grid;
            grid-template-columns: 60px 1fr 1fr;
            gap: 15px;
            align-items: start;
        }

        .intervention-step {
            background: #dc2626;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .intervention-action {
            font-weight: 600;
            color: #e2e8f0;
        }

        .intervention-rationale {
            color: #a0aec0;
            font-style: italic;
            font-size: 0.9rem;
        }

        .contacts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .contact-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .contact-type {
            font-weight: 700;
            color: #dc2626;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .contact-info {
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 5px;
        }

        .contact-when {
            font-size: 0.8rem;
            color: #a0aec0;
            font-style: italic;
        }

        .patient-instructions-box {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid #dc2626;
            border-radius: 12px;
            padding: 20px;
            position: relative;
        }

        .patient-instructions-box::before {
            content: '⚠️ PATIENT ALERT';
            position: absolute;
            top: -12px;
            left: 20px;
            background: #dc2626;
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .patient-warning-list {
            margin: 15px 0;
            padding-left: 20px;
        }

        .patient-warning-list li {
            margin-bottom: 8px;
            font-weight: 600;
            color: #7f1d1d;
        }

        .emergency-number {
            background: #dc2626;
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 15px;
            font-size: 1.1rem;
            font-weight: 700;
        }

        /* Mobile Responsive for Emergency Management */
        @media (max-width: 768px) {
            .emergency-header {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }

            .emergency-icon {
                font-size: 2rem;
            }

            .emergency-title h3 {
                font-size: 1.2rem;
            }

            .critical-actions-grid,
            .warning-signs-grid,
            .contacts-grid {
                grid-template-columns: 1fr;
            }

            .intervention-item {
                grid-template-columns: 1fr;
                gap: 10px;
                text-align: center;
            }

            .intervention-step {
                margin: 0 auto;
            }
        }

        /* Clinical Decision Support Styles */
        .clinical-decision-support {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(5, 150, 105, 0.05) 100%);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .cds-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(16, 185, 129, 0.1);
        }

        .cds-header h2 {
            font-size: 1.4rem;
            color: #e2e8f0;
            margin-bottom: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .cds-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Alert System Styles */
        .alert-system {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid rgba(79, 209, 197, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }

        .alert-header {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .alert-header h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-controls {
            display: flex;
            gap: 8px;
        }

        .btn-alert-control {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .btn-alert-control:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .alerts-container {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .alert-item {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid #ef4444;
            border-radius: 8px;
            border: 1px solid rgba(239, 68, 68, 0.2);
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .alert-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .alert-item.critical {
            border-left-color: #dc2626;
            background: rgba(239, 68, 68, 0.1);
        }

        .alert-item.warning {
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .alert-item.info {
            border-left-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .alert-header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .alert-title {
            font-weight: 600;
            color: #e2e8f0;
            font-size: 1rem;
        }

        .alert-severity {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .alert-severity.critical {
            background: #dc2626;
            color: white;
        }

        .alert-severity.warning {
            background: #f59e0b;
            color: white;
        }

        .alert-severity.info {
            background: #3b82f6;
            color: white;
        }

        .alert-message {
            color: #4b5563;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .alert-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .alert-action-btn {
            padding: 4px 8px;
            border: 1px solid #d1d5db;
            background: #f9fafb;
            color: #374151;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .alert-action-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .no-alerts {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }

        .no-alerts i {
            font-size: 3rem;
            color: #10b981;
            margin-bottom: 15px;
        }

        /* Clinical Guidelines Styles */
        .clinical-guidelines {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(79, 209, 197, 0.2);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .guidelines-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .guidelines-header h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .guidelines-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .guideline-selector {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .guideline-selector option {
            background: #1d4ed8;
            color: white;
        }

        .btn-guideline-control {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .btn-guideline-control:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .guidelines-container {
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
        }

        .guideline-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(79, 209, 197, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .guideline-item:hover {
            border-color: #3b82f6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
        }

        .guideline-header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .guideline-title {
            font-weight: 600;
            color: #e2e8f0;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .guideline-source {
            background: #3b82f6;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .guideline-recommendation {
            color: #4b5563;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .guideline-evidence {
            font-size: 0.8rem;
            color: #a0aec0;
            font-style: italic;
        }

        .guideline-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .guideline-action-btn {
            padding: 4px 8px;
            border: 1px solid #3b82f6;
            background: #eff6ff;
            color: #3b82f6;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .guideline-action-btn:hover {
            background: #dbeafe;
        }

        .no-guidelines {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }

        .no-guidelines i {
            font-size: 3rem;
            color: #3b82f6;
            margin-bottom: 15px;
        }

        /* Mobile Responsive for CDS */
        @media (max-width: 768px) {
            .clinical-decision-support {
                padding: 15px;
                margin-top: 15px;
            }

            .alert-header,
            .guidelines-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .alert-controls,
            .guidelines-controls {
                width: 100%;
                justify-content: flex-end;
            }

            .alerts-container,
            .guidelines-container {
                padding: 15px;
                max-height: 300px;
            }

            .alert-item,
            .guideline-item {
                padding: 12px;
            }

            .alert-header-content,
            .guideline-header-content {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }
        }

        /* Enhanced Field Analysis Styles */
        .comprehensive-field-analysis {
            margin: 20px 0;
        }

        .field-category {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid rgba(79, 209, 197, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .category-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .field-count {
            background: rgba(79, 209, 197, 0.1);
            color: #4fd1c5;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .field-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .enhanced-field-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(79, 209, 197, 0.2);
            border-radius: 10px;
            padding: 16px;
            transition: all 0.3s ease;
            position: relative;
        }

        .enhanced-field-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .enhanced-field-card.high {
            border-left: 4px solid #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
        }

        .enhanced-field-card.moderate {
            border-left: 4px solid #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
        }

        .enhanced-field-card.low,
        .enhanced-field-card.normal {
            border-left: 4px solid #10b981;
            background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%);
        }

        .field-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .field-title h4 {
            margin: 0 0 4px 0;
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
        }

        .normal-range {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 400;
        }

        .field-risk-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .field-risk-badge.high {
            background: #ef4444;
        }

        .field-risk-badge.moderate {
            background: #f59e0b;
        }

        .field-risk-badge.low,
        .field-risk-badge.normal {
            background: #10b981;
        }

        .field-content {
            margin-top: 12px;
        }

        .field-value {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .field-interpretation {
            font-size: 0.9rem;
            color: #4b5563;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .risk-contribution {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .risk-contribution.high {
            background: #fef2f2;
            color: #dc2626;
        }

        .risk-contribution.moderate {
            background: rgba(245, 158, 11, 0.15);
            color: #fbbf24;
        }

        .analysis-summary {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            border: 1px solid #cbd5e1;
        }

        .summary-card {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .summary-card i {
            font-size: 2rem;
            color: #4fd1c5;
        }

        .summary-content h4 {
            margin: 0 0 5px 0;
            font-size: 1.1rem;
            color: #1e293b;
        }

        .summary-content p {
            margin: 0;
            color: #4b5563;
            font-size: 0.95rem;
        }

        .no-data-message {
            text-align: center;
            padding: 40px;
            color: #6b7280;
            font-style: italic;
        }

        /* Mobile Responsive for Enhanced Field Analysis */
        @media (max-width: 768px) {
            .field-grid {
                grid-template-columns: 1fr;
                gap: 12px;
                padding: 15px;
            }

            .category-header {
                padding: 15px;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .enhanced-field-card {
                padding: 12px;
            }

            .field-value {
                font-size: 1.1rem;
            }

            .field-interpretation {
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .field-grid {
                padding: 10px;
                gap: 10px;
            }

            .enhanced-field-card {
                padding: 10px;
            }

            .field-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .field-title h4 {
                font-size: 0.9rem;
            }

            .field-value {
                font-size: 1rem;
            }

            .field-interpretation {
                font-size: 0.8rem;
            }

            .analysis-summary {
                padding: 15px;
            }

            .summary-card {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
        }

        /* AI Report Style for Detailed Analysis */
        .ai-report-content h2 {
            color: #4fd1c5;
            font-size: 1.4rem;
            font-weight: 700;
            margin: 25px 0 15px 0;
            padding: 15px 20px;
            background: linear-gradient(135deg, rgba(79, 209, 197, 0.15) 0%, rgba(56, 178, 172, 0.15) 100%);
            border-left: 4px solid #4fd1c5;
            border-radius: 8px;
            position: relative;
        }

        .ai-report-content h2::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(135deg, #4fd1c5 0%, #38b2ac 100%);
            border-radius: 4px 0 0 4px;
        }

        .ai-report-content h3 {
            color: #cbd5e0;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 20px 0 10px 0;
            padding: 8px 12px;
            background: rgba(79, 209, 197, 0.1);
            border-radius: 6px;
        }

        .risk-summary-section {
            margin: 20px 0;
        }

        .risk-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(79, 209, 197, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .metric-title {
            font-size: 0.85rem;
            color: #a0aec0;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .metric-value.risk-high {
            color: #dc2626;
        }

        .metric-value.risk-medium {
            color: #d97706;
        }

        .metric-value.risk-low {
            color: #059669;
        }

        .metric-desc {
            font-size: 0.8rem;
            color: #a0aec0;
            line-height: 1.4;
        }

        .risk-breakdown-section {
            margin: 20px 0;
        }

        .risk-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(79, 209, 197, 0.2);
        }

        .risk-item-name {
            flex: 1;
            font-weight: 600;
            color: #cbd5e0;
        }

        .risk-item-prob {
            font-weight: 700;
            color: #e2e8f0;
            margin: 0 15px;
            min-width: 50px;
            text-align: right;
        }

        .risk-item-bar {
            width: 100px;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .risk-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .recommendations-section {
            margin: 20px 0;
        }

        .recommendation-box {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(79, 209, 197, 0.1);
            border-radius: 8px;
            border-left: 4px solid #4fd1c5;
        }

        .recommendation-box h3 {
            color: #1e293b;
            margin: 0 0 10px 0;
            font-size: 1rem;
            font-weight: 600;
            background: none;
            padding: 0;
        }

        .recommendation-box ul {
            margin: 0;
            padding-left: 20px;
        }

        .recommendation-box li {
            margin-bottom: 8px;
            color: #374151;
            line-height: 1.5;
        }

        .timeline-section {
            margin: 20px 0;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(248, 250, 252, 0.6);
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .timeline-marker {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .timeline-marker.immediate {
            background: #dc2626;
        }

        .timeline-marker.short-term {
            background: #d97706;
        }

        .timeline-marker.long-term {
            background: #059669;
        }

        .timeline-content {
            flex: 1;
            color: #374151;
            line-height: 1.5;
        }

        .clinical-note {
            margin-top: 25px;
            padding: 15px;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
        }

        .clinical-note p {
            margin: 0;
            color: #92400e;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Mobile Responsive Styles for AI Detailed Analysis */
        @media (max-width: 768px) {
            .ai-detailed-analysis-container {
                margin-top: 15px;
                padding: 15px;
                border-radius: 8px;
            }

            .ai-analysis-header h2 {
                font-size: 1.2rem;
                gap: 8px;
            }

            .ai-analysis-badge {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .ai-detailed-content {
                padding: 20px;
                max-height: 500px;
            }

            .ai-analysis-meta {
                flex-direction: column;
                gap: 10px;
                padding: 12px;
            }

            .analysis-timestamp {
                font-size: 0.8rem;
            }

            .ai-report-content h2 {
                font-size: 1.2rem;
                padding: 12px 15px;
                margin: 20px 0 12px 0;
            }

            .ai-report-content h3 {
                font-size: 1rem;
                padding: 6px 10px;
                margin: 15px 0 8px 0;
            }

            .risk-metrics {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .metric-card {
                padding: 12px;
            }

            .metric-title {
                font-size: 0.8rem;
            }

            .metric-value {
                font-size: 1.1rem;
            }

            .metric-desc {
                font-size: 0.75rem;
            }

            .risk-item {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
                padding: 10px;
            }

            .risk-item-name {
                font-size: 0.9rem;
            }

            .risk-item-prob {
                text-align: left;
                margin: 0;
                font-size: 0.9rem;
            }

            .risk-item-bar {
                width: 100%;
                height: 6px;
            }

            .recommendation-box {
                padding: 12px;
                margin-bottom: 15px;
            }

            .recommendation-box h3 {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }

            .recommendation-box li {
                font-size: 0.85rem;
                margin-bottom: 6px;
                line-height: 1.4;
            }

            .timeline-item {
                padding: 10px;
                margin-bottom: 12px;
            }

            .timeline-marker {
                width: 10px;
                height: 10px;
                margin-right: 12px;
            }

            .timeline-content {
                font-size: 0.85rem;
                line-height: 1.4;
            }

            .clinical-note {
                padding: 12px;
                margin-top: 20px;
            }

            .clinical-note p {
                font-size: 0.8rem;
            }
        }

        /* Ultra Mobile Responsive - Small Phones */
        @media (max-width: 480px) {
            .ai-detailed-analysis-container {
                margin-top: 10px;
                padding: 12px;
            }

            .ai-analysis-header h2 {
                font-size: 1.1rem;
                margin-bottom: 8px;
            }

            .ai-detailed-content {
                padding: 15px;
                max-height: 400px;
            }

            .ai-report-content h2 {
                font-size: 1.1rem;
                padding: 10px 12px;
                margin: 15px 0 10px 0;
            }

            .metric-card {
                padding: 10px;
            }

            .metric-title {
                font-size: 0.75rem;
                margin-bottom: 6px;
            }

            .metric-value {
                font-size: 1rem;
                margin-bottom: 4px;
            }

            .metric-desc {
                font-size: 0.7rem;
            }

            .risk-item {
                padding: 8px;
            }

            .recommendation-box {
                padding: 10px;
                margin-bottom: 12px;
            }

            .recommendation-box h3 {
                font-size: 0.85rem;
            }

            .recommendation-box li {
                font-size: 0.8rem;
                line-height: 1.3;
            }

            .timeline-item {
                padding: 8px;
                margin-bottom: 10px;
            }

            .timeline-content {
                font-size: 0.8rem;
            }

            /* Ensure AI detailed analysis is responsive */
            .ai-detailed-analysis-container {
                margin-top: 8px;
                padding: 10px;
            }

            .ai-analysis-header h2 {
                font-size: 1rem;
            }

            .ai-detailed-content {
                padding: 12px;
                max-height: 350px;
            }

            .ai-detailed-content h1 {
                font-size: 1.1rem;
                margin-bottom: 10px;
            }

            .ai-detailed-content h2 {
                font-size: 1rem;
                margin: 15px 0 8px 0;
                padding: 6px 10px;
            }

            .ai-detailed-content h3 {
                font-size: 0.9rem;
                margin: 12px 0 6px 0;
                padding: 4px 8px;
            }

            .ai-detailed-content p {
                font-size: 0.8rem;
                margin: 8px 0;
                line-height: 1.4;
            }

            .ai-detailed-content ul {
                margin: 8px 0;
                padding-left: 20px;
            }

            .ai-detailed-content li {
                font-size: 0.8rem;
                margin-bottom: 4px;
                line-height: 1.4;
            }
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .enhanced-results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }

        .enhanced-section {
            background: #f8fafc;
            border-radius: 16px;
            padding: 25px;
            border: 1px solid #e5e7eb;
        }

        .enhanced-section.full-width {
            grid-column: 1 / -1;
        }

        .enhanced-section .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .enhanced-section .section-header i {
            color: #4fd1c5;
            font-size: 1.3rem;
        }

        .enhanced-section .section-header h3 {
            color: #1e293b;
            font-size: 1.2rem;
            font-weight: 700;
            margin: 0;
        }

        .factors-container,
        .medications-container,
        .adr-details-container {
            max-height: 400px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .liver-function-modal {
                margin: 10px;
                max-height: 90vh;
            }

            .parameter-grid {
                grid-template-columns: 1fr;
            }

            .concomitant-drug-item {
                flex-direction: column;
                align-items: stretch;
            }

            .enhanced-results-grid {
                grid-template-columns: 1fr;
            }

            .enhanced-section {
                padding: 15px;
            }
        }

        /* Lab Analysis Modal Styles */
        .lab-analysis-modal {
            max-width: 900px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .lab-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }

        .lab-section h4 {
            margin: 0 0 15px 0;
            color: #1e293b;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .lab-results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .lab-result-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .lab-test-name {
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .lab-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 10px;
        }

        .assessment-cards {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .assessment-card {
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #e5e7eb;
        }

        .assessment-card.high-risk {
            background: #fef2f2;
            border-left-color: #ef4444;
        }

        .assessment-card.moderate-risk {
            background: rgba(245, 158, 11, 0.1);
            border-left-color: #f59e0b;
        }

        .assessment-level {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .finding-item {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .assessment-recommendation {
            font-weight: 500;
            color: #374151;
            margin-top: 8px;
            font-style: italic;
        }

        .monitoring-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .monitoring-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            border: 1px solid rgba(79, 209, 197, 0.2);
        }

        .monitoring-item i {
            color: #48bb78;
        }

        @media (max-width: 768px) {
            .lab-analysis-modal {
                margin: 10px;
                max-height: 90vh;
            }

            .lab-results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/detailed_analysis.js') }}"></script>
    <script src="{{ url_for('static', filename='js/adr-warning.js') }}"></script>

    <script>
        // Initialize ADR warning system
        window.addEventListener('load', function () {
            console.log('🚨 ADR Warning System ready');



        });

        // Age interpretation function for main form
        function interpretAge() {
            const ageInput = document.getElementById('age');
            const interpretationDiv = document.getElementById('age-interpretation');
            const age = parseInt(ageInput.value);

            if (!age || age < 0 || age > 120) {
                interpretationDiv.style.display = 'none';
                return;
            }

            let interpretation = '';
            let className = '';

            if (age < 1) {
                interpretation = '👶 Infant: Requires specialized pediatric dosing and monitoring. Higher risk of ADRs due to immature organ systems.';
                className = 'infant';
            } else if (age < 12) {
                interpretation = '🧒 Child: Pediatric dosing required. Weight-based calculations essential. Monitor for developmental effects.';
                className = 'child';
            } else if (age < 18) {
                interpretation = '👦 Adolescent: Transitional dosing considerations. Monitor for hormonal effects and compliance issues.';
                className = 'adolescent';
            } else if (age < 30) {
                interpretation = '👨 Young Adult: Standard adult dosing. Generally lower ADR risk. Monitor for lifestyle factors.';
                className = 'young-adult';
            } else if (age < 50) {
                interpretation = '👩 Adult: Standard dosing protocols. Monitor for comorbidities and drug interactions.';
                className = 'adult';
            } else if (age < 65) {
                interpretation = '👨‍💼 Middle-aged: Increased monitoring for age-related changes. Consider comorbidity burden.';
                className = 'middle-aged';
            } else if (age < 80) {
                interpretation = '👴 Elderly: Enhanced monitoring required. Consider dose reduction. Higher ADR risk due to physiological changes.';
                className = 'elderly';
            } else {
                interpretation = '👵 Very Elderly: Intensive monitoring essential. Significant dose adjustments likely needed. Very high ADR risk.';
                className = 'very-elderly';
            }

            interpretationDiv.innerHTML = interpretation;
            interpretationDiv.className = `age-interpretation ${className}`;
            interpretationDiv.style.display = 'block';
        }

        // Scroll indicator functions
        function showScrollIndicator() {
            const indicator = document.getElementById('scroll-indicator');
            if (indicator) {
                indicator.classList.add('show');

                // Hide indicator after 10 seconds or when user scrolls
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 10000);

                // Hide on scroll
                window.addEventListener('scroll', hideScrollIndicatorOnScroll, { once: true });
            }
        }

        function hideScrollIndicatorOnScroll() {
            const indicator = document.getElementById('scroll-indicator');
            if (indicator) {
                indicator.classList.remove('show');
            }
        }

        function scrollToResults() {
            const resultsContainer = document.getElementById('results-container');
            if (resultsContainer) {
                resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                hideScrollIndicatorOnScroll();
            }
        }

        // Function to open medical report with all data
        function openMedicalReport() {
            // Store assessment data in sessionStorage
            const formData = new FormData(document.getElementById('adr-form'));
            const assessmentData = {};

            for (let [key, value] of formData.entries()) {
                assessmentData[key] = value;
            }

            sessionStorage.setItem('assessmentData', JSON.stringify(assessmentData));

            // Store prediction results
            if (window.currentPredictionResult) {
                sessionStorage.setItem('predictionResults', JSON.stringify(window.currentPredictionResult));
            }

            // Open medical report in new tab
            window.open('/medical-report', '_blank');
        }

        // Make currentPredictionResult globally accessible
        window.currentPredictionResult = null;
    </script>
</body>

</html>
<style>
    /* Detailed Analysis Styles */
    .detailed-analysis-placeholder {
        text-align: center;
        padding: 40px 20px;
        background: #f8fafc;
        border-radius: 12px;
        border: 2px dashed #e5e7eb;
    }

    .analysis-loading {
        text-align: center;
        padding: 40px 20px;
        background: white;
        border-radius: 12px;
    }

    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #e5e7eb;
        border-top: 4px solid #4fd1c5;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    .analysis-result {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 25px;
        border: 1px solid #e5e7eb;
    }

    .analysis-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f1f5f9;
    }

    .analysis-header h3 {
        color: #059669;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .analysis-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .analysis-badge.ai-powered {
        background: #dbeafe;
        color: #1e40af;
    }

    .analysis-badge.fallback {
        background: #f3f4f6;
        color: #374151;
    }

    .analysis-content {
        line-height: 1.6;
        color: #374151;
    }

    .analysis-content h3 {
        color: #1f2937;
        margin: 20px 0 10px 0;
        padding-bottom: 8px;
        border-bottom: 2px solid #e5e7eb;
    }

    .analysis-content h4 {
        color: #374151;
        margin: 15px 0 8px 0;
    }

    .analysis-content p {
        margin: 12px 0;
    }

    .analysis-content ul {
        margin: 12px 0;
        padding-left: 20px;
    }

    .analysis-content li {
        margin: 6px 0;
    }

    .analysis-actions {
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .analysis-error {
        text-align: center;
        padding: 40px 20px;
        background: #fef2f2;
        border-radius: 12px;
        border: 1px solid #fecaca;
    }

    .error-icon {
        font-size: 3rem;
        color: #dc2626;
        margin-bottom: 15px;
    }

    .analysis-error h3 {
        color: #dc2626;
        margin-bottom: 10px;
    }

    .analysis-error p {
        color: #7f1d1d;
        margin-bottom: 20px;
    }

    .error-actions {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .btn-outline {
        background: transparent;
        border: 2px solid #e5e7eb;
        color: #374151;
    }

    .btn-outline:hover {
        background: #f9fafb;
        border-color: #d1d5db;
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
        .analysis-header {
            flex-direction: column;
            gap: 10px;
            text-align: center;
        }

        .analysis-actions,
        .error-actions {
            flex-direction: column;
        }

        .detailed-analysis-placeholder {
            padding: 20px 15px;
        }

        .analysis-loading {
            padding: 30px 15px;
        }

        .analysis-result {
            padding: 20px 15px;
        }
    }
</style>